namespace = mde_demand_egg_events

mde_demand_egg_events.0001 = {
    type = character_event
	title = mde_demand_egg_events.0001.t
	desc = mde_demand_egg_events.0001.desc
	theme = dragon
    override_background = { reference = study }
    
    left_portrait = {
        character = scope:egg_target
        animation = steward
    }
    right_portrait = {
        character = scope:egg_taker
        animation = marshal
    }
    artifact = {
		target = scope:egg_drogon
		position = lower_left_portrait
	}
    artifact = {
		target = scope:egg_viserion
		position = lower_center_portrait
	}
    artifact = {
		target = scope:egg_rhaegal
		position = lower_right_portrait
	}

    immediate = {
        hidden_effect = {
            scope:egg_target = {
                every_vassal_or_below = {
                    limit = {
                        any_character_artifact = {
                            has_variable = dragon_egg
                        }
                    }
                    every_character_artifact = {
                        limit = { has_variable = dragon_embryo }
                        scope:egg_taker = { add_personal_artifact_claim = prev }
                    }
                }
                every_character_artifact = {
                    limit = { has_variable = dragon_embryo }
                    scope:egg_taker = { add_personal_artifact_claim = prev }
                }
            }
        }
        character:Farman_17 = { save_scope_as = thief }
        character:Targaryen_32 = { save_scope_as = rhaena }
        character:dragon_dreamfyre = { save_scope_as = dreamfyre }
        scope:egg_taker = { add_character_flag = already_demanded_eggs }
    }

    option = {
        name = mde_demand_egg_events.0001.a
        custom_tooltip = mde_demand_egg_events.0001.a.tt
        hidden_effect = {
            scope:egg_target = {
                every_character_artifact = {
                    limit = {
                        OR = {
                            var:dragon_embryo = flag:drogon
                            var:dragon_embryo = flag:rhaegal
                            var:dragon_embryo = flag:viserion
                        }
                    }
                    set_owner = scope:egg_taker
                }
                every_vassal_or_below = {
                    every_character_artifact = {
                        limit = {
                            OR = {
                                var:dragon_embryo = flag:drogon
                                var:dragon_embryo = flag:rhaegal
                                var:dragon_embryo = flag:viserion
                            }
                        }
                        set_owner = scope:egg_taker
                    }
                }
            }
        }
        ai_chance = {
            base = 0
            modifier = {
                scope:egg_taker = {
                    OR = {
                        any_knight = {
                            has_trait = dragonrider
                        }
                        has_trait = dragonrider
                    }
                }
                add = 15
            }
        }
    }
    option = {
        name = mde_demand_egg_events.0001.b
        custom_tooltip = mde_demand_egg_events.0001.b.tt
        trigger = { gold >= 5000 }
        show_as_unavailable = {
            always = yes
        }
        scope:egg_taker = {
            trigger_event = {
                id = mde_demand_egg_events.0003
                days = { 0 5 }
            }
        }
        ai_chance = {
            base = 200
        }
    }
    option = {
        name = mde_demand_egg_events.0001.c
        custom_tooltip = mde_demand_egg_events.0001.c.tt
        scope:egg_taker = {
            trigger_event = {
                id = mde_demand_egg_events.0002
                days = { 0 5 }
            }
        }
        ai_chance = {
            base = 100
        }
    }
}

mde_demand_egg_events.0002 = {
    type = character_event
	title = mde_demand_egg_events.0002.t
	desc = mde_demand_egg_events.0002.desc
	theme = dragon
    override_background = { reference = study }
    
    left_portrait = {
        character = scope:egg_target
        animation = shock
    }
    right_portrait = {
        character = scope:egg_taker
        animation = celebrate_sword
    }
    artifact = {
		target = scope:egg_drogon
		position = lower_left_portrait
	}
    artifact = {
		target = scope:egg_viserion
		position = lower_center_portrait
	}
    artifact = {
		target = scope:egg_rhaegal
		position = lower_right_portrait
	}

    option = {
        name = mde_demand_egg_events.0002.a
        scope:egg_taker = {
            start_war = {
                casus_belli = artifact_war
                target = scope:egg_target
            }
        }
        ai_chance = {
            base = 100
        }
    }
    option = {
        name = mde_demand_egg_events.0002.b
        custom_tooltip = mde_demand_egg_events.0002.b.tt
        hidden_effect = {
            scope:egg_target = {
                every_character_artifact = {
                    limit = {
                        OR = {
                            var:dragon_embryo = flag:drogon
                            var:dragon_embryo = flag:rhaegal
                            var:dragon_embryo = flag:viserion
                        }
                    }
                    scope:egg_taker = { remove_personal_artifact_claim = prev }
                }
                every_vassal_or_below = {
                    every_character_artifact = {
                        limit = {
                            OR = {
                                var:dragon_embryo = flag:drogon
                                var:dragon_embryo = flag:rhaegal
                                var:dragon_embryo = flag:viserion
                            }
                        }
                        scope:egg_taker = { remove_personal_artifact_claim = prev }
                    }
                }
            }
        }
        ai_chance = {
            base = 0
        }
    }
}

mde_demand_egg_events.0003 = {
    type = character_event
	title = mde_demand_egg_events.0003.t
	desc = mde_demand_egg_events.0003.desc
	theme = dragon
    override_background = { reference = study }
    
    left_portrait = {
        character = scope:egg_target
        animation = war_defender
    }
    right_portrait = {
        character = scope:egg_taker
        animation = war_attacker
    }
    artifact = {
		target = scope:egg_drogon
		position = lower_left_portrait
	}
    artifact = {
		target = scope:egg_viserion
		position = lower_center_portrait
	}
    artifact = {
		target = scope:egg_rhaegal
		position = lower_right_portrait
	}

    option = {
        name = mde_demand_egg_events.0003.a
        custom_tooltip = mde_demand_egg_events.0003.a.tt
        hidden_effect = {
            scope:egg_target = {
                every_character_artifact = {
                    limit = {
                        OR = {
                            var:dragon_embryo = flag:drogon
                            var:dragon_embryo = flag:rhaegal
                            var:dragon_embryo = flag:viserion
                        }
                    }
                    scope:egg_taker = { remove_personal_artifact_claim = prev }
                }
                every_vassal_or_below = {
                    every_character_artifact = {
                        limit = {
                            OR = {
                                var:dragon_embryo = flag:drogon
                                var:dragon_embryo = flag:rhaegal
                                var:dragon_embryo = flag:viserion
                            }
                        }
                        scope:egg_taker = { remove_personal_artifact_claim = prev }
                    }
                }
            }
            scope:egg_target = { remove_short_term_gold = 5000 }
            add_short_term_gold = 5000
            
        }
        ai_chance = {
            base = 1
            modifier = {
                scope:egg_taker = {
                    gold <= 5000
                }
                add = 250
            }
            modifier = {
                scope:egg_taker = {
                    gold >= 0
                }
                add = 2000
            }
        }
    }
    option = {
        name = mde_demand_egg_events.0003.b
        custom_tooltip = mde_demand_egg_events.0003.b.tt
       
        scope:egg_taker = {
            trigger_event = {
                id = mde_demand_egg_events.0002
                days = { 0 5 }
            }
        }
         ai_chance = {
            base = 1
            modifier = {
                scope:egg_taker = {
                    OR = {
                        any_knight = {
                            has_trait = dragonrider
                        }
                        has_trait = dragonrider
                    }
                }
                add = 1000
            }
        }
    }
   
}

mde_demand_egg_events.0004 = {
    type = character_event
	title = mde_demand_egg_events.0004.t
	desc = mde_demand_egg_events.0004.desc
	theme = dragon
    override_background = { reference = army_camp }
    
    left_portrait = {
        character = scope:egg_victim
        scripted_animation = mde_holding_dragon_egg_with_target_animation
    }
    right_portrait = {
        character = scope:egg_taker
        animation = marshal
    }
    artifact = {
		target = scope:egg_target
		position = lower_center_portrait 
	}
    immediate = {
    }

    option = {
        name = mde_demand_egg_events.0004.a
        custom_tooltip = mde_demand_egg_events.0004.a.tt
        scope:egg_taker = {
            trigger_event = mde_demand_egg_events.0007
        }
        ai_chance = {
            base = 0
            modifier = {
                scope:egg_taker = {
                    OR = {
                        any_knight = {
                            has_trait = dragonrider
                        }
                        has_trait = dragonrider
                    }
                }
                add = 15
            }
        }
    }
    option = {
        name = mde_demand_egg_events.0004.b
        #custom_tooltip = mde_demand_egg_events.0004.b.tt
        trigger = { gold >= 1500 }
        show_as_unavailable = {
           always = yes
        }
        scope:egg_taker = {
           trigger_event = {
               id = mde_demand_egg_events.0005
               days = { 1 5 }
            }
        }
        ai_chance = {
            base = 300
        }
    }
    option = {
        name = mde_demand_egg_events.0004.c
        custom_tooltip = mde_demand_egg_events.0004.c.tt
        scope:egg_taker = {
            trigger_event = {
                id = mde_demand_egg_events.0006
                days = { 1 5 }
            }
        }
        ai_chance = {
            base = 100
        }
    }
}

mde_demand_egg_events.0005 = {
    type = character_event
	title = mde_demand_egg_events.0005.t
	desc = mde_demand_egg_events.0005.desc
	theme = dragon
    override_background = { reference = throne_room }
    
    left_portrait = {
        character = scope:egg_victim
        animation = steward
    }
    right_portrait = {
        character = scope:egg_taker
        animation = marshal
    }
    artifact = {
		target = scope:egg_target
		position = lower_center_portrait 
	}

    option = {
        name = mde_demand_egg_events.0005.a
        custom_tooltip = mde_demand_egg_events.0005.a.tt
        scope:egg_victim = { 
            pay_short_term_gold = {
                target = scope:egg_taker
                gold = 1500
            }
        }
        ai_chance = {
            base = 1
            modifier = {
                scope:egg_taker = {
                    gold <= 1500
                }
                add = 250
            }
            modifier = {
                scope:egg_taker = {
                    gold >= 0
                }
                add = 2000
            }
        }
    }
    option = {
        name = mde_demand_egg_events.0005.b
        custom_tooltip = mde_demand_egg_events.0005.b.tt
       
        scope:egg_taker = {
            trigger_event = {
                id = mde_demand_egg_events.0006
                days = { 0 5 }
            }
        }
        ai_chance = {
            base = 500
            modifier = {
                scope:egg_taker = {
                    OR = {
                        any_knight = {
                            has_trait = dragonrider
                        }
                        has_trait = dragonrider
                    }
                }
                add = 1000
            }
        }
    }
}

mde_demand_egg_events.0006 = {
    type = character_event
	title = mde_demand_egg_events.0006.t
	desc = mde_demand_egg_events.0006.desc
	theme = dragon
    override_background = { reference = study }
    
    left_portrait = {
        character = scope:egg_victim
        animation = shock
    }
    right_portrait = {
        character = scope:egg_taker
        animation = celebrate_sword
    }
    artifact = {
		target = scope:egg_target
		position = lower_center_portrait 
	}
    immediate = {
        scope:egg_taker = {
            add_personal_artifact_claim = scope:egg_target
        }
    }

    option = {
        name = mde_demand_egg_events.0006.a
        trigger = {
            scope:egg_taker = {
                can_declare_war = {
                    casus_belli = artifact_war
                    defender = scope:egg_victim
                }
            }
        }
        scope:egg_taker = {
            add_opinion = {
                target = scope:egg_victim
                modifier = demanded_egg_opinion
            }
            if = {
                limit = {
                    scope:egg_victim = {
                        is_independent_ruler = yes
                    }
                }
                start_war = {
                    casus_belli = artifact_war
                    target = scope:egg_victim
                }
            }
            else = {
                start_war = {
                    casus_belli = artifact_war
                    target = scope:egg_victim.top_liege
                } 
            }
            
        }
        scope:egg_victim = {
            set_variable = {
                name = rightfully_demanded_egg
                value = scope:egg_taker
            }
        }
        ai_chance = {
            base = 100
        }
    }
    option = {
        name = mde_demand_egg_events.0006.b
        custom_tooltip = mde_demand_egg_events.0006.b.tt
        scope:egg_taker = {
            add_opinion = {
                target = scope:egg_victim
                modifier = demanded_egg_opinion
            }
        }
        scope:egg_victim = {
            set_variable = {
                name = rightfully_demanded_egg
                value = scope:egg_taker
            }
        }
        ai_chance = {
            base = 100
        }
    }
    option = {
        name = mde_demand_egg_events.0006.c
        scope:egg_taker = { remove_personal_artifact_claim = scope:egg_target }
        custom_tooltip = mde_demand_egg_events.0006.c.tt
        ai_chance = {
            base = 0
        }
    }
}

mde_demand_egg_events.0007 = {
    type = character_event
	title = mde_demand_egg_events.0007.t
	desc = mde_demand_egg_events.0007.desc
	theme = dragon
    override_background = { reference = study }
    
    left_portrait = {
        character = scope:egg_victim
        animation = shock
    }
    right_portrait = {
        character = scope:egg_taker
        scripted_animation = mde_holding_dragon_egg_with_target_animation
    }
    artifact = {
		target = scope:egg_target
		position = lower_center_portrait 
	}
    immediate = {
        scope:egg_target = {
            set_owner = scope:egg_taker
        }
    }

    option = {
        name = mde_demand_egg_events.0007.a
    }
}