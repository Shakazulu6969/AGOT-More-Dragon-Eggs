namespace = agot_ninepenny

# Maelys Start Event
agot_ninepenny.0001 = {
	type = character_event
	title = agot_ninepenny.0001.t
	desc = agot_ninepenny.0001.desc

	theme = war
	override_background = {
		reference = agot_npk_tree_of_crowns
	}
	left_portrait = {
		character = root
		animation = map_rage
	}
	right_portrait = {
		character = scope:adarys
		animation = steward
	}

	trigger = {
	}

	immediate = {
		set_variable = ninepenny_king
		hidden_effect = { create_band_of_nine_alliances_effect = yes }
		character:Adarys_1 = {
			save_scope_as = adarys
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Saan_1 = {
			save_scope_as = saan
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Old_Mother_1 = {
			save_scope_as = old_mother
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Butcher_1 = {
			save_scope_as = butcher
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Fossoway_58 = {
			save_scope_as = bad_apple
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Nine_Eyes_1 = {
			save_scope_as = nine_eyes
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Qhoqua_1 = {
			save_scope_as = ebon_prince
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		character:Lashare_1 = {
			save_scope_as = lashare
			set_variable = ninepenny_king
			hidden_effect = { create_band_of_nine_alliances_effect = yes }
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}

		#Fix for Maelys "granting independence" to his first grant title recipient
		hidden_effect = {
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = change
				add_claim_on_loss = no
			}

			title:c_goldfuror = {
				change_title_holder_include_vassals = {
					holder = root
					change = scope:change
				}
			}

			resolve_title_and_vassal_change = scope:change

			set_realm_capital = title:c_goldfuror
		}
	}

	option = { #Attack Tyrosh to Install Adarys
		name = agot_ninepenny.0001.a
		trigger = {
			NOT = {
				title:k_tyrosh.holder = {
					has_variable = ninepenny_king
				}
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Adarys_1
			target_title = title:k_tyrosh
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_3
			}
		}
	}

	option = { #Attack Stepstones as a Staging ground to attack Westeros
		name = agot_ninepenny.0001.b
		trigger = {
			NOT = {
				title:d_first_stepstones.holder ?= {
					has_variable = ninepenny_king
				}
			}
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = ninepenny_conquest_cb
			target = title:d_first_stepstones.holder
			claimant = character:Blackfyre_14
			target_title = title:k_the_stepstones
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Lys Install Saan
		name = agot_ninepenny.0001.c
		trigger = {
			NOT = {
				title:k_lys.holder = {
					has_variable = ninepenny_king
				}
			}
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = ninepenny_conquest_cb
			target = title:k_lys.holder
			claimant = character:Saan_1
			target_title = title:k_lys
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	#Ninepenny Kings all join together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = ninepenny_conquest_cb
						using_cb = agot_blackfyre_claim
					}
					is_attacker = root
				}
				add_to_list = ninepenny_wars
			}
		}
		scope:ninepenny_story = {
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = ninepenny_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}

# Recursive Maelys War Declaration Event
agot_ninepenny.0002 = {
	type = character_event
	title = agot_ninepenny.0002.t
	desc = {
		first_valid = { #Variable set in the ninepenny conquest war
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_tyrosh
					}
				}
				desc = agot_ninepenny.0002.desc.tyrosh
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_lys
					}
				}
				desc = agot_ninepenny.0002.desc.lys
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_pentos
					}
				}
				desc = agot_ninepenny.0002.desc.pentos
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_myr
					}
				}
				desc = agot_ninepenny.0002.desc.myr
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_the_stepstones
					}
				}
				desc = agot_ninepenny.0002.desc.stepstones
			}
			desc = agot_ninepenny.0002.desc #Fallback for invalidated war
		}
	}

	theme = war

	left_portrait = {
		character = root
		animation = marshal
	}

	right_portrait = {
		trigger = { #In case we run out of kings
			exists = scope:ascendant
		}
		character = scope:ascendant #From the victorious war
	}

	trigger = {
	}

	immediate = {
		character:Targaryen_94 = { #For loc
			save_scope_as = daemon
		}
		character:Adarys_1 = {
			save_scope_as = adarys
			set_variable = ninepenny_king
		}
		character:Saan_1 = {
			save_scope_as = saan
			set_variable = ninepenny_king
		}
		character:Lashare_1 = {
			save_scope_as = lashare
		}
		character:Nine_Eyes_1 = {
			save_scope_as = nine_eyes
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		#Save the appropriate king depending on the title claimed
		if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_tyrosh
				}
			}
			character:Adarys_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_lys
				}
			}
			character:Saan_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_pentos
				}
			}
			character:Nine_Eyes_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_myr
				}
			}
			character:Lashare_1 = {
				save_scope_as = ascendant
			}
		}
		else = { #Fallback - Grab a random king
			scope:ninepenny_story = {
				random_in_list = {
					variable = band_of_nine
					limit = {
						is_alive = yes
						NOT = {
							this = root
						}
					}
					save_scope_as = ascendant
				}
			}
		}
	}

	option = { #Attack Tyrosh to Install Adarys
		name = agot_ninepenny.0001.a
		trigger = {
			NOT = {
				title:k_tyrosh.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Adarys_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Adarys_1
			target_title = title:k_tyrosh
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Stepstones as a Staging ground to attack Westeros
		name = agot_ninepenny.0001.b
		trigger = {
			NOT = {
				title:k_the_stepstones.holder ?= {
					has_variable = ninepenny_king
				}
			}
			NOT = {
				root = { has_title = title:e_the_iron_throne }
			}
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = ninepenny_conquest_cb
			target = title:d_first_stepstones.holder
			claimant = character:Blackfyre_14
			target_title = title:k_the_stepstones
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_3
			}
		}
	}

	#Already Taken IT
	option = {
		name = agot_ninepenny.0001.b.alt
		trigger = {
			NOT = {
				title:k_the_stepstones.holder ?= {
					has_variable = ninepenny_king
				}
			}
			root = { has_title = title:e_the_iron_throne }
			character:Old_Mother_1 = { is_alive = yes }
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = ninepenny_conquest_cb
			target = title:d_first_stepstones.holder
			claimant = character:Old_Mother_1
			target_title = title:k_the_stepstones
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Lys Install Saan
		name = agot_ninepenny.0001.c
		trigger = {
			NOT = {
				title:k_lys.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Saan_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_lys.holder
			claimant = character:Saan_1
			target_title = title:k_lys
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Myr install Lashare
		name = agot_ninepenny.0001.d
		trigger = {
			NOT = {
				title:k_myr.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Lashare_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_myr.holder
			claimant = character:Lashare_1
			target_title = title:k_myr
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Pentos install Nine-Eyes
		name = agot_ninepenny.0001.e
		trigger = {
			NOT = {
				title:k_pentos.holder = {
					has_variable = ninepenny_king
				}
			}
			title:k_myr.holder = { #No marching through Myr to march back
				has_variable = ninepenny_king
			}
			character:Nine_Eyes_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_pentos.holder
			claimant = character:Nine_Eyes_1
			target_title = title:k_pentos
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Westeros to install Maelys
		name = agot_ninepenny.0001.f
		trigger = {
			# Maelys cannot have the throne already
			NOT = {
				root = { has_title = title:e_the_iron_throne }
			}
			title:d_first_stepstones.holder ?= {
				OR = {
					has_variable = ninepenny_king
					top_liege = { has_variable = ninepenny_king }
				}
			}
		}
		start_war = {
			casus_belli = agot_blackfyre_claim
			target = title:e_the_iron_throne.holder
			claimant = root
			target_title = title:e_the_iron_throne
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_3
			}
		}
	}

	#Ninepenny Kings all join together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = ninepenny_conquest_cb
						using_cb = agot_blackfyre_claim
					}
					is_attacker = root
				}
				add_to_list = ninepenny_wars
			}
		}
		scope:ninepenny_story = {
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = ninepenny_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}

#Maelys takes the Throne
agot_ninepenny.0003 = {
	type = character_event
	title = agot_ninepenny.0003.t
	desc = agot_ninepenny.0003.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = scope:deposed

	lower_left_portrait = {
		character = scope:rhaella
	}

	lower_right_portrait = {
		character = scope:shaera
	}

	trigger = {
		OR = {
			character:Targaryen_2 = {
				is_alive = yes
			}
			character:Targaryen_128 = {
				is_alive = yes
			}
		}
	}

	on_trigger_fail = {
		if = {
			limit = {
				character:Blackfyre_14 = {
					has_trait = refusing_marriage
				}
			}
			remove_trait = refusing_marriage
		}
	}

	immediate = {
		title:e_the_iron_throne = {
			previous_holder = {
				save_scope_as = deposed
			}
		}
		if = {
			limit = {
				character:Blackfyre_14 = {
					has_trait = refusing_marriage
				}
			}
			remove_trait = refusing_marriage
		}

		if = {
			limit = {
				character:Targaryen_2 = {
					is_alive = yes
				}
			}
			character:Targaryen_2 = { save_scope_as = rhaella }
		}

		if = {
			limit = {
				character:Targaryen_128 = {
					is_alive = yes
				}
			}
			character:Targaryen_128 = { save_scope_as = shaera }
		}
	}

	option = { #Take a Targ Wife for Legitimacy - Rhaella
		name = agot_ninepenny.0003.a

		trigger = {
			character:Targaryen_2 = {
				is_alive = yes
			}
		}

		add_legitimacy = massive_legitimacy_gain

		if = {
			limit = {
				exists = primary_spouse
			}
			divorce = primary_spouse
		}

		if = {
			limit = {
				exists = betrothed
			}
			break_betrothal = betrothed
		}

		#Kill the Husband if you have him imprisoned
		if = {
			limit = {
				exists = character:Targaryen_2.primary_spouse
				character:Targaryen_2.primary_spouse = {
					is_imprisoned_by = root
				}
			}
			character:Targaryen_2.primary_spouse = {
				death = {
					death_reason = death_execution
					killer = root
				}
			}
		}
		#Otherwise force the divorce
		else_if = {
			limit = {
				exists = character:Targaryen_2.primary_spouse
			}
			character:Targaryen_2 = {
				divorce = primary_spouse
			}
		}
		else_if = {
			limit = {
				exists = character:Targaryen_2.betrothed
			}
			character:Targaryen_2 = {
				break_betrothal = betrothed
			}
		}

		marry = character:Targaryen_2
		if = {
			limit = {
				character:Targaryen_2 = {
					has_trait = pregnant
				}
			}
			trigger_event = agot_ninepenny.0040
		}
		#Add opinion forced marriage
		hidden_effect = {
			set_relation_rival = {
				target = character:Targaryen_2
				reason = rival_forced_marriage
			}
		}
		ai_chance = 50
	}

	option = { #Take a Targ Wife for Legitimacy - Shaera
		name = agot_ninepenny.0003.b

		trigger = {
			character:Targaryen_128 = {
				is_alive = yes
			}
		}

		add_legitimacy = massive_legitimacy_gain

		if = {
			limit = {
				exists = primary_spouse
			}
			divorce = primary_spouse
		}

		if = {
			limit = {
				exists = betrothed
			}
			break_betrothal = betrothed
		}

		#Kill the Husband if you have him imprisoned
		if = {
			limit = {
				exists = character:Targaryen_128.primary_spouse
				character:Targaryen_128.primary_spouse = {
					is_imprisoned_by = root
				}
			}
			character:Targaryen_128.primary_spouse = {
				death = {
					death_reason = death_execution
					killer = root
				}
			}
		}
		#Otherwise force the divorce
		else_if = {
			limit = {
				exists = character:Targaryen_128.primary_spouse
			}
			character:Targaryen_128 = {
				divorce = primary_spouse
			}
		}
		else_if = {
			limit = {
				exists = character:Targaryen_128.betrothed
			}
			character:Targaryen_128 = {
				break_betrothal = betrothed
			}
		}

		marry = character:Targaryen_128
		if = {
			limit = {
				character:Targaryen_128 = {
					has_trait = pregnant
				}
			}
			trigger_event = agot_ninepenny.0040
		}
		#Add opinion forced marriage
		hidden_effect = {
			set_relation_rival = {
				target = character:Targaryen_128
				reason = rival_forced_marriage
			}
		}

		ai_chance = 50
	}

	option = { #I'll pick my own wife!
		name = agot_ninepenny.0003.c

		ai_chance = { #Dont do this because the AI will marry barren old women otherwise
			base = 0
		}
	}
}

agot_ninepenny.0004 = { #Iron Throne informed of NPK Conquests - Cancels Summerhall if still active
	type = character_event
	title = agot_ninepenny.0004.t
	desc = agot_ninepenny.0004.desc

	theme = war

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = worry
	}

	right_portrait = {
		character = scope:councillor
		animation = anger
	}

	lower_center_portrait = scope:maelys


	immediate = {
		every_councillor = {
			limit = {
				NOT = {
					has_trait = kingsguard
				}
			}
			add_to_list = councillors
		}
		ordered_in_list = { #Bravest Councillor councils for a pre-emptive strike
			list = councillors
			order_by = ai_boldness
			max = 1
			save_scope_as = councillor
		}
		title:e_blackfyre_rebellion.holder = {
			save_scope_as = maelys
		}
	}

	option = { #Intervene and attack them pre-emptively
		name = agot_ninepenny.0004.a

		custom_tooltip = agot_ninepenny.0004.a.tt

		scope:maelys = {
			trigger_event = agot_ninepenny.0005
		}

		#Declare War Upon the Nine
		if = {
			limit = {
				any_owned_story = {
					story_type = story_agot_summerhall
					var:summerhall = flag:positive
				}
			}
			random_owned_story = { #If going to summerhall cancel
				limit = {
					story_type = story_agot_summerhall
				}
				set_variable = {
					name = summerhall
					value = flag:negative
				}
			}
			custom_tooltip = agot_ninepenny.0004.a.summerhall
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #They are no danger
		name = agot_ninepenny.0004.b

		scope:maelys = {
			trigger_event = agot_ninepenny.0002 #Maelys continues as usual
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.0005 = { #Inform Maelys the Throne is mustering, DECLARE WAR
	type = character_event
	title = agot_ninepenny.0005.t
	desc = agot_ninepenny.0005.desc

	theme = war

	left_portrait = {
		character = root
		animation = rage
	}

	right_portrait = {
		character = scope:messenger
		animation = personality_dishonorable
	}

	lower_center_portrait = scope:king


	immediate = {
		title:e_the_iron_throne.holder = {
			save_scope_as = king
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		if = {
			limit = {
				character:Adarys_1 ?= {
					is_alive = yes
				}
			}
			character:Adarys_1 = {
				save_scope_as = messenger
			}
		}
		else = {
			scope:ninepenny_story = {
				random_in_list = {
					variable = band_of_nine
					limit = {
						is_alive = yes
						NOT = {
							this = root
						}
					}
					save_scope_as = messenger
				}
			}
		}
	}

	option = { #Attack Westeros to install Maelys
		name = agot_ninepenny.0005.a

		start_war = {
			casus_belli = agot_blackfyre_claim
			target = title:e_the_iron_throne.holder
			claimant = root
			target_title = title:e_the_iron_throne
		}
	}

	#Ninepenny Kings all join together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = ninepenny_conquest_cb
						using_cb = agot_blackfyre_claim
					}
					is_attacker = root
				}
				add_to_list = ninepenny_wars
			}
		}
		scope:ninepenny_story = {
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = ninepenny_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}

agot_ninepenny.0008 = { #Maelys-Barry duel - Maelys POV
	type = character_event
	title = agot_ninepenny.0008.t
	desc = agot_ninepenny.0008.desc

	theme = battle

	left_portrait = {
		character = root
		animation = sword_coup_degrace
	}

	right_portrait = {
		character = scope:baratheon
		animation = aggressive_sword
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
		character:Baratheon_75 = {
			save_scope_as = baratheon
			add_character_flag = no_hat #So I can see his face
		}
		location = {
			save_scope_as = location
		}
	}

	option = { #The Duel of Fates
		name = agot_ninepenny.0008.a

		scope:baratheon = {
			trigger_event = agot_ninepenny.0009
		}
	}
}

agot_ninepenny.0009 = { #Maelys-Barry duel - Ormund POV
	type = character_event
	title = agot_ninepenny.0009.t
	desc = agot_ninepenny.0009.desc

	theme = battle

	left_portrait = {
		character = scope:baratheon
		animation = aggressive_sword
	}

	right_portrait = {
		character = scope:maelys
		animation = sword_coup_degrace
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
		character:Baratheon_75 = {
			save_scope_as = baratheon
			add_character_flag = no_hat #So I can see his face
		}
	}

	option = { #The Duel of Fates
		name = agot_ninepenny.0009.a

		configure_start_single_combat_effect = {
			SC_INITIATOR = scope:maelys
			SC_ATTACKER = scope:maelys
			SC_DEFENDER = scope:baratheon
			FATALITY = always
			FIXED = no
			LOCALE = battlefield
			OUTPUT_EVENT = agot_ninepenny.0010
			INVALIDATION_EVENT = single_combat.1006	#In a real event, this would obviously be a different event to the output.
		}
	}
}

#Maelys-Baratheon Duel Processing
agot_ninepenny.0010 = {
	hidden = yes

	immediate = {
		# Did Maelys win?
		if = {
			limit = {
				scope:sc_victor = scope:maelys
			}
			scope:maelys = {
				remove_character_flag = currently_in_duel
				#trigger_event = agot_ninepenny.0011
				#Some Effects here?
			}
		}
		# Otherwise, Baratheon won.
		else = {
			scope:baratheon = {
				#trigger_event = agot_ninepenny.0012
				#Some Effects here?
			}
		}
	}
}

agot_ninepenny.0011 = { #AI Duel for Maelys and Baratheon
	hidden = yes

	immediate = {
		location = { save_scope_as = location }
	}

	option = {
		random_list = {
			0 = {
				modifier = { #Baratheon_75 wins
					add = agot_nonhistoric_outcome_2
				}
				character:Blackfyre_14 = {
					death = {
						death_reason = death_duel
						killer = character:Baratheon_75
					}
				}
			}
			0 = {
				modifier = { #Maelys wins
					add = agot_historic_outcome_2
				}
				character:Baratheon_75 = {
					death = {
						death_reason = death_duel
						killer = character:Blackfyre_14
					}
				}
			}
		}
	}
}

agot_ninepenny.0013 = { #Maelys-Barry duel - Maelys POV
	type = character_event
	title = agot_ninepenny.0013.t
	desc = agot_ninepenny.0013.desc

	theme = battle

	left_portrait = {
		character = root
		animation = sword_coup_degrace
	}

	right_portrait = {
		character = scope:selmy
		animation = aggressive_sword
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
		character:Selmy_3 = {
			save_scope_as = selmy
			add_character_flag = no_hat #So I can see his face
		}
	}

	option = { #The Duel of Fates
		name = agot_ninepenny.0013.a

		scope:selmy = {
			trigger_event = agot_ninepenny.0014
		}
	}
}

agot_ninepenny.0014 = { #Maelys-Barry duel - Selmy POV
	type = character_event
	title = agot_ninepenny.0014.t
	desc = agot_ninepenny.0014.desc

	theme = battle

	left_portrait = {
		character = root
		animation = aggressive_sword
	}

	right_portrait = {
		character = scope:maelys
		animation = sword_coup_degrace
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
		character:Selmy_3 = {
			save_scope_as = selmy
			add_character_flag = no_hat #So I can see his face
		}
		location = {
			save_scope_as = location
		}
	}

	option = { #The Duel of Fates
		name = agot_ninepenny.0014.a

		configure_start_single_combat_effect = {
			SC_INITIATOR = scope:selmy
			SC_ATTACKER = scope:selmy
			SC_DEFENDER = scope:maelys
			FATALITY = always
			FIXED = no
			LOCALE = battlefield
			OUTPUT_EVENT = agot_ninepenny.0015
			INVALIDATION_EVENT = single_combat.1006	#In a real event, this would obviously be a different event to the output.
		}
	}
}

#Maelys-Selmy Duel Processing
agot_ninepenny.0015 = {
	hidden = yes

	immediate = {
		# Did Maelys win?
		if = {
			limit = {
				scope:sc_victor = scope:maelys
			}
			scope:maelys = {
				remove_character_flag = currently_in_duel
				#trigger_event = agot_ninepenny.0011
				#Some Effects here? Not much needed as Maelys POV he just crushes another rando
			}
		}
		# Otherwise, Barristan won.
		else = {
			scope:selmy = {
				#trigger_event = agot_ninepenny.0012 - King should get something to congratulate Selmy
				#Some Effects here?
				remove_character_flag = no_hat
			}
		}
	}
}

agot_ninepenny.0016 = { #AI Duel for Maelys and Barristan
	hidden = yes

	immediate = {
		location = { save_scope_as = location }
	}


	option = {
		random_list = {
			0 = {
				modifier = { #Selmy wins
					add = agot_historic_outcome_2
				}
				character:Blackfyre_14 = {
					death = {
						death_reason = death_duel
						killer = character:Selmy_3
					}
				}
			}
			0 = {
				modifier = { #Maelys wins
					add = agot_nonhistoric_outcome_2
				}
				character:Selmy_3 = {
					death = {
						death_reason = death_duel
						killer = character:Blackfyre_14
					}
				}
			}
		}
	}
}

#Kings Petition Maelys
agot_ninepenny.0020 = {
	type = character_event
	title = agot_ninepenny.0020.t
	desc = agot_ninepenny.0020.desc

	theme = war

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = worry
	}

	right_portrait = {
		character = scope:spokesperson
		animation = personality_zealous
	}

	lower_right_portrait = scope:throne

	lower_left_portrait = scope:maelys

	immediate = {
		if = {
			limit = {
				AND = {
					NOT = {
						title:k_tyrosh.holder ?= {
							has_variable = ninepenny_king
						}
					}
					character:Adarys_1 ?= {
						is_alive = yes
					}
				}
			}
			character:Adarys_1 = { save_scope_as = spokesperson }
		}
		else_if = {
			limit = {
				AND = {
					NOT = {
						title:k_lys.holder ?= {
							has_variable = ninepenny_king
						}
					}
					character:Saan_1 ?= {
						is_alive = yes
					}
				}
			}
			character:Saan_1 = { save_scope_as = spokesperson }
		}
		else_if = {
			limit = {
				AND = {
					NOT = {
						title:k_myr.holder ?= {
							has_variable = ninepenny_king
						}
					}
					character:Lashare_1 ?= {
						is_alive = yes
					}
				}
			}
			character:Lashare_1 = { save_scope_as = spokesperson }
		}
		else_if = {
			limit = {
				AND = {
					NOT = {
						title:k_pentos.holder ?= {
							has_variable = ninepenny_king
						}
					}
					character:Nine_Eyes_1 ?= {
						is_alive = yes
					}
				}
			}
			character:Nine_Eyes_1 = { save_scope_as = spokesperson }
		}
	}

	option = { #Attack Tyrosh to Install Adarys
		name = agot_ninepenny.0020.a
		trigger = {
			scope:spokesperson ?= character:Adarys_1
		}
		#NPK New Conquest Loop
		scope:ninepenny_story = {
			set_variable = second_npk_conquest
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Adarys_1
			target_title = title:k_tyrosh
		}
	}

	option = { #Attack Lys Install Saan
		name = agot_ninepenny.0020.a
		trigger = {
			scope:spokesperson ?= character:Saan_1
		}
		#NPK New Conquest Loop
		scope:ninepenny_story = {
			set_variable = second_npk_conquest
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_lys.holder
			claimant = character:Saan_1
			target_title = title:k_lys
		}
	}

	option = { #Attack Myr install Lashare
		name = agot_ninepenny.0020.a
		trigger = {
			scope:spokesperson ?= character:Lashare_1
		}
		#NPK New Conquest Loop
		scope:ninepenny_story = {
			set_variable = second_npk_conquest
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_myr.holder
			claimant = character:Lashare_1
			target_title = title:k_myr
		}
	}

	option = { #Attack Pentos install Nine-Eyes
		name = agot_ninepenny.0020.a
		trigger = {
			scope:spokesperson ?= character:Nine_Eyes_1
		}
		#NPK New Conquest Loop
		scope:ninepenny_story = {
			set_variable = second_npk_conquest
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_pentos.holder
			claimant = character:Nine_Eyes_1
			target_title = title:k_pentos
		}
	}

	option = { #Piss off
		name = agot_ninepenny.0020.b
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes

		scope:ninepenny_story = { #Za endo
			end_story = yes
		}
		ai_chance = 0
	}
}

agot_ninepenny.0021 = { #Maintenance for Second NPK war
	hidden = yes

	immediate = {
		scope:ninepenny_story = { #Remake Petitioners List to check for deadbois
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
					primary_title.tier < tier_kingdom #Those who lost their lands
					NOT = {
						has_character_flag = enthroned #Those who haven't been conquered for
					}
				}
				add_to_list = ninepenny_petitioners
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						NOT = {
							title:k_tyrosh.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Adarys_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_lys.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Saan_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_myr.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Lashare_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_pentos.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Nine_Eyes_1 ?= {
							is_alive = yes
						}
					}
				}
			}
			trigger_event = agot_ninepenny.0022
		}
		else = {
			trigger_event = agot_ninepenny.0023
		}
	}
}

agot_ninepenny.0022 = {
	type = character_event
	title = agot_ninepenny.0022.t
	desc = agot_ninepenny.0022.desc

	theme = war

	left_portrait = {
		character = root
		animation = marshal
	}

	right_portrait = {
		character = scope:ninepenny_king
		animation = war_defender
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		random_in_list = {
			list = ninepenny_petitioners
			save_scope_as = ninepenny_king
		}
	}

	option = { #Attack Tyrosh to Install Adarys
		name = agot_ninepenny.0001.a
		trigger = {
			NOT = {
				title:k_tyrosh.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Adarys_1 ?= {
				is_in_list = ninepenny_petitioners
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Adarys_1
			target_title = title:k_tyrosh
		}
	}

	option = { #Attack Lys Install Saan
		name = agot_ninepenny.0001.c
		trigger = {
			NOT = {
				title:k_lys.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Saan_1 ?= {
				is_in_list = ninepenny_petitioners
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_lys.holder
			claimant = character:Saan_1
			target_title = title:k_lys
		}
	}

	option = { #Attack Myr install Lashare
		name = agot_ninepenny.0001.d
		trigger = {
			NOT = {
				title:k_myr.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Lashare_1 ?= {
				is_in_list = ninepenny_petitioners
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_myr.holder
			claimant = character:Lashare_1
			target_title = title:k_myr
		}
	}

	option = { #Attack Pentos install Nine-Eyes
		name = agot_ninepenny.0001.e
		trigger = {
			NOT = {
				title:k_pentos.holder = {
					has_variable = ninepenny_king
				}
			}
			character:Nine_Eyes_1 ?= {
				is_in_list = ninepenny_petitioners
			}
		}
		start_war = {
			casus_belli = ninepenny_conquest_cb
			target = title:k_pentos.holder
			claimant = character:Nine_Eyes_1
			target_title = title:k_pentos
		}
	}

	option = { #I'm sick of this
		name = agot_ninepenny.0001.g
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes
	}

	#Ninepenny Kings all join together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = ninepenny_conquest_cb
						using_cb = agot_blackfyre_claim
					}
					is_attacker = root
				}
				add_to_list = ninepenny_wars
			}
		}
		scope:ninepenny_story = {
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = ninepenny_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}

agot_ninepenny.0023 = { #Kings Victorious in Second Conquest
	type = character_event
	title = agot_ninepenny.0023.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { NOT = { exists = scope:ninepenny_king } }
				desc = agot_ninepenny.0023.loner
			}
			desc = agot_ninepenny.0023.desc
		}
	}

	theme = dynasty

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = scope:ninepenny_king
		animation = toast_goblet
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}

		scope:ninepenny_story = {
			random_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
					NOT = { this = root }
				}
				save_scope_as = ninepenny_king
			}
		}
	}

	option = {
		name = agot_ninepenny.0023.a

		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			end_story = yes
		}

		add_prestige_level = 1
	}
}

agot_ninepenny.0024 = { #Kings Lose second Conquest
	type = character_event
	title = agot_ninepenny.0024.t
	desc = agot_ninepenny.0024.desc

	theme = war

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = spymaster
	}

	option = {
		name = agot_ninepenny.0024.a
		custom_tooltip = agot_ninepenny.shatter_band_loss_tooltip

		shatter_band_of_nine_alliances_effect = yes
	}
}

#Post-IT Giving Out Titles
agot_ninepenny.0029 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				has_title = title:k_the_stepstones
				character:Old_Mother_1 = { is_alive = yes }
				NAND = {
					character:Old_Mother_1 = { is_landed = yes }
					character:Old_Mother_1 = { primary_title.tier >= tier_kingdom }
				}
			}
			trigger_event = agot_ninepenny.0030
		}
		else_if = {
			limit = {
				OR = {
					has_title = title:k_the_reach
					any_vassal_or_below = { has_title = title:k_the_reach }
				}
				character:Fossoway_58 = { is_alive = yes }
				NAND = {
					character:Fossoway_58 = { is_landed = yes }
					character:Fossoway_58 = { primary_title.tier >= tier_kingdom }
				}
			}
			trigger_event = agot_ninepenny.0032
		}
		else_if = {
			limit = {
				OR = {
					has_title = title:k_dragonstone
					any_vassal_or_below = { has_title = title:k_dragonstone }
					has_title = title:d_tarth
					any_vassal_or_below = { has_title = title:d_tarth }
				}
				character:Qhoqua_1 = { is_alive = yes }
				NAND = {
					character:Qhoqua_1 = { is_landed = yes }
					character:Qhoqua_1 = { primary_title.tier >= tier_kingdom }
				}
			}
			trigger_event = agot_ninepenny.0034
		}
		else_if = {
			limit = {
				OR = {
					has_title = title:k_disputed_lands
					any_vassal_or_below = { has_title = title:k_disputed_lands }
				}
				character:Butcher_1 = { is_alive = yes }
				NAND = {
					character:Butcher_1 = { is_landed = yes }
					character:Butcher_1 = { primary_title.tier >= tier_kingdom }
				}
			}
			trigger_event = agot_ninepenny.0036
		}
		else_if = {
			limit = {
				OR = {
					AND = {
						NOT = {
							title:k_tyrosh.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Adarys_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_lys.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Saan_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_myr.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Lashare_1 ?= {
							is_alive = yes
						}
					}

					AND = {
						NOT = {
							title:k_pentos.holder ?= {
								has_variable = ninepenny_king
							}
						}
						character:Nine_Eyes_1 ?= {
							is_alive = yes
						}
					}
				}
			}

			trigger_event = agot_ninepenny.0020
		}
	}
}

#Old Mother
agot_ninepenny.0030 = {
	type = character_event
	title = agot_ninepenny.0030.t
	desc = agot_ninepenny.0030.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = character:Old_Mother_1
		animation = war_over_win
	}

	immediate = {
		character:Old_Mother_1 = {
			save_scope_as = old_mother
		}
	}

	option = {
		name = agot_ninepenny.0030.a

		show_as_tooltip = {
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = stepstones_change2
				add_claim_on_loss = no
			}
			title:k_the_stepstones = {
				change_title_holder_include_vassals = {
					holder = character:Old_Mother_1
					change = scope:stepstones_change2
				}
			}
			resolve_title_and_vassal_change = scope:disputed_change2
		}

		hidden_effect = {
			title:k_the_stepstones = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = character:Blackfyre_14
						NOT = { tier = tier_barony }
					}
					add_to_list = stepstones_titles
				}
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = stepstones_change
				add_claim_on_loss = no
			}
			every_in_list = {
				list = stepstones_titles
				change_title_holder = {
					holder = character:Old_Mother_1
					change = scope:stepstones_change
				}
			}
			resolve_title_and_vassal_change = scope:stepstones_change

			title:k_the_stepstones = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder.liege = character:Blackfyre_14
						NOT = { tier = tier_barony }
					}
					add_to_list = stepstones_vassals
				}
			}

			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = stepstones_change_vassals
				add_claim_on_loss = no
			}
			every_in_list = {
				list = stepstones_vassals
				limit = { NOT = { this.holder = character:Blackfyre_14 } }
				this.holder = {
					change_liege = {
						liege = character:Old_Mother_1
						change = scope:stepstones_change_vassals
					}
				}
			}
			resolve_title_and_vassal_change = scope:stepstones_change_vassals
		}

		character:Old_Mother_1 = {
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = yes
			}
			becomes_independent = {
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}

		hidden_effect = {
			#Return Disputed Lands to Maelys
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_lands
				add_claim_on_loss = no
			}

			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = character:Old_Mother_1
						NOT = { tier = tier_barony }
					}

					change_title_holder_include_vassals = {
						holder = character:Blackfyre_14
						change = scope:disputed_lands
					}
				}
			}
			resolve_title_and_vassal_change = scope:disputed_lands
		}

		character:Old_Mother_1 = { trigger_event = agot_ninepenny.0031 }

		trigger_event = agot_ninepenny.0029

		ai_chance = 100
	}

	option = {
		name = agot_ninepenny.0030.b
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes

		ai_chance = 0
	}
}

#Notify Old Mother
agot_ninepenny.0031 = {
	type = character_event
	title = agot_ninepenny.0031.t
	desc = agot_ninepenny.0031.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = scope:maelys
		animation = war_over_win
	}

	immediate = {
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
	}

	option = {
		name = agot_ninepenny.0031.a
		custom_tooltip = agot_ninepenny.0031.a.tt
	}
}

#Fossoway
agot_ninepenny.0032 = {
	type = character_event
	title = agot_ninepenny.0032.t
	desc = agot_ninepenny.0032.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = character:Fossoway_58
		animation = war_over_win
	}

	immediate = {
		character:Fossoway_58 = {
			save_scope_as = bad_apple
		}
	}

	option = {
		name = agot_ninepenny.0032.a

		create_title_and_vassal_change = {
			type = granted
			save_scope_as = reach_change
			add_claim_on_loss = no
		}
		title:c_highgarden = {
			change_title_holder_include_vassals = {
				holder = character:Fossoway_58
				change = scope:reach_change
			}
		}
		title:d_highgarden = {
			change_title_holder_include_vassals = {
				holder = character:Fossoway_58
				change = scope:reach_change
			}
		}
		title:k_the_reach = {
			change_title_holder_include_vassals = {
				holder = character:Fossoway_58
				change = scope:reach_change
			}
		}
		resolve_title_and_vassal_change = scope:reach_change

		hidden_effect = {
			#Return Disputed Lands to Maelys
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_lands
				add_claim_on_loss = no
			}

			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = character:Fossoway_58
						NOT = { tier = tier_barony }
					}

					change_title_holder_include_vassals = {
						holder = character:Blackfyre_14
						change = scope:disputed_lands
					}
				}
			}
			resolve_title_and_vassal_change = scope:disputed_lands

			character:Fossoway_58 = { change_government = lp_feudal_government }
		}

		character:Fossoway_58 = { trigger_event = agot_ninepenny.0033 }

		trigger_event = agot_ninepenny.0029

		ai_chance = 100
	}

	option = {
		name = agot_ninepenny.0032.b
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes

		ai_chance = 0
	}
}

#Notify Fossoway
agot_ninepenny.0033 = {
	type = character_event
	title = agot_ninepenny.0033.t
	desc = agot_ninepenny.0033.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = scope:maelys
		animation = war_over_win
	}

	immediate = {
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
	}

	option = {
		name = agot_ninepenny.0033.a
		custom_tooltip = agot_ninepenny.0033.a.tt
	}
}

#Ebon Prince
agot_ninepenny.0034 = {
	type = character_event
	title = agot_ninepenny.0034.t
	desc = agot_ninepenny.0034.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = character:Qhoqua_1
		animation = war_over_win
	}

	option = {
		name = agot_ninepenny.0034.a

		create_title_and_vassal_change = {
			type = granted
			save_scope_as = dragonstone_change
			add_claim_on_loss = no
		}
		title:c_dragonstone = {
			change_title_holder_include_vassals = {
				holder = character:Qhoqua_1
				change = scope:dragonstone_change
			}
		}
		title:d_dragonstone = {
			change_title_holder_include_vassals = {
				holder = character:Qhoqua_1
				change = scope:dragonstone_change
			}
		}
		title:k_dragonstone = {
			change_title_holder_include_vassals = {
				holder = character:Qhoqua_1
				change = scope:dragonstone_change
			}
		}
		resolve_title_and_vassal_change = scope:dragonstone_change

		hidden_effect = {
			#Return Disputed Lands to Maelys
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_lands
				add_claim_on_loss = no
			}

			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = character:Qhoqua_1
						NOT = { tier = tier_barony }
					}

					change_title_holder_include_vassals = {
						holder = character:Blackfyre_14
						change = scope:disputed_lands
					}
				}
			}
			resolve_title_and_vassal_change = scope:disputed_lands

			character:Qhoqua_1 = { change_government = lp_feudal_government }
		}

		character:Qhoqua_1 = { trigger_event = agot_ninepenny.0035 }

		trigger_event = agot_ninepenny.0029

		ai_chance = 100
	}
	option = {
		name = agot_ninepenny.0034.c
		
		

		hidden_effect = {
			#Return Disputed Lands to Maelys
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_lands
				add_claim_on_loss = no
			}

			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = character:Qhoqua_1
						NOT = { tier = tier_barony }
					}

					change_title_holder_include_vassals = {
						holder = character:Blackfyre_14
						change = scope:disputed_lands
					}
				}
			}
			resolve_title_and_vassal_change = scope:disputed_lands

			character:Qhoqua_1 = { change_government = lp_feudal_government }
		}
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = dragonstone_change
			add_claim_on_loss = no
		}
		hidden_effect = {
			title:c_dragonstone = {
				change_title_holder_include_vassals = {
					holder = root
					change = scope:dragonstone_change
				}
			}
			title:d_dragonstone = {
				change_title_holder_include_vassals = {
					holder = root
					change = scope:dragonstone_change
				}
			}
		}
		
		title:k_dragonstone = {
			change_title_holder_include_vassals = {
				holder = root
				change = scope:dragonstone_change
			}
		}
		resolve_title_and_vassal_change = scope:dragonstone_change

		create_title_and_vassal_change = {
			type = granted
			save_scope_as = tarth_change
			add_claim_on_loss = no
		}
		hidden_effect = {
			title:d_estermont_isles = {
				set_de_jure_liege_title = title:k_tarth
			}
			title:d_estermont_isles.holder = {
				change_liege = {
					liege = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:d_dornish_islands = {
				set_de_jure_liege_title = title:k_tarth
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_wrathrock = {
				set_de_jure_liege_title = title:d_dornish_islands
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_severisles = {
				set_de_jure_liege_title = title:d_dornish_islands
			}
			title:c_severisles.holder = {
				change_liege = {
					liege = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_ghaston_grey = {
				set_de_jure_liege_title = title:d_dornish_islands
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_tallor_islands = {
				set_de_jure_liege_title = title:d_dornish_islands
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_tallor_islands.holder = {
				change_liege = {
					liege = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:c_evenfall = {
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
			title:d_tarth = {
				set_de_jure_liege_title = title:k_tarth
				change_title_holder_include_vassals = {
					holder = character:Qhoqua_1
					change = scope:tarth_change
				}
			}
		}
		
		title:k_tarth = {
			change_title_holder_include_vassals = {
				holder = character:Qhoqua_1
				change = scope:tarth_change
			}
			set_de_jure_liege_title = title:e_the_iron_throne
		}
			
		character:Qhoqua_1 = {
			change_liege = {
				liege = root
				change = scope:tarth_change
			}
			hidden_effect = {
				set_realm_capital = title:c_evenfall
			}
			return_to_court = yes
		}
		resolve_title_and_vassal_change = scope:tarth_change
		hidden_effect = {
			agot_set_legitimate_house = {
				HOUSE = character:Qhoqua_1.house
				TITLE = title:k_tarth
			}
		}
		
		character:Qhoqua_1 = { change_government = lp_feudal_government }

		character:Qhoqua_1 = { trigger_event = agot_ninepenny.0035 }

		trigger_event = agot_ninepenny.0029

		ai_chance = 100
	}

	option = {
		name = agot_ninepenny.0034.b
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes

		ai_chance = 0
	}
}

#Notify Ebon Prince
agot_ninepenny.0035 = {
	type = character_event
	title = agot_ninepenny.0035.t
	desc = agot_ninepenny.0035.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = scope:maelys
		animation = war_over_win
	}

	immediate = {
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
		character:Qhoqua_1 = {
			save_scope_as = the_sapphire_islands_char
		}
	}

	option = {
		name = agot_ninepenny.0035.a
		custom_tooltip = agot_ninepenny.0035.a.tt
		ai_chance = {
			base = 0
			modifier = {
				OR = {
					has_game_rule = ebon_wont
					character:Qhoqua_1 = {
						this = title:k_dragonstone.holder
					}
				}
				add = 100
			}
		}
	}
	option = {
		name = agot_ninepenny.0035.b
		tarth_becomes_the_sapphire_islands_effect = yes
		custom_tooltip = agot_ninepenny.0035.a.tt
		custom_tooltip = agot_ninepenny.0035.b.tt
		ai_chance = {
			base = 0
			modifier = {
				AND = {
					has_game_rule = ebon_will
					character:Qhoqua_1 = {
						this = title:k_tarth.holder
					}
				}
				add = 100
			}
		}
	}
}

#Butcher
agot_ninepenny.0036 = {
	type = character_event
	title = agot_ninepenny.0036.t
	desc = agot_ninepenny.0036.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = character:Butcher_1
		animation = war_over_win
	}

	immediate = {
		character:Butcher_1 = {
			save_scope_as = butcher
		}
	}

	option = {
		name = agot_ninepenny.0036.a

		show_as_tooltip = {
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_change2
				add_claim_on_loss = no
			}
			title:k_disputed_lands = {
				change_title_holder_include_vassals = {
					holder = character:Butcher_1
					change = scope:disputed_change2
				}
			}
			resolve_title_and_vassal_change = scope:disputed_change2
		}

		hidden_effect = {
			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder = title:k_disputed_lands.holder
						NOT = { tier = tier_barony }
					}
					add_to_list = disputed_titles
				}
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = disputed_change
				add_claim_on_loss = no
			}
			every_in_list = {
				list = disputed_titles
				change_title_holder = {
					holder = character:Butcher_1
					change = scope:disputed_change
				}
			}
			resolve_title_and_vassal_change = scope:disputed_change

			title:k_disputed_lands = {
				every_in_de_jure_hierarchy = {
					limit = {
						holder.liege = character:Blackfyre_14
						NOT = { tier = tier_barony }
						NOT = { holder = character:Butcher_1 }
					}
					add_to_list = disputed_vassals
				}
			}

			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = disputed_change_vassals
				add_claim_on_loss = no
			}
			every_in_list = {
				list = disputed_vassals
				limit = { NOT = { this.holder = character:Blackfyre_14 } }
				this.holder = {
					change_liege = {
						liege = character:Butcher_1
						change = scope:disputed_change_vassals
					}
				}
			}
			resolve_title_and_vassal_change = scope:disputed_change_vassals

			character:Butcher_1 = { change_government = feudal_government }
		}

		character:Butcher_1 = {
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = yes
			}
			becomes_independent = {
				change = scope:change
			}
			resolve_title_and_vassal_change = scope:change
		}

		character:Butcher_1 = { trigger_event = agot_ninepenny.0037 }

		trigger_event = agot_ninepenny.0029

		ai_chance = 100
	}

	option = {
		name = agot_ninepenny.0036.b
		custom_tooltip = agot_ninepenny.shatter_band_oathbreaker_tooltip

		shatter_band_of_nine_alliances_effect = yes

		ai_chance = 0
	}
}

#Notify Butcher
agot_ninepenny.0037 = {
	type = character_event
	title = agot_ninepenny.0037.t
	desc = agot_ninepenny.0037.desc

	theme = court

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = war_over_win
	}

	right_portrait = {
		character = scope:maelys
		animation = war_over_win
	}

	immediate = {
		character:Blackfyre_14 = {
			save_scope_as = maelys
		}
	}

	option = {
		name = agot_ninepenny.0037.a
		custom_tooltip = agot_ninepenny.0037.a.tt
	}
}

#Maelys murders baby
agot_ninepenny.0040 = {
	type = character_event
	title = agot_ninepenny.0040.t
	desc = agot_ninepenny.0040.desc

	theme = pregnancy

	left_portrait = {
		character = root
		animation = spymaster
	}

	right_portrait = {
		character = scope:wife
		animation = sadness
	}

	lower_center_portrait = scope:maester

	trigger = {
	}

	immediate = {
		primary_spouse = {
			save_scope_as = wife
		}
		if = {
			limit = {
				employs_court_position = maester_court_position
			}
			random_court_position_holder = {
				type = maester_court_position
				save_scope_as = maester
			}
		}
		else_if = {
			limit = {
				any_courtier_or_guest = {
					has_trait_xp = {
						trait = maester
						value = 100
					}
				}
			}
			random_courtier_or_guest = {
				limit = {
					has_trait_xp = {
						trait = maester
						value = 100
					}
				}
				save_scope_as = maester
			}
		}
		else_if = {
			limit = {
				global_var:citadel_title.holder = {
					any_courtier_or_guest = {
						has_trait_xp = {
							trait = maester
							value = 100
						}
						NOR = {
							has_trait = archmaester
							has_character_flag = maester_researcher
						}
						is_adult = yes
					}
				}
			}
			global_var:citadel_title.holder = {
				random_courtier_or_guest = {
					limit = {
						has_trait_xp = {
							trait = maester
							value = 100
						}
						NOR = {
							has_trait = archmaester
							has_character_flag = maester_researcher
						}
						is_adult = yes
					}
					save_scope_as = maester
					if = {
						limit = {
							has_character_flag = blocked_from_leaving
						}
						remove_character_flag = blocked_from_leaving
					}
				}
			}
		}
		else = {
			create_character = {
				template = maester_character
				employer = root
				save_scope_as = maester
			}
		}
	}

	option = { #Drink this
		name = agot_ninepenny.0040.a

		scope:wife = {
			trigger_event = agot_ninepenny.0041
		}
		ai_chance = 100
	}
	option = { #She can live
		name = agot_ninepenny.0040.b

		ai_chance = 0
	}

	after = {
		if = {
			limit = {
				NOT = { employs_court_position = maester_court_position }
			}
			set_court_physician_effect = {
				EMPLOYER = root
				PHYSICIAN = scope:maester
			}
		}
	}
}

agot_ninepenny.0041 = {
	type = character_event
	title = agot_ninepenny.0041.t
	desc = agot_ninepenny.0041.desc

	theme = pregnancy

	left_portrait = {
		character = root
		animation = worry
	}

	right_portrait = {
		character = scope:maester
		animation = admiration
	}

	lower_center_portrait = scope:helaena

	immediate = {
		primary_spouse = {
			save_scope_as = maelys
		}
		character:Targaryen_66 = {
			save_scope_as = helaena
		}
	}

	option = {
		name = agot_ninepenny.0041.a
		primary_spouse = {
			send_interface_toast = {
				left_icon = root
				title = agot_ninepenny.0041.a.success.tt
				scope:wife = {
					end_pregnancy = yes
					pregnancy_cleanup_effect = yes
				}
			}
		}
		ai_chance = {
			base = 50

			ai_value_modifier = { #Rhaella
				ai_vengefulness = -0.5
				ai_boldness = -0.5
				ai_honor = 0.5
			}
		}
	}

	option = {
		name = agot_ninepenny.0041.b
		death = {
			death_reason = death_suicide
		}
		scope:maelys = {
			trigger_event = agot_ninepenny.0042
		}
		ai_chance = {
			base = 50

			ai_value_modifier = { #Shaera prob kills herself
				ai_vengefulness = 0.5
				ai_boldness = 0.5
				ai_rationality = -0.5
			}
		}
	}
}

agot_ninepenny.0042 = {
	type = character_event
	title = agot_ninepenny.0042.t
	desc = agot_ninepenny.0042.desc

	theme = death
	override_background = {
		reference = bedchamber
	}

	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:maester
		animation = fear
	}

	lower_center_portrait = scope:wife

	immediate = {
		scope:wife = {
			death = {
				death_reason = death_suicide
			}
		}
		add_tyranny = major_tyranny_gain
	}

	option = {
		name = agot_ninepenny.0042.a
		add_stress = major_stress_gain
	}

	option = {
		name = agot_ninepenny.0042.b

		scope:maester = {
			hard_imprison_character_effect = {
				TARGET = this
				IMPRISONER = root
			}
		}
	}

	after = { #This is bad PR
		add_prestige_level = -1
	}
}

#Robb Reyne Remembrance Event
agot_ninepenny.0050 = {
	type = character_event
	title = agot_ninepenny.0050.t
	desc = agot_ninepenny.0050.desc

	theme = dynasty

	left_portrait = {
		character = root
		animation = worry
	}

	right_portrait = {
		character = scope:robb
		animation = personality_zealous
	}

	lower_right_portrait = scope:throne

	lower_left_portrait = scope:maelys

	trigger = {
		title:e_blackfyre_rebellion.holder ?= {
			any_character_war = {
				primary_defender = title:e_the_iron_throne.holder
			}
			NOT = {
				any_war_ally = { this = root }
			}
		}
	}

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		title:e_the_iron_throne.holder = {
			save_scope_as = throne
		}
		title:e_blackfyre_rebellion.holder = {
			save_scope_as = maelys
		}
		character:Reyne_43 = {
			save_scope_as = robb
		}
	}

	option = { #Join the Blackfyres
		name = agot_ninepenny.0050.a
		agot_mw_join_rebels_effect = { RULER = root REBEL_LEADER = scope:maelys }
	}
	option = {
		name = agot_ninepenny.0050.b
	}
}

#Maenar
agot_ninepenny.0060 = { #Saan Approaches Maelys with Valyrian Scrolls
	type = character_event
	title = agot_ninepenny.0060.t
	desc = agot_ninepenny.0060.desc

	theme = dragon

	override_background = {
		reference = fp1_ocean
	}

	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:saan
		animation = throne_room_messenger_3
	}

	artifact = {
		trigger = { exists = scope:newly_created_artifact }
		target = scope:newly_created_artifact
		position = lower_center_portrait
	}

	trigger = {
		character:Saan_1 = { is_alive = yes }
		any_character_artifact = {
			has_variable = dragon_egg
		}
	}

	immediate = {
		character:Saan_1 = {
			save_scope_as = saan
		}
		character:Blackfyre_15 = {
			save_scope_as = maenar
		}

		hidden_effect = {
			character:Saan_1 = {
				agot_create_artifact_saans_scrolls_effect = { OWNER = character:Saan_1 }
			}
		}

		show_as_tooltip = {
			character:Blackfyre_14 = {
				agot_create_artifact_saans_scrolls_effect = { OWNER = character:Blackfyre_14 }
			}
		}

		scope:newly_created_artifact = {
			set_variable = {
				name = suppress_artifact_notifications
				value = yes
				days = 1
			}
			set_variable = {
				name = gifted_artifact
				value = yes
				days = 1825
			}
			set_owner = {
				target = character:Blackfyre_14
				history = {
					location = character:Blackfyre_14.location
					actor = character:Saan_1
					recipient = character:Blackfyre_14
					type = given
				}
			}
			save_scope_as = gifted_artifact
		}
	}

	option = { #Burn my son alive poggers
		name = agot_ninepenny.0060.a
		custom_tooltip = agot_ninepenny.0060.a.tt

		trigger = {
			character:Blackfyre_15 ?= {
				is_alive = yes
			}
		}

		trigger_event = agot_ninepenny.0061

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
			modifier = {
				has_game_rule = maelys_will
				add = 100
			}
			modifier = {
				has_game_rule = maelys_wont
				factor = 0
			}
		}
	}

	option = { #Thanks 4 scrolls bro
		name = agot_ninepenny.0060.b
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.0061 = { #Maelys sets his son up in flames
	type = character_event
	title = agot_ninepenny.0061.t
	desc = agot_ninepenny.0061.desc

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	left_portrait = {
		character = root
		animation = personality_callous
	}

	right_portrait = {
		character = scope:saan
		animation = throne_room_messenger_3
	}

	lower_center_portrait = scope:maenar

	immediate = {
		random_owned_story = {
			limit = {
				story_type = story_agot_ninepenny_kings
			}
			save_scope_as = ninepenny_story
		}
		character:Saan_1 = {
			save_scope_as = saan
		}
		character:Blackfyre_15 = {
			save_scope_as = maenar
		}
		random_character_artifact = {
			limit = { has_variable = dragon_egg }
			set_variable = {
				name = selected_egg_for_hatching
				value = yes
			}
			save_scope_as = egg
		}
	}

	option = { #Burn my son alive poggers
		name = agot_ninepenny.0061.a
		custom_tooltip = agot_ninepenny.0061.a.tt

		character:Blackfyre_15 = { save_scope_as = sacrifice }

		hidden_effect = {
			if = {
				limit = { has_game_rule = maelys_guaranteed }
				save_scope_as = dragon_hatched
			}
			else = {
				random = {
					chance = 15
					modifier = {
						has_game_rule = agot_story_historical_events_weighted_outcomes
						factor = 0.5
					}
					modifier = {
						has_game_rule = agot_story_historical_events_historical_outcomes
						factor = 0
					}
					modifier = {
						has_game_rule = maelys_very_likely
						factor = 5
					}
					modifier = {
						has_game_rule = maelys_not
						factor = 0
					}
					save_scope_as = dragon_hatched
				}
			}
			
			if = {
				limit = { exists = scope:dragon_hatched }
				trigger_event = agot_ninepenny.9000
			}
			else = {
				random_list = {
					1 = { }
					1 = { add_character_flag = agot_ninepenny.0062.rage }
				}
				trigger_event = agot_ninepenny.0062
			}
		}
	}
}

agot_ninepenny.0062 = {
	type = character_event
	title = agot_ninepenny.0062.t
	desc = {
		desc = agot_ninepenny.0062.desc
		first_valid = {
			triggered_desc = {
				trigger = { has_character_flag = agot_ninepenny.0062.rage }
				desc = agot_ninepenny.0062.rage
			}
			desc = agot_ninepenny.0062.sad
		}
	}

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { has_character_flag = agot_ninepenny.0062.rage }
			animation = rage
		}
		animation = personality_callous
	}

	lower_center_portrait = scope:maenar

	immediate = {
		every_character_artifact = {
			limit = {
				has_variable = dragon_egg
			}
			root = { destroy_owned_artifact = prev }
		}

		scope:maenar = {
			death = {
				death_reason = death_hatching_sacrifice
				killer = root
			}
		}
	}

	option = {
		name = agot_ninepenny.0062.a

		add_stress = major_stress_gain

		random_list = {
			60 = { }
			20 = {
				add_trait = fire_obsessed
			}
			10 = {
				add_trait = possessed_1
			}
			10 = {
				add_trait = lunatic_1
			}
		}
	}
}

agot_ninepenny.0063 = {
	type = character_event
	title = agot_ninepenny.0063.t
	desc = agot_ninepenny.0063.desc

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	left_portrait = {
		character = root
		animation = ecstasy
	}

	lower_center_portrait = scope:maenar

	right_portrait = {
		character = scope:maelys_dragon
		animation = dragon_main
		camera = camera_dragon_event_standing

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}
	immediate = {
		scope:maenar = {
			death = {
				death_reason = death_hatching_sacrifice
				killer = root
			}
		}
		every_character_artifact = { # Destroy other eggs too
			limit = {
				has_variable = dragon_egg
				NOT = { has_variable = selected_egg_for_hatching }
			}
			root = { destroy_owned_artifact = prev }
		}
		every_in_list = {
			list = hatched_dragons
			save_scope_as = dragon
			custom_tooltip = dragon_has_hatched_tt
		}
	}

	option = {
		name = agot_ninepenny.0063.a

		add_prestige = 10000

		random_list = {
			20 = { }
			60 = {
				add_trait = fire_obsessed
			}
			10 = {
				add_trait = possessed_1
			}
			10 = {
				add_trait = lunatic_1
			}
		}

		# Inform players what happened
		save_scope_as = maelys
		every_player = {
			limit = {
				NOT = {
					this = root
					this = character:Targaryen_122
				}
			}
			trigger_event = agot_ninepenny.0064
		}

		character:Targaryen_122 = {
			trigger_event = agot_ninepenny.0065
		}
	}
}

agot_ninepenny.0064 = {
	type = character_event
	title = agot_ninepenny.0064.t
	desc = agot_ninepenny.0064.desc

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	left_portrait = {
		character = scope:maelys
		animation = ecstasy
	}

	right_portrait = {
		character = scope:dragon
		animation = dragon_main
		camera = camera_dragon_event_standing_baby

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	option = {
		name = {
			text = agot_ninepenny.0064.a.maelys_positive
			trigger = {
				opinion = {
					target = scope:maelys
					value > 0
				}
			}
		}
		name = {
			text = agot_ninepenny.0064.a.maelys_negative
			trigger = {
				opinion = {
					target = scope:maelys
					value < 0
				}
			}
		}
	}
}

agot_ninepenny.0065 = {
	type = character_event
	title = agot_ninepenny.0065.t
	desc = agot_ninepenny.0065.desc

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	left_portrait = {
		character = scope:maelys
		animation = ecstasy
	}

	right_portrait = {
		character = scope:dragon
		animation = dragon_main
		camera = camera_dragon_event_standing_baby

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	option = {
		name = agot_ninepenny.0065.a
		remove_trait = compassionate
		add_trait_force_tooltip = callous
		ai_chance = {
			base = 100
		}
	}

	option = {
		name = agot_ninepenny.0065.b
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}
		random = {
			chance = 50
			add_trait = depressed_1
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			every_in_list = {
				variable = summerhall_attendees
				remove_character_flag = planning_an_activity
				remove_variable = booked_for_a_party
			}
			set_variable = {
				name = summerhall
				value = flag:negative
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#Duncan
agot_ninepenny.0070 = { #Dunk Deserts
	hidden = yes

	trigger = {
		character:Tall_1 = { is_alive = yes }
		character:Tall_1 = { has_trait = kingsguard }
	}

	immediate = {
		agot_remove_kingsguard_effect = { KINGSGUARD = character:Tall_1 }
		character:Tall_1 = {
			random_county_in_region = {
				region = world_essos
				title_province = {
					save_scope_as = exile_title
				}
			}
			move_to_pool_at = scope:exile_title
		}
	}
}

# Egg Start Event - First Great-Grandchild
agot_ninepenny.1000 = {
	type = character_event
	title = agot_ninepenny.1000.t
	desc = agot_ninepenny.1000.desc

	theme = court
	left_portrait = root
	right_portrait = {
		character = character:Targaryen_126 #Duncan the Small
		animation = admiration
	}
	lower_center_portrait = character:Targaryen_127 #Jaeherys II
	lower_right_portrait = character:Targaryen_1 #Aerys II
	lower_left_portrait = character:Targaryen_2 #Rhaella


	trigger = {
	}

	immediate = {
		character:Targaryen_126 = {
			save_scope_as = duncan
		}
		character:Targaryen_2 = { # Rhaella
			save_scope_as = rhaella
			add_trait = pregnant
			set_variable = {
				name = agot_fated_pregnancy_months
				value = 0
			}
		}
		character:Targaryen_1 = {
			save_scope_as = aerys
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			save_scope_as = summerhall_story
		}
	}

	option = { #Commit to Summerhall
		name = agot_ninepenny.1000.a

		random_owned_story = { #Catastrophe averted
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = summerhall
				value = flag:positive
			}
		}
		#Save Up Summerhall Attendees
		scope:summerhall_story = {
			set_variable = {
				name = summerhall
				value = flag:positive
			}

			every_in_list = {
				variable = summerhall_attendees
				limit = { NOT = { this = root } }
				trigger_event = agot_ninepenny.1024
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_chain_outcome
			}
		}
	}

	option = { #Let us not go to Summerhall, 'tis a silly place
		name = agot_ninepenny.1000.b
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}

		random_owned_story = { #Catastrophe averted
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = summerhall
				value = flag:negative
			}

			every_in_list = {
				variable = summerhall_attendees
				remove_character_flag = planning_an_activity
				remove_variable = booked_for_a_party
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_chain_outcome
			}
		}
	}
}

agot_ninepenny.1001 = {
	hidden = yes

	immediate = {
		remove_trait = pregnant
		remove_variable = agot_fated_pregnancy_months
		create_character = {
			age = 0
			random_traits = no
			father = character:Targaryen_1
			mother = character:Targaryen_2
			trait = beauty_good_3
			trait = intellect_good_2
			location = root.location
			gender_female_chance = {
				value = agot_canon_children_male_female_chance
			}
			faith = root.faith
			culture = root.culture
			save_scope_as = child
		}
		hidden_effect = {
			scope:child = {
				if = {
					limit = { is_male = yes }
					change_first_name = "Rhaegar"
				}
				if = {
					limit = { is_female = yes }
					change_first_name = "Rhaenyra"
				}
				copy_inheritable_appearance_from = character:Dummy_Targaryen_3
				set_house = character:Targaryen_2.house
				make_trait_inactive = is_targaryen_3
				add_character_flag = has_scripted_appearance
				make_trait_inactive = cool_silver_hair
				make_trait_inactive = purple_eyes_1
			}
		}

		character:Targaryen_2 = {
			save_scope_as = mother
			add_character_flag = {
				flag = birth_will_go_smoothly
				days = 100
			}
			if = {
				limit = {
					NOT = {
						any_child = {
							even_if_dead = yes
							NOT = {
								this = scope:child
							}
						}
					}
				}
				create_character_memory = {
					type = first_born
					participants = {
						child = scope:child
					}
				}
			}
			else = {
				if = {
					limit = { exists = scope:child_2 }
					create_character_memory = {
						type = twins_born
						participants = {
							child = scope:child
							child_2 = scope:child_2
						}
					}
				}
				else = {
					create_character_memory = {
						type = child_born
						participants = {
							child = scope:child
						}
					}
				}
			}
		}

		character:Targaryen_1 = {
			save_scope_as = real_father
			if = {
				limit = {
					NOT = {
						any_child = {
							even_if_dead = yes
							NOT = {
								this = scope:child
							}
						}
					}
				}
				create_character_memory = {
					type = first_born
					participants = {
						child = scope:child
					}
				}
			}
			else = {
				if = {
					limit = { exists = scope:child_2 }
					create_character_memory = {
						type = twins_born
						participants = {
							child = scope:child
							child_2 = scope:child_2
						}
					}
				}
				else = {
					create_character_memory = {
						type = child_born
						participants = {
							child = scope:child
						}
					}
				}
			}
		}

		root = {
			trigger_event = birth.0001
		}
	}
}

#Pyromancer on Summerhall
agot_ninepenny.1002 = {
	type = character_event
	title = agot_ninepenny.1002.t
	desc = agot_ninepenny.1002.desc

	theme = dragon
	left_portrait = {
		character = root
		animation = stress
	}
	right_portrait = {
		character = scope:pyromancer
		animation = scheme
	}


	trigger = {
	}

	immediate = {
		character:Targaryen_119 = {
			save_scope_as = aerion
		}
		create_character = {
			template = pyromancer_character
			save_scope_as = pyromancer
			employer = root
		}
		hidden_effect = {
			character:Pyromancer_1 = { #Rossart
				set_relation_guardian = scope:pyromancer
			}
			add_courtier = character:Pyromancer_1
		}
		random_owned_story = { #Hold onto the pyromancer for the tragedy
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = pyromancer
				value = scope:pyromancer
			}
		}
	}

	option = { #This Fire is out of CONTROL
		name = agot_ninepenny.1002.a
	}
}

#Summerhall Arrival
agot_ninepenny.1003 = {
	type = character_event
	title = agot_ninepenny.1003.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					character:Targaryen_2 = { is_alive = no }
				}
				desc = agot_ninepenny.1003.desc.rhae_dead
			}
			triggered_desc = {
				trigger = {
					root = character:Targaryen_122
				}
				desc = agot_ninepenny.1003.desc.egg
			}
			triggered_desc = {
				trigger = {
					root = character:Targaryen_127
				}
				desc = agot_ninepenny.1003.desc.jae
			}
			triggered_desc = {
				trigger = {
					root = character:Targaryen_1
				}
				desc = agot_ninepenny.1003.desc.aerys
			}
			desc = agot_ninepenny.1003.desc.fallback
		}
	}

	theme = dynasty
	override_background = {
		reference = courtyard
	}
	left_portrait = {
		character = root
		animation = toast_goblet
	}
	right_portrait = {
		character = character:Targaryen_2
		trigger = {
			character:Targaryen_2 = { is_alive = yes }
			NOT = { root = character:Targaryen_2 }
		}
		animation = scheme
	}

	immediate = {
		play_music_cue = "mood_jennyofoldstones"

		title:b_summerhall.title_province = {
			save_scope_as = summerhall
		}
		character:Targaryen_122 = {
			save_scope_as = egg
		}
		character:Targaryen_127 = {
			save_scope_as = jae
		}
		character:Targaryen_1 = {
			save_scope_as = aerys
		}
		character:Targaryen_2 = {
			save_scope_as = rhaella
		}
		if = {
			limit = {
				is_ai = no
			}
			pan_camera_to_title = title:b_summerhall
		}
		save_scope_as = summerhall_leader

		random_owned_story = { #Pyromancer
			limit = {
				story_type = story_agot_summerhall
			}

			save_scope_as = summerhall_story

			var:pyromancer = {
				save_scope_as = pyromancer
			}
			set_variable = {
				name = arrived
				value = flag:positive
			}
		}

		every_in_list = {
			list = summerhall_attendees
			limit = { is_alive = yes }
			set_location = {
				location = scope:summerhall
				stick_to_location = yes
			}
			scope:summerhall_story = {
				add_to_variable_list = {
					name = summerhall_attendees
					target = prev
				}
			}
		}

	}

	option = {
		name = agot_ninepenny.1003.a

		show_as_tooltip = {
			every_in_list = {
				list = summerhall_attendees
				limit = { is_alive = yes }
				custom_tooltip = {
					save_scope_as = attendee
					text = going_to_summerhall
					set_location = {
						location = scope:summerhall
						stick_to_location = yes
					}
				}
			}
		}
		trigger_event = agot_ninepenny.1004
	}
}

#Corso Begs Egg not to do it
agot_ninepenny.1004 = {
	type = character_event
	title = agot_ninepenny.1004.t
	desc = agot_ninepenny.1004.desc

	theme = dragon
	override_background = {
		reference = courtyard
	}
	left_portrait = {
		character = scope:beseecher
		animation = beg
	}
	right_portrait = {
		character = scope:pyromancer
		animation = schadenfreude
	}
	lower_center_portrait = { character = root }

	immediate = {
		if = {
			limit = {
				character:Maester_Kings_Landing_1 = {
					is_alive = yes
				}
			}
			character:Maester_Kings_Landing_1 = {
				save_scope_as = beseecher
			}
		}

		if = {
			limit = {
				OR = {
					NOT = {
						exists = scope:pyromancer  #Just in case he died or something weird
					}
					scope:pyromancer = { is_alive = no }
				}
			}
			create_character = {
				template = pyromancer_character
				employer = root
				save_scope_as = pyromancer
			}
		}
	}

	option = { #We have gone too far to turn back now
		name = agot_ninepenny.1004.a
		trigger_event = agot_ninepenny.1005

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_chain_outcome
			}
		}
	}
	option = { #Last chance saloon
		name = agot_ninepenny.1004.b
		trigger = { NOT = { has_trait = callous } }
		trigger_event = agot_ninepenny.1011
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_chain_outcome
			}
		}
	}
}

#Begin the Ceremony
agot_ninepenny.1005 = {
	type = character_event
	title = agot_ninepenny.1005.t
	desc = {
		desc = agot_ninepenny.1005.desc
	}

	theme = dragon
	override_background = {
		reference = corridor_night
	}
	left_portrait = {
		character = root
		animation = dismissal
	}
	right_portrait = {
		character = scope:pyromancer
		animation = ecstasy
	}
	lower_left_portrait = {
		character = scope:duncan_alive
	}
	lower_right_portrait = {
		character = scope:rhaella_alive
	}

	immediate = {
		if = {
			limit = {
				character:Targaryen_126 = {
					is_alive = yes
				}
			}
			character:Targaryen_126 = {
				save_scope_as = duncan_alive
			}
		}
		if = {
			limit = {
				character:Targaryen_2 = {
					is_alive = yes
					NOT = { this = root }
				}
			}
			character:Targaryen_2 = {
				save_scope_as = rhaella_alive
			}
		}
	}

	option = {
		name = agot_ninepenny.1005.blood
		trigger = {
			NOT = { has_trait = callous }
		}
		increase_wounds_no_death_effect = { REASON = hatching_sacrifice }
		trigger_event = agot_ninepenny.9100

		ai_chance = { #So he doesn't get kinslayer/public murder in strict historical
			base = 0
			modifier = {
				has_game_rule = agot_story_historical_events_historical_outcomes
				add = 100
			}
		}
	}

	option = {
		name = agot_ninepenny.1005.self

		save_scope_as = sacrifice
		primary_heir = {
			trigger_event = {
				id = agot_ninepenny.9100
				days = 1
			}
		}

		death = {
			death_reason = death_hatching_sacrifice
		}
	}

	option = {
		name = agot_ninepenny.1005.duncan
		trigger = {
			NOT = { root = character:Targaryen_126 }
			character:Targaryen_126 = { is_alive = yes }
		}
		character:Targaryen_126 = {
			death = {
				death_reason = death_hatching_sacrifice
				killer = root
			}
			save_scope_as = sacrifice
		}
		stress_impact = {
			base = medium_stress_impact_gain
			compassionate = massive_stress_impact_gain
		}
		add_kinslayer_trait_or_nothing_effect = { VICTIM = character:Targaryen_126 }
		trigger_event = agot_ninepenny.9100
	}

	option = {
		name = agot_ninepenny.1005.rhaella
		trigger = {
			NOT = { root = character:Targaryen_2 }
			character:Targaryen_2 = { is_alive = yes }
		}
		character:Targaryen_2 = {
			death = {
				death_reason = death_hatching_sacrifice
				killer = root
			}
			save_scope_as = sacrifice
		}
		stress_impact = {
			base = medium_stress_impact_gain
			compassionate = massive_stress_impact_gain
		}
		add_kinslayer_trait_or_nothing_effect = { VICTIM = character:Targaryen_2 }
		trigger_event = agot_ninepenny.9100
	}
}

#The Blaze Erupts
agot_ninepenny.1006 = {
	type = character_event
	title = agot_ninepenny.1006.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = character:Targaryen_122
				}
				desc = agot_ninepenny.1006.egg_main
			}
			desc = agot_ninepenny.1006.main_fallback
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					root = character:Targaryen_122
					character:Tall_1 = { is_alive = yes }
				}
				desc = agot_ninepenny.1006.dunc_egg
			}
			desc = agot_ninepenny.1006.fallback
		}
	}

	theme = dragon
	override_background = {
		reference = burning_building
	}
	left_portrait = {
		character = root
		animation = pain
	}
	right_portrait = {
		character = scope:saviour
		animation = map_rage
	}
	lower_left_portrait = {
		character = character:Targaryen_2
		trigger = { NOT = { root = character:Targaryen_2 } }
	}
	lower_right_portrait = character:Targaryen_126

	immediate = {
		if = { #Grab Duncan
			limit = {
				character:Tall_1 = {
					is_alive = yes
				}
			}
			character:Tall_1 = {
				save_scope_as = saviour
				remove_from_list = summerhall_attendees #so he can die in the next event
			}
		}
		else = { #Likely Gerold Hightower or Neveryield Norcross - Both good candidates to be the saviour
			random_councillor = {
				limit = {
					has_council_position = kingsguard_lord_commander
				}
				save_scope_as = saviour
			}
		}

		primary_heir = {
			save_scope_as = heir
		}

		if = {
			limit = {
				character:Targaryen_126 = {
					is_alive = yes
				}
			}
			character:Targaryen_126 = {
				save_scope_as = duncan
			}
		}
		character:Targaryen_2 = {
			save_scope_as = rhaella
		}

		every_character_artifact = {
			limit = {
				has_variable = dragon_egg
				has_variable = agot_artifact_cannot_gift
			}
			root = { destroy_owned_artifact = prev }
		}
	}

	option = { #Save Rhaella!
		name = agot_ninepenny.1006.a

		trigger = {
			character:Targaryen_2 = { is_alive = yes }
			NOT = { this = character:Targaryen_2 }
		}

		show_as_tooltip = {
			death = {
				death_reason = death_burned
			}
		}
		set_local_variable = heir_saved

		primary_heir = { #Jaeherys II in all liklihood - Possibly Aerys II
			remove_from_list = summerhall_attendees
			add_to_list = summerhall_survivors
			every_spouse = { #Shaera
				remove_from_list = summerhall_attendees
				add_to_list = summerhall_survivors
			}
		}
		character:Targaryen_2 = { #She has to be alive for us to be here
			remove_from_list = summerhall_attendees
			add_to_list = summerhall_survivors
		}
		if = {
			limit = {
				character:Targaryen_1 = { #Aerys II
					is_alive = yes
				}
			}
			character:Targaryen_1 = {
				remove_from_list = summerhall_attendees
				add_to_list = summerhall_survivors
			}
		}

		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root } #Egg's Tooltip handled by show tooltip
				is_alive = yes
			}
			trigger_event = agot_ninepenny.1101
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}

		hidden_effect = {
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #Save Duncan!
		name = agot_ninepenny.1006.b

		show_as_tooltip = {
			death = {
				death_reason = death_burned
			}
		}

		set_local_variable = duncan_saved

		trigger = {
			character:Targaryen_126 = {
				is_alive = yes
			}
		}

		character:Targaryen_126 = {
			save_scope_as = duncan
			remove_from_list = summerhall_attendees
			add_to_list = summerhall_survivors
			every_spouse = { #Jenny of the Oldstones
				remove_from_list = summerhall_attendees
				add_to_list = summerhall_survivors
			}
		}

		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root } #Egg's Tooltip handled by show tooltip
				is_alive = yes
			}
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}

		hidden_effect = {
			character:Targaryen_126 = { #Last male son, Duncan takes the throne
				remove_trait = disinherited
			}
			clear_designated_heir = yes #force heir to recalculate
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}

	option = { #Save me!
		name = agot_ninepenny.1006.c

		trigger = {
			NOT = { this = character:Targaryen_2 }
		}

		stress_impact = {
			base = 500
		}
		every_spouse = {
			remove_from_list = summerhall_attendees
			add_to_list = summerhall_survivors
		}
		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root } #Egg's Tooltip handled by show tooltip
				is_alive = yes
			}
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}
		#AI Should probably never do this since it leads to Targ extinction and is incredibly out of character
		ai_chance = {
			base = 0
		}
	}

	option = { #Queen Rhaella saves self
		name = agot_ninepenny.1006.d

		trigger = {
			this = character:Targaryen_2
		}

		character:Targaryen_2 = {
			remove_from_list = summerhall_attendees
			add_to_list = summerhall_survivors
		}

		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root } #Egg's Tooltip handled by show tooltip
				is_alive = yes
			}
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}

		ai_chance = {
			base = 100
		}
	}

	after = {
		if = { #Needs to be in the AFTER so Jaeherys gets the event once the player has taken control of him
			limit = {
				has_local_variable = heir_saved
			}
			scope:heir = {
				trigger_event = agot_ninepenny.1007
			}
		}
		else_if = { #Egg saved Duncan
			limit = {
				has_local_variable = duncan_saved
			}
			save_scope_as = old_ruler
			scope:duncan = {
				trigger_event = agot_ninepenny.1008
			}
		}
		else_if = {
			limit = {
				this = character:Targaryen_2
			}
			trigger_event = agot_ninepenny.1007
		}
		else = { #Egg saves himself - what a bitch
			trigger_event = agot_ninepenny.1009
		}
	}
}

#Jaeherys/Aerys Survived - Rhaella gives birth to Rhaegar
agot_ninepenny.1007 = {
	type = character_event
	title = agot_ninepenny.1007.t
	desc = agot_ninepenny.1007.desc

	theme = dragon
	override_background = {
		reference = burning_building
	}

	left_portrait = {
		character = root
		animation = grief
		trigger = { NOT = { root = character:Targaryen_2} }
	}

	right_portrait = {
		character = character:Targaryen_2
		animation = poison
	}

	lower_left_portrait = scope:rhaegar.father

	lower_center_portrait = scope:rhaegar

	lower_right_portrait = scope:shaera

	trigger = {

	}

	immediate = {
		scope:saviour = { #Dashes back into the flames, dies
			death = {
				death_reason = death_burned # Summerhall
				killer = character:Targaryen_122
			}
		}
		character:Targaryen_2 = {
			save_scope_as = rhaella
		}
		character:Targaryen_122 = {
			save_scope_as = egg
		}
		character:Targaryen_119 = {
			save_scope_as = aerion
		}
		create_character = {
			age = 0
			random_traits = no
			trait = beauty_good_3
			trait = intellect_good_2
			father = character:Targaryen_1
			mother = character:Targaryen_2
			location = root.location
			gender_female_chance = {
				value = agot_canon_children_male_female_chance
			}
			faith = root.faith
			culture = root.culture
			save_scope_as = rhaegar
		}
		#Repurpose into Azor Ahai Story Cycle later
		hidden_effect = {
			scope:rhaegar = {
				trigger_event = {
					id = agot_events_generic.0020
					days = 2500
				}
			}
		}
		hidden_effect = {
			scope:rhaegar = {
				if = {
					limit = { is_male = yes }
					change_first_name = "Rhaegar"
				}
				if = {
					limit = { is_female = yes }
					change_first_name = "Rhaenyra"
				}
				copy_inheritable_appearance_from = character:Dummy_Targaryen_3
				set_house = character:Targaryen_2.house
				make_trait_inactive = is_targaryen_3
				add_character_flag = has_scripted_appearance
				make_trait_inactive = cool_silver_hair
				make_trait_inactive = purple_eyes_1
			}
		}
		character:Targaryen_2 = {
			remove_trait = pregnant
			remove_variable = agot_fated_pregnancy_months
		}
		primary_spouse = {
			save_scope_as = shaera
		}
	}

	option = { #Holy Shit this is INSANE
		name = agot_ninepenny.1007.a
		flavor = agot_ninepenny.1007.a.tt
		hidden_effect = {
			root = {
				add_courtier = scope:rhaegar
			}
			scope:rhaegar = { #replace with prince that was promised story cycle later
				education_point_acquisition_effect = yes
				education_point_acquisition_effect = yes
			}
		}
	}

	after = {
		trigger_event = agot_ninepenny.1010
	}
}

#Duncan and Jenny Survived
agot_ninepenny.1008 = {
	type = character_event
	title = agot_ninepenny.1008.t
	desc = agot_ninepenny.1008.desc

	theme = dragon
	override_background = {
		reference = burning_building
	}

	left_portrait = {
		character = root
		animation = sadness
	}

	right_portrait = {
		character = scope:jenny
		animation = grief
	}

	lower_center_portrait = scope:saviour

	trigger = {
	}

	immediate = {
		scope:saviour ?= { #Dashes back into the flames, dies
			death = {
				death_reason = death_burned # Summerhall
				killer = root.father
			}
		}
		character:Targaryen_hh_10 = {
			save_scope_as = jenny
		}
		root.father = {
			save_scope_as = egg
		}
	}

	option = { #Holy Shit this is INSANE
		name = agot_ninepenny.1008.a
		decrease_crown_authority_effect = yes
	}

	after = {
		trigger_event = agot_ninepenny.1010
	}
}

#Egg Flees
agot_ninepenny.1009 = {
	type = character_event
	title = agot_ninepenny.1009.t
	desc = agot_ninepenny.1009.desc

	theme = dragon
	override_background = {
		reference = burning_building
	}

	left_portrait = {
		character = root
		animation = shame
	}

	right_portrait = {
		character = scope:saviour
		animation = rage
	}

	lower_left_portrait = scope:duncan

	lower_center_portrait = character:Targaryen_2

	lower_right_portrait = scope:heir

	trigger = {
	}

	immediate = {
	}

	option = { #Holy Shit this is INSANE
		name = agot_ninepenny.1009.a
		scope:saviour ?= { #Dashes back into the flames, dies
			death = {
				death_reason = death_burned # Summerhall
				killer = root
			}
		}
	}

	option = { #I command you to stay by my side!
		name = agot_ninepenny.1009.b
		#Duncan Hate
	}

	after = {
		trigger_event = agot_ninepenny.1010
	}
}

agot_ninepenny.1010 = { #Summerhall Wrapup
	type = character_event
	title = agot_ninepenny.1010.t
	desc = agot_ninepenny.1010.desc

	theme = dragon

	override_background = {
		reference = agot_iron_throne
	}

	left_portrait = {
		character = root
		animation = shame
	}

	immediate = {
		#Summerhall is now a Ruin
		custom_description = {
			text = agot_ruinized_summerhall_effect_desc
			agot_ruinise_title_effect = { TITLE = title:b_summerhall }
			title:b_summerhall.title_province = {
				remove_building = agot_summerhall_01
				remove_building = medium_ruin_01
				add_building = large_ruin_01
				add_building = ruin_renowned_01
				add_special_building = agot_summerhall_ruins_01
				add_travel_point_of_interest = agot_poi_dragonlore
			}
		}

		hidden_effect = {
			every_character_artifact = {
				limit = {
					has_variable = dragon_egg
					has_variable = agot_artifact_cannot_gift
				}
				root = { destroy_owned_artifact = prev }
			}
		}
		custom_tooltip = all_eggs_destroyed_tt
	}

	option = {
		name = agot_ninepenny.1010.a

		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			end_story = yes
		}

		every_vassal_or_below = { #Inform Players of what occured at Summerhall
			limit = {
				is_ai = no
			}
			trigger_event = agot_ninepenny.1023
		}
	}
}

#Decides not to burn, Rhaella gives birth happy ending
agot_ninepenny.1011 = {
	type = character_event
	title = agot_ninepenny.1011.t
	desc = agot_ninepenny.1011.desc

	theme = dragon
	override_background = { reference = bp2_courtyard }

	left_portrait = {
		character = root
		animation = toast_goblet
	}

	right_portrait = {
		character = root.player_heir
		animation = drink_goblet
	}

	lower_left_portrait = scope:rhaegar.father

	lower_center_portrait = scope:rhaegar

	lower_right_portrait = scope:rhaella

	immediate = {
		if = {
			limit = {
				character:Targaryen_2 = { is_alive = yes }
			}
			character:Targaryen_2 = {
				save_scope_as = rhaella
			}
			create_character = {
				age = 0
				random_traits = no
				father = character:Targaryen_1
				mother = character:Targaryen_2
				trait = beauty_good_3
				trait = intellect_good_2
				location = root.location
				gender_female_chance = {
					value = agot_canon_children_male_female_chance
				}
				faith = root.faith
				culture = root.culture
				save_scope_as = rhaegar
			}
			hidden_effect = {
				scope:rhaegar = {
					if = {
						limit = { is_male = yes }
						change_first_name = "Rhaegar"
					}
					if = {
						limit = { is_female = yes }
						change_first_name = "Rhaenyra"
					}
					copy_inheritable_appearance_from = character:Dummy_Targaryen_3
					set_house = character:Targaryen_2.house
					make_trait_inactive = is_targaryen_3
					add_character_flag = has_scripted_appearance
					make_trait_inactive = cool_silver_hair
					make_trait_inactive = purple_eyes_1
				}
			}
			character:Targaryen_2 = {
				remove_trait = pregnant
				remove_variable = agot_fated_pregnancy_months
			}
			hidden_effect = {
				root = {
					add_courtier = scope:rhaegar
				}
			}
		}
	}

	option = { #Happy days :)
		name = agot_ninepenny.1011.a
		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root }
				is_alive = yes
			}
			add_opinion = {
				target = root
				modifier = feast_attended_my_feast_opinion
			}
		}
	}

	after = {
		random_owned_story = { #No need to keep it alive anymore
			limit = {
				story_type = story_agot_summerhall
			}
			end_story = yes
		}
	}
}

# Egg hatching worked!
agot_ninepenny.1012 = {
	type = character_event
	title = agot_ninepenny.1012.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = summerhall_hatched_dragon_three
				}
				desc = agot_ninepenny.1012.desc_three
			}
			triggered_desc = {
				trigger = {
					has_character_flag = summerhall_hatched_dragon_multiple
				}
				desc = agot_ninepenny.1012.desc_many
			}
			desc = agot_ninepenny.1012.desc
		}
	}

	theme = dragon
	override_background = {
		reference = bp2_courtyard
	}

	left_portrait = {
		character = root
		animation = toast_goblet
	}

	right_portrait = {
		character = scope:dragon_first
		animation = dragon_main
		camera = camera_dragon_event_standing_baby

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	immediate = {
		every_in_list = {
			list = hatched_dragons
			save_scope_as = dragon
			custom_tooltip = dragon_has_hatched_tt
		}
		custom_tooltip = all_eggs_destroyed_tt
	}

	option = {
		name = agot_ninepenny.1012.a

		add_prestige = 10000

		# Inform players what happened
		save_scope_as = egg_hatcher
		every_player = {
			limit = {
				NOT = { this = root }
			}
			trigger_event = agot_ninepenny.1013
		}
		trigger_event = {
			id = agot_ninepenny.1014
			days = 1
		}
	}
}

# Egg hatching notification - Summerhall
agot_ninepenny.1013 = {
	type = character_event
	title = agot_ninepenny.1013.t
	desc = agot_ninepenny.1013.desc

	theme = dragon
	override_background = {
		reference = corridor_night
	}

	left_portrait = {
		character = scope:egg_hatcher
		animation = ecstasy
	}
	right_portrait = {
		character = scope:dragon_first
		animation = dragon_main
		camera = camera_dragon_event_standing_baby

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	option = {
		name = {
			text = agot_ninepenny.1013.a.hatcher_positive
			trigger = {
				opinion = {
					target = scope:egg_hatcher
					value > 0
				}
			}
		}
		name = {
			text = agot_ninepenny.1013.a.hatcher_negative
			trigger = {
				opinion = {
					target = scope:egg_hatcher
					value < 0
				}
			}
		}
	}
}

# Hatching Success Wrap-up
agot_ninepenny.1014 = {
	type = character_event
	title = agot_ninepenny.1014.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:sacrifice
					exists = scope:rhaegar
				}
				desc = agot_ninepenny.1014.desc_dragons_sacrifice_rhaegar
			}
			triggered_desc = {
				trigger = {
					exists = scope:sacrifice
				}
				desc = agot_ninepenny.1014.desc_dragons_sacrifice
			}
			triggered_desc = {
				trigger = {
					exists = scope:rhaegar
				}
				desc = agot_ninepenny.1014.desc_dragons_no_sacrifice_rhaegar
			}
			desc = agot_ninepenny.1014.desc_dragons_no_sacrifice
		}
	}

	theme = dragon
	override_background = { reference = bp2_courtyard }

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { exists = scope:sacrifice }
			animation = grief
		}
		animation = toast_goblet
	}

	right_portrait = {
		character = scope:right_portrait
		triggered_animation = {
			trigger = { exists = scope:sacrifice }
			animation = dead
		}
		animation = drink_goblet
	}

	lower_left_portrait = scope:1014_aerys

	lower_center_portrait = scope:rhaegar

	lower_right_portrait = scope:1014_rhaella_alive

	immediate = {
		if = {
			limit = {
				character:Targaryen_2 = { is_alive = yes }
			}
			character:Targaryen_2 = {
				save_scope_as = rhaella
			}
			create_character = {
				age = 0
				random_traits = no
				father = character:Targaryen_1
				mother = character:Targaryen_2
				trait = beauty_good_3
				trait = intellect_good_2
				location = root.location
				gender_female_chance = {
					value = agot_canon_children_male_female_chance
				}
				faith = root.faith
				culture = root.culture
				save_scope_as = rhaegar
			}
			hidden_effect = {
				scope:rhaegar = {
					if = {
						limit = { is_male = yes }
						change_first_name = "Rhaegar"
					}
					if = {
						limit = { is_female = yes }
						change_first_name = "Rhaenyra"
					}
					copy_inheritable_appearance_from = character:Dummy_Targaryen_3
					set_house = character:Targaryen_2.house
					make_trait_inactive = is_targaryen_3
					add_character_flag = has_scripted_appearance
					make_trait_inactive = cool_silver_hair
					make_trait_inactive = purple_eyes_1
				}
			}
			character:Targaryen_2 = {
				remove_trait = pregnant
				remove_variable = agot_fated_pregnancy_months
			}
			hidden_effect = {
				root = {
					add_courtier = scope:rhaegar
				}
			}
			if = {
				limit = {
					NOT = { root = character:Targaryen_2 }
				}
				character:Targaryen_2 = { save_scope_as = 1014_rhaella_alive }
			}

			character:Targaryen_1 = { save_scope_as = 1014_aerys }
			hidden_effect = {
				random_courtier_or_guest = {
					limit = {
						has_trait = dragon
						NOT = {
							any_relation = {
								type = agot_dragon
							}
						}
					}
					save_scope_as = rhaegar_dragon
					agot_bond_dragon_relation_effect = {
						ACTOR = scope:rhaegar
						DRAGON = scope:rhaegar_dragon
					}
				}
			}
		}
		every_courtier_or_guest = {
			limit = {
				has_trait = dragon
				NOT = {
					any_relation = {
						type = agot_dragon
					}
				}
			}
			save_scope_as = dragon_to_pit
			agot_set_as_owned_dragon = {
				OWNER = title:c_dragonstone.holder
				DRAGON = scope:dragon_to_pit
			}
			agot_send_to_dragonpit_no_event = {
				DRAGON = scope:dragon_to_pit
				DRAGONPIT_COUNTY = title:c_dragonstone
			}
		}
		if = {
			limit = {
				exists = scope:sacrifice
			}
			scope:sacrifice = { save_scope_as = right_portrait }
		}
		else = {
			player_heir = { save_scope_as = right_portrait }
		}
	}

	option = { #Happy days :)
		name = agot_ninepenny.1014.a
		trigger = {
			NOT = { exists = scope:sacrifice }
		}
		every_in_list = {
			list = summerhall_attendees
			limit = {
				NOT = { this = root }
				is_alive = yes
			}
			add_opinion = {
				target = root
				modifier = feast_attended_my_feast_opinion
			}
		}
	}

	option = {
		name = agot_ninepenny.1014.b
		trigger = { exists = scope:sacrifice }
	}

	after = {
		random_owned_story = { #No need to keep it alive anymore
			limit = {
				story_type = story_agot_summerhall
			}
			end_story = yes
		}
	}
}

# Hatching Failure Wrap-up
agot_ninepenny.1015 = {
	type = character_event
	title = agot_ninepenny.1015.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:sacrifice
					exists = scope:rhaegar
				}
				desc = agot_ninepenny.1015.desc_dragons_sacrifice_rhaegar
			}
			triggered_desc = {
				trigger = {
					exists = scope:sacrifice
				}
				desc = agot_ninepenny.1015.desc_dragons_sacrifice
			}
			triggered_desc = {
				trigger = {
					exists = scope:rhaegar
				}
				desc = agot_ninepenny.1015.desc_dragons_no_sacrifice_rhaegar
			}
			desc = agot_ninepenny.1015.desc_dragons_no_sacrifice
		}
	}

	theme = dragon
	override_background = { reference = bp2_courtyard }

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { exists = scope:sacrifice }
			animation = grief
		}
		animation = dismissal
	}

	right_portrait = {
		character = scope:sacrifice
		animation = dead
	}

	lower_left_portrait = scope:1015_aerys

	lower_center_portrait = scope:rhaegar

	lower_right_portrait = scope:1015_rhaella_alive

	immediate = {
		if = {
			limit = {
				character:Targaryen_2 = { is_alive = yes }
			}
			character:Targaryen_2 = {
				save_scope_as = rhaella
			}
			create_character = {
				age = 0
				random_traits = no
				father = character:Targaryen_1
				mother = character:Targaryen_2
				trait = beauty_good_3
				trait = intellect_good_2
				location = root.location
				gender_female_chance = {
					value = agot_canon_children_male_female_chance
				}
				faith = root.faith
				culture = root.culture
				save_scope_as = rhaegar
			}
			hidden_effect = {
				scope:rhaegar = {
					if = {
						limit = { is_male = yes }
						change_first_name = "Rhaegar"
					}
					if = {
						limit = { is_female = yes }
						change_first_name = "Rhaenyra"
					}
					copy_inheritable_appearance_from = character:Dummy_Targaryen_3
					set_house = character:Targaryen_2.house
					make_trait_inactive = is_targaryen_3
					add_character_flag = has_scripted_appearance
					make_trait_inactive = cool_silver_hair
					make_trait_inactive = purple_eyes_1
				}
			}
			character:Targaryen_2 = {
				remove_trait = pregnant
				remove_variable = agot_fated_pregnancy_months
			}
			hidden_effect = {
				root = {
					add_courtier = scope:rhaegar
				}
			}

			if = {
				limit = {
					NOT = { root = character:Targaryen_2 }
				}
				character:Targaryen_2 = { save_scope_as = 1015_rhaella_alive }
			}

			character:Targaryen_1 = { save_scope_as = 1015_aerys }
			hidden_effect = {
				if = {
					limit = {
						has_bp2_dlc_trigger = yes
						exists = scope:sacrifice
					}
					scope:rhaegar = {
						trigger_event = {
							id = agot_events_generic.0020
							days = 2500
						}
					}
				}
			}
		}
		hidden_effect = {
			every_character_artifact = {
				limit = {
					has_variable = dragon_egg
					has_variable = agot_artifact_cannot_gift
				}
				root = { destroy_owned_artifact = prev }
			}
		}
		custom_tooltip = all_eggs_destroyed_tt
	}

	option = {
		name = agot_ninepenny.1015.a
		trigger = { exists = scope:sacrifice }
	}

	option = {
		name = agot_ninepenny.1015.b
		trigger = { NOT = { exists = scope:sacrifice } }
	}

	after = {
		random_owned_story = { #No need to keep it alive anymore
			limit = {
				story_type = story_agot_summerhall
			}
			end_story = yes
		}
	}
}

# Egg dies - Heir decides whether to continue with Summerhall
agot_ninepenny.1020 = {
	type = character_event
	title = agot_ninepenny.1020.t
	desc = agot_ninepenny.1020.desc

	theme = dragon

	immediate = {
		primary_title = {
			previous_holder = {
				save_scope_as = egg #Likely Egg but potentially Jerry II
			}
		}
		character:Targaryen_2 = {
			save_scope_as = rhaella
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			save_scope_as = summerhall_story
		}
		title:b_summerhall = {
			save_scope_as = summerhall
		}
	}

	left_portrait = {
		character = root
		animation = shame
	}
	right_portrait = {
		character = scope:egg
		animation = personality_content
	}
	lower_center_portrait = scope:rhaella

	option = { #Recommit to Summerhall
		name = agot_ninepenny.1020.a
		scope:summerhall_story = {
			custom_tooltip = agot_ninepenny.1020.a.tt
			set_variable = {
				name = summerhall
				value = flag:positive
			}
		}
	}

	option = {
		name = agot_ninepenny.1020.b
		scope:summerhall_story = {
			custom_tooltip = agot_ninepenny.1020.b.tt

			set_variable = { #Set summerhall to negative but story cycle stays so the birth can still happen
				name = summerhall
				value = flag:negative
			}
		}
	}
}

# Rhaella dies - Cancel Summerhall
agot_ninepenny.1021 = {
	type = character_event
	title = agot_ninepenny.1021.t
	desc = agot_ninepenny.1021.desc

	theme = dragon
	override_background = {
		reference = study
	}

	immediate = {
		if = { #Grab Duncan the Small if possible
			limit = {
				character:Targaryen_126 = {
					is_alive = yes
				}
			}
			character:Targaryen_126 = {
				save_scope_as = consoler
			}
		}
		else = {
			random_close_family_member = { #Grab a random family member for the event
				limit = {
					location = root.location
					is_available_adult = yes
				}
				save_scope_as = consoler
			}
		}
		character:Targaryen_2 = {
			save_scope_as = rhaella
		}
	}

	left_portrait = {
		character = root
		animation = sadness
	}
	right_portrait = {
		character = scope:consoler
		animation = shame
	}

	# Deadge
	lower_center_portrait = scope:rhaella

	option = { # Continue
		name = agot_ninepenny.1021.a
		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = summerhall_continue_death
				value = flag:positive
			}
		}
		ai_chance = { base = 100 }
	}

	option = { # With Rhaella dead there's nothing to celebrate
		name = agot_ninepenny.1021.b
		custom_tooltip = agot_ninepenny.1021.b.tt
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}

		random_owned_story = { #No need to keep it alive anymore
			limit = {
				story_type = story_agot_summerhall
			}
			end_story = yes
		}
		ai_chance = { base = 0 }
	}
}

#At War - Cancel Summerhall
agot_ninepenny.1022 = {
	type = character_event
	title = agot_ninepenny.1022.t
	desc = agot_ninepenny.1022.desc

	theme = dragon
	override_background = {
		reference = study
	}

	immediate = {
		random_character_war = {
			if = {
				limit = {
					primary_attacker = root
				}
				primary_defender = {
					save_scope_as = opponent
				}
			}
			else = {
				primary_attacker = {
					save_scope_as = opponent
				}
			}
		}
	}

	left_portrait = {
		character = root
		animation = war_attacker
	}
	right_portrait = {
		character = scope:opponent
		animation = war_defender
	}

	option = { # Continue
		name = agot_ninepenny.1022.a
		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = summerhall_continue_war
				value = flag:positive
			}
		}
		ai_chance = { base = 100 }
	}

	option = {
		name = agot_ninepenny.1022.b
		custom_tooltip = agot_ninepenny.1022.b.tt
		custom_tooltip = abandon_hatching_tt
		every_character_artifact = {
			limit = { has_variable = agot_artifact_cannot_gift }
			remove_variable = agot_artifact_cannot_gift
		}

		random_owned_story = {
			limit = {
				story_type = story_agot_summerhall
			}
			set_variable = {
				name = summerhall
				value = flag:negative
			}
		}
		ai_chance = { base = 0 }
	}
}

#Summerhall Notification for players
agot_ninepenny.1023 = {
	type = character_event
	title = agot_ninepenny.1023.t
	desc = agot_ninepenny.1023.desc
	#triggered desc depending on who survived

	theme = dragon
	override_background = {
		reference = study
	}

	immediate = {
		character:Targaryen_122 = {
			save_scope_as = king
		}
	}

	trigger = { #narrative event, ai dont need
		is_ai = no
	}

	left_portrait = {
		character = root
		animation = war_attacker
	}
	right_portrait = {
		character = scope:king
		animation = worry
	}

	option = {
		name = agot_ninepenny.1023.a
	}
}

#Summerhall Invitation for players
agot_ninepenny.1024 = {
	type = character_event
	title = agot_ninepenny.1024.t
	desc = agot_ninepenny.1024.desc
	#triggered desc depending on who survived

	theme = party

	immediate = {
		character:Targaryen_122 = {
			save_scope_as = king
		}
	}

	trigger = { #narrative event, ai dont need
		is_ai = no
	}

	right_portrait = {
		character = scope:king
		animation = toast_goblet
	}

	option = {
		name = agot_ninepenny.1024.a
	}
}

#Summerhall Arrival
agot_ninepenny.1100 = {
	type = character_event
	title = agot_ninepenny.1100.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					character:Targaryen_2 = { is_alive = yes }
					NOT = {
						character:Targaryen_2 = {
							any_owned_story = {
								story_type = story_agot_summerhall
								exists = this
							}
						}
					}
				}
				desc = agot_ninepenny.1100.desc_no_rhae
			}
			desc = agot_ninepenny.1100.desc
		}
	}

	theme = dynasty
	override_background = {
		reference = courtyard
	}
	left_portrait = {
		character = scope:summerhall_leader
		animation = toast_goblet
	}
	right_portrait = {
		character = root
		animation = toast_goblet
	}

	immediate = {
		character:Targaryen_2 = { # Rhaella
			save_scope_as = rhaella
		}
	}

	option = {
		name = agot_ninepenny.1003.a
	}
}

#Summerhall Arrival
agot_ninepenny.1101 = {
	type = character_event
	title = agot_ninepenny.1101.t
	desc = agot_ninepenny.1101.desc

	theme = dragon
	override_background = {
		reference = burning_building
	}
	left_portrait = {
		character = root
		animation = pain
	}

	option = {
		name = agot_ninepenny.1101.a
	}
}

#Reyne Rebellion Events - 2000

#Roger Reyne Initialisation Event
agot_ninepenny.2000 = {
	type = character_event
	title = agot_ninepenny.2000.t
	desc = agot_ninepenny.2000.desc

	theme = stewardship
	left_portrait = {
		character = scope:tytos
		animation = happiness
	}
	right_portrait = {
		character = root
		animation = personality_callous
	}
	lower_left_portrait = {
		character = scope:tywin
	}
	lower_right_portrait = {
		character = scope:ellyn
	}

	trigger = {
		character:Lannister_129 = { #Make sure Tytos wasn't replaced with a custom character
			exists = yes
		}
	}

	immediate = {
		character:Lannister_129 = {
			save_scope_as = tytos
		}
		character:Lannister_1 = {
			save_scope_as = tywin
		}
		character:Lannister_128 = {
			save_scope_as = tion
		}
		character:Reyne_46 = {
			save_scope_as = ellyn
		}

		dynasty = {
			random_dynasty_member = {
				limit = {
					bp2_valid_to_offer_as_hostage_trigger = { SENDER = root }
				}
				save_scope_as = hostage
			}
		}
	}

	option = { #Ain't payin u shit
		name = agot_ninepenny.2000.a

		scope:tytos = {
			trigger_event = agot_ninepenny.2001
		}
		ai_chance = {
			base = 1
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #Actually pay back Tytos
		name = agot_ninepenny.2000.b

		pay_short_term_gold = {
			target = scope:tytos
			gold = 2500
		}

		scope:tytos = {
			take_hostage = scope:hostage
		}
		scope:tytos = {
			random_owned_story = { #No debt no issue
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				end_story = yes
			}
		}
		ai_chance = { #Never do this for QA
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2001 = { #Tytos Reaction to Roger not paying
	type = character_event
	title = agot_ninepenny.2001.t
	desc = agot_ninepenny.2001.desc

	theme = stewardship

	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = character:Lannister_1
		animation = anger
	}
	lower_left_portrait = scope:roger
	lower_right_portrait = scope:tarbeck

	trigger = {
	}

	immediate = {
		character:Lannister_1 = {
			save_scope_as = tywin
		}
		character:Reyne_45 = {
			save_scope_as = roger
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
	}

	option = { #Be a blubbery loser - Rebellion will continue to gestate until ether post Ninepenny OR Tytos dies
		name = agot_ninepenny.2001.a
		reverse_add_opinion = {
			modifier = hate_opinion
			target = scope:tywin
			opinion = -200
		}
		add_prestige_level = -1
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #IMMEDIATELY KICK OFF REBELLION
		name = agot_ninepenny.2001.b
		custom_tooltip = agot_ninepenny.2001.b.tt

		scope:tarbeck = { #Tarbeck rides to Casterly Rock
			trigger_event = {
				id = agot_ninepenny.2002
				days = { 3 10 }
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2002 = { #Tarbeck Decides on Loan Repayments - Tytos Version
	type = character_event
	title = agot_ninepenny.2002.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:lion_lord = character:Lannister_129
				}
				desc = agot_ninepenny.2002.desc.tytos
			}
			desc = agot_ninepenny.2002.desc
		}
	}

	theme = stewardship

	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:reyne
		animation = eyeroll
	}

	lower_left_portrait = scope:lion_lord

	lower_right_portrait = scope:roger

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
		random_spouse = {
			save_scope_as = reyne
		}
		character:Reyne_45 = {
			save_scope_as = roger
		}

		dynasty = {
			random_dynasty_member = {
				limit = {
					bp2_valid_to_offer_as_hostage_trigger = { SENDER = root }
				}
				save_scope_as = hostage
			}
		}
	}

	option = { #Ride to Casterly Rock - Cannon
		name = agot_ninepenny.2002.a
		custom_tooltip = agot_ninepenny.2002.a.tt


		start_travel_plan = {
			players_use_planner = no
			destination = province:2855
			on_arrival_destinations = last
			on_arrival_event = agot_ninepenny.2003 #literally just to give the lord of casterly an event
			return_trip = no # One way
		}

		scope:lion_lord = {
			random_owned_story = { #Variable for Rebellion
				limit = {
					story_type = story_agot_reyne_rebellion
				}
			}
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #Ignore and fight Rebellion
		name = agot_ninepenny.2002.b
		custom_tooltip = agot_ninepenny.2002.b

		#Ravens sent accusing Tarbeck and Walderan of Treason, rebellion begins
		if = { #Tytos gets one event
			limit = {
				title:k_the_westerlands.holder = character:Lannister_129
			}
			scope:lion_lord = {
				trigger_event = agot_ninepenny.2009
			}
		}
		else = { #His sons get another
			scope:lion_lord = {
				trigger_event = agot_ninepenny.2010
			}
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}

	option = { #Pay Back Loan & Give Hostages
		name = agot_ninepenny.2002.c

		trigger = { #If player Roger chooses to not repay loan it should lead to rebellion
			is_ai = no
		}

		pay_short_term_gold = {
			target = scope:lion_lord
			gold = 1000
		}

		scope:lion_lord = {
			take_hostage = character:Tarbeck_41
		}

		scope:roger = {
			trigger_event = agot_ninepenny.2033
		}
	}
}

agot_ninepenny.2003 = { #Tarbeck Arrives at Casterly - Gets Imprisoned
	hidden = yes

	immediate = {
		if = { #Tytos gets one event
			limit = {
				title:k_the_westerlands.holder = character:Lannister_129
			}
			scope:lion_lord = {
				trigger_event = agot_ninepenny.2004
			}
		}
		else = { #His sons get another
			scope:lion_lord = {
				trigger_event = agot_ninepenny.2005
			}
		}
	}
}

agot_ninepenny.2004 = { #Lord Tarbeck Imprisoned
	type = character_event
	title = agot_ninepenny.2004.t
	desc = agot_ninepenny.2004.desc

	theme = court

	left_portrait = {
		character = root
		animation = worry
	}
	right_portrait = {
		character = scope:lion_son
		animation = personality_callous
	}

	lower_left_portrait = scope:tarbeck

	lower_right_portrait = scope:ellyn

	lower_center_portrait = scope:kidnapped_lannister

	trigger = { #Should only be for Tytos
		root = character:Lannister_129
	}

	immediate = {
		player_heir ?= { save_scope_as = lion_son }
		character:Lannister_130 = { #Cannonically Stafford but any Lannister cousin works
			random_child = {
				limit = {
					is_male = yes
					is_alive = yes
					age >= 6
				}
				save_scope_as = kidnapped_lannister
			}
		}
		character:LannisterLP_46 = {
			save_scope_as = lannisport_1
		}
		character:LannisterLP_48 = {
			save_scope_as = lannisport_2
		}
		hidden_effect = { #Ellyn Seizes Power
			title:d_tarrich.holder = {
				save_scope_as = tarbeck
					random_spouse = {
						save_scope_as = ellyn
					}
				set_diarch = scope:ellyn
			}
			title:d_castamere.holder = {
				save_scope_as = reyne
			}
			hard_imprison_character_effect = { #Tywin imprisons Tarbeck
				TARGET = scope:tarbeck
				IMPRISONER = root
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = scope:kidnapped_lannister
				IMPRISONER = scope:tarbeck
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = character:LannisterLP_46
				IMPRISONER = scope:tarbeck
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = character:LannisterLP_48
				IMPRISONER = scope:tarbeck
			}
		}
	}

	option = { #Nono we must let lord Tarbeck go - Cannon and rebellion begins fermenting again
		name = agot_ninepenny.2004.a

		scope:tarbeck = { #Freed
			trigger_event = agot_ninepenny.2006
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #I suppose Tywin is right...
		name = agot_ninepenny.2004.b

		scope:tarbeck = { #Lill Lord Tarbeck
			death = {
				death_reason = death_execution
				killer = scope:lion_son
			}
		}

		scope:reyne = { #And the Rebellion begins!
			trigger_event = agot_ninepenny.2007
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}

	after = {
		if = {
			limit = {
				scope:tarbeck = {
					is_alive = no
				}
			}
			title:d_tarrich.holder = { #Rebellion time
				trigger_event = agot_ninepenny.2008
			}
		}
	}
}

agot_ninepenny.2005 = { #Tywin or Kevan grab Walderan, rebellion begins
	type = character_event
	title = agot_ninepenny.2005.t
	desc = agot_ninepenny.2005.desc

	theme = court

	left_portrait = {
		character = scope:tarbeck
		animation = fear
	}
	right_portrait = {
		character = root
		animation = personality_callous
	}

	lower_left_portrait = scope:tarbeck

	lower_right_portrait = scope:ellyn

	lower_center_portrait = scope:kidnapped_lannister

	trigger = {
	}

	immediate = {
		player_heir ?= { save_scope_as = lion_son }
		character:Lannister_130 = { #Cannonically Stafford but any Lannister cousin works
			random_child = {
				limit = {
					is_male = yes
					is_alive = yes
				}
				save_scope_as = kidnapped_lannister
			}
		}
		character:LannisterLP_46 = {
			save_scope_as = lannisport_1
		}
		character:LannisterLP_48 = {
			save_scope_as = lannisport_2
		}
		hidden_effect = { #Ellyn Seizes Power
			title:d_tarrich.holder = {
				save_scope_as = tarbeck
					random_spouse = {
						save_scope_as = ellyn
					}
				set_diarch = scope:ellyn
			}
			title:d_castamere.holder = {
				save_scope_as = reyne
			}
			hard_imprison_character_effect = { #Tywin imprisons Tarbeck
				TARGET = scope:tarbeck
				IMPRISONER = root
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = scope:kidnapped_lannister
				IMPRISONER = scope:tarbeck
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = character:LannisterLP_46
				IMPRISONER = scope:tarbeck
			}
			hard_imprison_character_effect = { #Ellyn grabs Stafford and two random Lannisport Lannisters
				TARGET = character:LannisterLP_48
				IMPRISONER = scope:tarbeck
			}
		}
	}

	option = { #Rebellion time
		name = agot_ninepenny.2005.a

		scope:tarbeck = { #Lill Lord Tarbeck
			death = {
				death_reason = death_execution
				killer = root
			}
		}
		scope:reyne = {
			trigger_event = agot_ninepenny.2007
		}
	}

	after = {
		if = {
			limit = {
				scope:tarbeck = {
					is_alive = no
				}
			}
			title:d_tarrich.holder = {
				trigger_event = agot_ninepenny.2008
			}
		}
	}
}

agot_ninepenny.2006 = { #Lord Tarbeck freed - Only with Tytos
	type = character_event
	title = agot_ninepenny.2006.t
	desc = agot_ninepenny.2006.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:tytos
		animation = personality_coward
	}

	lower_left_portrait = scope:ellyn

	lower_center_portrait = scope:kidnapped_lannister

	lower_right_portrait = scope:lion_son

	trigger = {
	}

	immediate = {
		release_from_prison = yes

		title:k_the_westerlands.holder = {
			save_scope_as = tytos
		}

		scope:kidnapped_lannister = {
			release_from_prison = yes
		}
		character:LannisterLP_46 = {
			release_from_prison = yes
		}
		character:LannisterLP_48 = {
			release_from_prison = yes
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2006.a

		add_opinion = {
			target = scope:ellyn
			modifier = love_opinion
			opinion = 50
		}

		reverse_add_opinion = {
			target = scope:ellyn
			modifier = love_opinion
			opinion = 50
		}

		add_opinion = {
			target = scope:lion_son
			modifier = imprisoned_me_past
		}
	}
}

agot_ninepenny.2007 = { #Lord Tarbeck killed, Roger Event - Rebellion Begins
	type = character_event
	title = agot_ninepenny.2007.t
	desc = agot_ninepenny.2007.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:ellyn
		animation = personality_coward
	}

	lower_left_portrait = scope:lion_lord

	lower_center_portrait = scope:tarbeck #Dead man

	lower_right_portrait = {
		trigger = {
			NOT = {
				scope:lion_son = scope:lion_lord
			}
		}
		character = scope:lion_son
	}

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}

		title:k_the_westerlands.holder.primary_heir = {
			save_scope_as = lion_son
		}

		scope:tarbeck = { #Lill Lord Tarbeck
			death = {
				death_reason = death_execution
				killer = character:Lannister_1
			}
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2007.a

		scope:lion_lord = {
			random_owned_story = { #Variable for Rebellion
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				set_variable = reyne_rebellion
			}
		}

		every_character_war = {
			limit = {
				OR = {
					primary_defender = title:k_the_westerlands.holder
					primary_attacker = title:k_the_westerlands.holder
				}
			}
			end_war = invalidated
		}

		start_war = {
			casus_belli = reyne_rebellion
			target = scope:lion_lord
			target_title = title:k_the_westerlands
		}
		random_character_war = {
			limit = {
				primary_defender = scope:lion_lord
			}
			save_scope_as = reyne_rebellion
			add_attacker = title:d_tarrich.holder
		}
	}
}

agot_ninepenny.2008 = { #Lord Tarbeck killed, new Lord Tarbeck event
	type = character_event
	title = agot_ninepenny.2008.t
	desc = agot_ninepenny.2008.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:ellyn
		animation = rage
	}

	lower_center_portrait = scope:tarbeck #Dead man

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
		scope:tarbeck = { #Lill Lord Tarbeck
			death = {
				death_reason = death_execution
				killer = scope:tarbeck.killer
			}
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2008.a
		show_as_tooltip = {
			scope:reyne = {
				random_character_war = {
					limit = {
						primary_defender = scope:lion_lord
					}
					save_scope_as = reyne_rebellion
					add_attacker = title:d_tarrich.holder
				}
			}
		}
		scope:tarbeck.killer = {
			set_relation_rival = {
				target = root
				reason = rival_killed_parent
				involved_character = scope:tarbeck
			}
		}
	}
}

agot_ninepenny.2009 = { #Tarbeck and Reyne have both ignored demands - Tytos Perspective
	type = character_event
	title = agot_ninepenny.2009.t
	desc = agot_ninepenny.2009.desc

	theme = court

	left_portrait = {
		character = root
		animation = personality_coward
	}
	right_portrait = {
		character = scope:lion_son
		animation = rage
	}

	lower_center_portrait = scope:brother

	trigger = {
		root = character:Lannister_129
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
		primary_heir = {
			save_scope_as = lion_son
			add_character_flag = wear_armor
		}
		every_child = {
			limit = {
				NOT = {
					this = scope:lion_son
				}
			}
			add_to_list = children
		}
		ordered_in_list = { #Should be Kevan
			list = children
			order_by = age
			save_scope_as = brother
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2009.a

		#Send Events to Roger and Tarbeck

		title:d_castamere.holder = {
			trigger_event = agot_ninepenny.2011
		}

		title:d_tarrich.holder = {
			trigger_event = agot_ninepenny.2012
		}

		scope:lion_son = {
			remove_character_flag = wear_armor
		}
	}
}

agot_ninepenny.2010 = { #Tarbeck and Reyne have both ignored demands - Tywin Perspective
	type = character_event
	title = agot_ninepenny.2010.t
	desc = agot_ninepenny.2010.desc

	theme = court

	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = {
		character = scope:brother
		animation = marshal
	}
	lower_left_portrait = scope:tarbeck
	lower_right_portrait = scope:reyne

	trigger = {
	}

	immediate = {
		title:d_castamere.holder = {
			save_scope_as = reyne
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
		every_sibling = {
			limit = {
				is_male = yes
			}
			add_to_list = brothers
		}
		ordered_in_list = { #Should be Kevan
			list = brothers
			order_by = age
			save_scope_as = brother
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2010.a

		#Send Events to Roger and Tarbeck

		title:d_castamere.holder = {
			trigger_event = agot_ninepenny.2011
		}

		title:d_tarrich.holder = {
			trigger_event = agot_ninepenny.2012
		}
	}
}

agot_ninepenny.2011 = { #Payment Refused, Reyne Perspective Rebellion Begins
	type = character_event
	title = agot_ninepenny.2011.t
	desc = agot_ninepenny.2011.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:tarbeck
		animation = personality_callous
	}

	lower_center_portrait = scope:lion_lord

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2011.a
		scope:lion_lord = {
			random_owned_story = { #Variable for Rebellion
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				set_variable = reyne_rebellion
			}
		}
		show_as_tooltip = {
			start_war = {
				casus_belli = reyne_rebellion
				target = scope:lion_lord
				target_title = title:k_the_westerlands
			}
		}
		hidden_effect = {
			start_war = {
				casus_belli = reyne_rebellion
				target = scope:lion_lord
				target_title = title:k_the_westerlands
			}
			random_character_war = {
				limit = {
					primary_defender = scope:lion_lord
				}
				save_scope_as = reyne_rebellion
				add_attacker = title:d_tarrich.holder
			}
		}
	}
}

agot_ninepenny.2012 = { #Payment Refused, Tarbeck Perspective Rebellion Begins
	type = character_event
	title = agot_ninepenny.2012.t
	desc = agot_ninepenny.2012.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:reyne
		animation = rage
	}

	lower_center_portrait = scope:lion_lord

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
		title:d_castamere.holder = {
			save_scope_as = reyne
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2012.a
		show_as_tooltip = {
			scope:reyne = {
				random_character_war = {
					limit = {
						primary_defender = scope:lion_lord
					}
					save_scope_as = reyne_rebellion
					add_attacker = title:d_tarrich.holder
				}
			}
		}
	}
}

#Tarbeck Siege Events
#Tarbeck Gets Event to Stay Stalwart of Surrender

agot_ninepenny.2013 = { #Siege of Tarbeck Hall - Tarbeck
	type = character_event
	title = agot_ninepenny.2013.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { #Special loc for Ellyn
					root = character:Reyne_46
				}
				desc = agot_ninepenny.2013.desc.ellyn
			}
			desc = agot_ninepenny.2013.desc #Generic for random Tarbeck
		}
	}

	theme = battle

	left_portrait = {
		character = root
		animation = war_attacker
	}
	right_portrait = { #If Ellyn is alive, else whoever
		character = scope:tywin
		animation = personality_callous
	}
	lower_center_portrait = { #If Ellyn is alive, else whoever
		trigger = {
			exists = scope:ellyn
		}
		character = scope:ellyn
	}

	trigger = {
	}

	immediate = {
		title:b_tarbeck_hall = {
			save_scope_as = location
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
			dynasty = {
				random_dynasty_member = {
					limit = {
						bp2_valid_to_offer_as_hostage_trigger = { SENDER = root }
					}
					save_scope_as = hostage
				}
			}
		}
		random_character_war = {
			limit = {
				using_cb = reyne_rebellion
			}
			save_scope_as = reyne_rebellion
		}
		if = {
			limit = {
				character:Reyne_46 = {
					is_alive = yes
				}
			}
			character:Reyne_46 = {
				save_scope_as = ellyn
			}
		}
		character:Lannister_1 = {
			save_scope_as = tywin
		}
	}

	option = { #Stand Firm
		name = agot_ninepenny.2013.a
		custom_tooltip = agot_ninepenny.2013.a.tt

		character:Lannister_1 = {
			trigger_event = agot_ninepenny.2014
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	#Sally out or something nuts?

	option = { #Surrender
		name = agot_ninepenny.2013.b

		custom_tooltip = agot_ninepenny.2013.b.tt

		hidden_effect = {
			scope:reyne_rebellion = {
				remove_participant = scope:tarbeck
			}
		}

		pay_short_term_gold = {
			target = title:k_the_westerlands.holder
			gold = 1000
		}

		title:k_the_westerlands.holder = {
			take_hostage = character:Tarbeck_41
		}

		title:k_the_westerlands.holder = {
			trigger_event = agot_ninepenny.2018
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2014 = { #Siege of Tarbeck Hall - Tywin orders the destruction
	type = character_event
	title = agot_ninepenny.2014.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { #Special loc for Ellyn
					scope:taunter = character:Reyne_46
				}
				desc = agot_ninepenny.2014.desc.ellyn
			}
			desc = agot_ninepenny.2014.desc #Generic for random Tarbeck
		}
	}

	theme = battle

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = { #If Ellyn is alive, else whoever
		character = scope:taunter
		animation = personality_callous
	}
	lower_center_portrait = { #If Ellyn is alive, else whoever
		trigger = {
			NOT = {
				scope:taunter = scope:tarbeck
			}
		}
		character = scope:tarbeck
	}

	trigger = {
	}

	immediate = {
		title:b_tarbeck_hall = {
			save_scope_as = location
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
		if = {
			limit = {
				character:Reyne_46 = {
					is_alive = yes
				}
			}
			character:Reyne_46 = {
				save_scope_as = taunter
			}
		}
		else = {
			title:d_tarrich.holder = {
				save_scope_as = taunter
			}
		}
	}

	option = { #Bury them in rubble
		name = agot_ninepenny.2014.a
		custom_tooltip = agot_ninepenny.2014.a.tt

		trigger_event = agot_ninepenny.2015

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #Normal siege
		name = agot_ninepenny.2014.b

		custom_tooltip = agot_ninepenny.2014.b.tt

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2015 = { #Siege of Tarbeck Hall - Tywin reacts to the destruction
	type = character_event
	title = agot_ninepenny.2015.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { #Special loc for Ellyn
					scope:taunter = character:Reyne_46
				}
				desc = agot_ninepenny.2015.desc.ellyn
			}
			desc = agot_ninepenny.2015.desc #Generic for random Tarbeck
		}
	}


	theme = battle
	override_background = { reference = burning_building }

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = { #If Ellyn is alive, else whoever
		character = scope:taunter
		animation = pain
	}

	trigger = {
	}

	immediate = {
		scope:location.holder = {
			if = {
				limit = {
					location = scope:location.title_province
					NOR = {
						exists = commanding_army
						exists = knight_army
						is_imprisoned = yes
					}
				}
				add_to_list = besieged_characters
			}
			every_courtier_or_guest = {
				limit = {
					location = scope:location.title_province
					NOR = {
						exists = commanding_army
						exists = knight_army
						is_imprisoned = yes
					}
				}
				add_to_list = besieged_characters
			}
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2015.a
		custom_tooltip = agot_ninepenny.2015.a.tt

		add_dread = massive_dread_gain
		every_in_list = {
			list = besieged_characters
			death = {
				death_reason = death_siege
				killer = root
			}
		}

		#Inform Tytos
		if = {
			limit = {
				character:Lannister_129 ?= {
					is_alive = yes
					any_held_title = {
						this = title:k_the_westerlands
					}
				}
			}
			character:Lannister_129 = {
				trigger_event = agot_ninepenny.2017
			}
		}
		#Inform Lord Tarbeck if he wasn't present
		if = {
			limit = {
				scope:tarbeck ?= {
					is_alive = yes
				}
			}
			scope:tarbeck = {
				trigger_event = agot_ninepenny.2016
			}
		}
	}
}

agot_ninepenny.2016 = { #Siege of Tarbeck Hall - Tarback Informed if he was not present
	type = character_event
	title = agot_ninepenny.2016.t
	desc = agot_ninepenny.2016.desc

	theme = battle

	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:taunter
		animation = loss_1
	}

	lower_center_portrait = scope:tywin

	trigger = {
	}

	immediate = {
		character:Lannister_1 = {
			save_scope_as = tywin
		}
		scope:tywin.house.house_head = {
			save_scope_as = lannister
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2016.a

		if = {
			limit = {
				#DLC check
				has_bp1_dlc_trigger = yes
				house.house_head = {
					house_head_can_start_feud_against_trigger = { TARGET = scope:lannister }
				}
			}
			house_feud_start_effect = {
				# Feuding House Head
				ACTOR = root
				# Target House Head
				TARGET = scope:lannister
				# Feud Reason
				REASON = head_rivalry
				# House Member attacker if relevant, otherwise same as ACTOR
				ATTACKER = root
				# House Member victim if relevant, otherwise same as TARGET
				VICTIM = scope:spouse_2
			}
		}
	}
}

agot_ninepenny.2017 = { #Siege of Tarbeck Hall - Tytos Informed of what has occured
	type = character_event
	title = agot_ninepenny.2017.t
	desc = agot_ninepenny.2017.desc

	theme = battle

	left_portrait = {
		character = root
		animation = stress
	}
	right_portrait = {
		character = scope:tywin
		animation = personality_vengeful
	}

	lower_center_portrait = scope:tarbeck

	trigger = {
		root = character:Lannister_129
	}

	immediate = {
		character:Lannister_1 = {
			save_scope_as = tywin
			add_character_flag = no_hat
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2017.a

		character:Lannister_1 = {
			remove_character_flag = no_hat
		}
	}
}

agot_ninepenny.2018 = { #Tarbeck Surrenders
	type = character_event
	title = agot_ninepenny.2018.t
	desc = agot_ninepenny.2018.desc

	theme = battle

	left_portrait = {
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:tywin
		animation = personality_callous
	}

	lower_center_portrait = scope:tarbeck

	trigger = {
		root = character:Lannister_129
	}

	immediate = {
		character:Lannister_1 = {
			save_scope_as = tywin
			add_character_flag = no_hat
		}
	}

	option = {
		name = agot_ninepenny.2018.a
	}
}

#Castamere Siege Events

agot_ninepenny.2019 = { #Siege of Castamere
	type = character_event
	title = agot_ninepenny.2019.t
	desc = agot_ninepenny.2019.desc

	theme = battle

	left_portrait = {
		character = root
		animation = war_attacker
	}
	right_portrait = {
		character = scope:tywin
		animation = personality_vengeful
	}

	trigger = {
	}

	immediate = {
		character:Lannister_1 = {
			save_scope_as = tywin
			add_character_flag = no_hat
		}
		title:b_castamere = {
			save_scope_as = location
		}
		scope:location.holder = {
			if = {
				limit = {
					location = scope:location.title_province
					NOR = {
						exists = commanding_army
						exists = knight_army
						is_imprisoned = yes
					}
				}
				add_to_list = besieged_characters
			}
			every_courtier_or_guest = {
				limit = {
					location = scope:location.title_province
					NOR = {
						exists = commanding_army
						exists = knight_army
						is_imprisoned = yes
					}
				}
				add_to_list = besieged_characters
			}
		}
		title:b_castamere.holder = {
			save_scope_as = reyne
		}
	}

	option = { #Let him come
		name = agot_ninepenny.2019.a

		character:Lannister_1 = {
			trigger_event = agot_ninepenny.2020
		}
	}
}

agot_ninepenny.2020 = { #Siege of Castamere - Tywin
	type = character_event
	title = agot_ninepenny.2020.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { #Special loc for Roger/House Head
					scope:defender = title:b_castamere.holder
				}
				desc = agot_ninepenny.2020.desc.reyne
			}
			desc = agot_ninepenny.2020.desc #Generic for random Reyne
		}
	}

	theme = battle

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = { #If Ellyn is alive, else whoever
		character = scope:defender
		animation = personality_callous
	}
	lower_center_portrait = { #If Ellyn is alive, else whoever
		trigger = {
			NOT = {
				scope:defender = scope:reyne
			}
		}
		character = scope:reyne
	}

	trigger = {
	}

	immediate = {
		title:b_castamere = {
			save_scope_as = location
		}
		title:b_castamere.holder = {
			save_scope_as = reyne
		}
		#Find a Defender
		if = { #The Lord if available
			limit = {
				title:b_castamere.holder = {
					is_in_list = besieged_characters
				}
			}
			title:b_castamere.holder = {
				save_scope_as = defender
			}
		}
		else_if = { #Is there a Reyne in the building?
			limit = {
				any_in_list = {
					list = besieged_characters
					dynasty = scope:reyne.dynasty
					is_available_adult = yes
				}
			}
			random_in_list = {
				list = besieged_characters
				limit = {
					dynasty = scope:reyne.dynasty
					is_available_adult = yes
				}
				save_scope_as = defender
			}
		}
		else = { #Or the most martial one there
			ordered_in_list = {
				list = besieged_characters
				order_by = martial

				save_scope_as = defender
			}
		}
		#Grab a character for Roger to be mad about
		if = { #Wife - most likely
			limit = {
				title:b_castamere.holder.primary_spouse = {
					is_in_list = besieged_characters
				}
			}
			title:b_castamere.holder.primary_spouse = {
				save_scope_as = doa
			}
		}
		else_if = { #Son - less likely, more likely to be in the field
			limit = {
				title:b_castamere.holder.primary_heir = {
					is_in_list = besieged_characters
				}
			}
			title:b_castamere.holder.primary_heir = {
				save_scope_as = doa
			}
		}
	}

	option = { #Flood the tunnels
		name = agot_ninepenny.2020.a
		custom_tooltip = agot_ninepenny.2020.a.tt

		trigger_event = agot_ninepenny.2021

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}

	}

	option = { #Normal siege
		name = agot_ninepenny.2020.b

		custom_tooltip = agot_ninepenny.2020.b.tt

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2021 = { #Siege of Castamere - Tywin
	type = character_event
	title = agot_ninepenny.2021.t
	desc = agot_ninepenny.2021.desc

	theme = battle
	override_background = { reference = burning_building }

	left_portrait = {
		character = root
		animation = spymaster
	}

	trigger = {
	}

	immediate = {
		title:d_castamere.holder = {
			save_scope_as = reyne
		}
		#Missing perspective
		hidden_effect = {
			if = {
				limit = {
					title:c_castamere.holder = {
						is_in_list = besieged_characters
					}
					any_character_war = {
						primary_attacker = title:c_castamere.holder
					}
				}
				title:c_castamere.holder = { save_scope_as = reyne_ruler }
				random_character_war = {
					limit = {
						primary_attacker = title:c_castamere.holder
					}
					end_war = defender
				}
			}
		}

		title:k_the_westerlands.holder = {
			random_owned_story = { #Variable for Rebellion
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				set_variable = castamere_destroyed
			}
		}
		play_music_cue = "mood_castamere"
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2021.a

		add_dread = massive_dread_gain

		custom_description = {
			text = agot_ruinized_castamere_effect_desc
			agot_ruinise_title_effect = { TITLE = title:b_castamere }
			title:b_castamere.title_province = {
				remove_building = agot_castamere_01
				add_building = ruin_flooded_01
				add_building = ruin_infamous_01
				add_special_building = agot_castamere_ruins_01
			}
		}

		every_in_list = {
			list = besieged_characters
			death = {
				death_reason = death_siege
				killer = root
			}
		}

		hidden_effect = {
			if = {
				limit = {
					exists = scope:reyne_ruler
					title:c_castamere.holder.house = scope:reyne_ruler.house
				}
				title:c_castamere.holder = { vassal_contract_set_obligation_level = { type = title_revocation_rights level = 0 } }
				rightfully_imprison_character_effect = {
					TARGET = title:c_castamere.holder
					IMPRISONER = root
				}
			}
		}

		#Inform Tytos
		if = {
			limit = {
				character:Lannister_129 ?= {
					is_alive = yes
					any_held_title = {
						this = title:k_the_westerlands
					}
				}
			}
			character:Lannister_129 = {
				trigger_event = agot_ninepenny.2023
			}
		}
		#Inform Lord Reyne if he wasn't present
		if = {
			limit = {
				scope:reyne ?= {
					is_alive = yes
				}
			}
			scope:reyne = {
				trigger_event = agot_ninepenny.2022
			}
		}
	}
}

agot_ninepenny.2022 = { #Siege of Castamere - Reyne Informed if he was not present
	type = character_event
	title = agot_ninepenny.2022.t
	desc = agot_ninepenny.2022.desc

	theme = battle

	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:doa
		animation = personality_zealous
	}

	lower_center_portrait = scope:tywin

	trigger = {
	}

	immediate = {
		play_music_cue = "mood_castamere"
		character:Lannister_1 = {
			save_scope_as = tywin
		}
		scope:tywin.house.house_head = {
			save_scope_as = lannister
		}
	}

	option = {
		name = agot_ninepenny.2022.a

		if = {
			limit = {
				#DLC check
				has_bp1_dlc_trigger = yes
				house.house_head = {
					house_head_can_start_feud_against_trigger = { TARGET = scope:lannister }
				}
			}
			house_feud_start_effect = {
				# Feuding House Head
				ACTOR = root
				# Target House Head
				TARGET = scope:lannister
				# Feud Reason
				REASON = head_rivalry
				# House Member attacker if relevant, otherwise same as ACTOR
				ATTACKER = root
				# House Member victim if relevant, otherwise same as TARGET
				VICTIM = scope:spouse_2
			}
		}
	}
}

agot_ninepenny.2023 = { #Siege of Castamere - Tytos Informed of what has occured
	type = character_event
	title = agot_ninepenny.2023.t
	desc = agot_ninepenny.2023.desc

	theme = battle

	left_portrait = {
		character = root
		animation = stress
	}
	right_portrait = {
		character = scope:tywin
		animation = personality_vengeful
	}

	lower_center_portrait = scope:reyne

	trigger = {
		root = character:Lannister_129
	}

	immediate = {
		play_music_cue = "mood_castamere"
		character:Lannister_1 = {
			save_scope_as = tywin
			add_character_flag = no_hat
		}
	}

	option = {
		name = agot_ninepenny.2023.a

		character:Lannister_1 = {
			remove_character_flag = no_hat
		}
	}
}

#Contingency Events

agot_ninepenny.2030 = { #Tytos' son inherits, forces the rebellion
	type = character_event
	title = agot_ninepenny.2030.t
	desc = agot_ninepenny.2030.desc

	theme = court

	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:reyne
		animation = personality_callous
	}

	lower_left_portrait = scope:tytos #Dead man

	lower_right_portrait = scope:tarbeck

	trigger = {
	}

	immediate = {
		character:Lannister_129 = {
			save_scope_as = tytos
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
		title:d_castamere.holder = {
			save_scope_as = reyne
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2030.a

		title:d_tarrich.holder = {
			trigger_event = agot_ninepenny.2002
		}
	}
	#Should a non Tywin/Kevan son be allowed to let is slide
}

agot_ninepenny.2031 = { #Tytos' doesn't join NPK war, forced
	type = character_event
	title = agot_ninepenny.2031.t
	desc = agot_ninepenny.2031.desc

	theme = court

	left_portrait = {
		character = root
		animation = personality_coward
	}
	right_portrait = {
		character = scope:tytos_heir
		animation = rage
	}
	lower_left_portrait = scope:throne
	lower_right_portrait = scope:maelys

	trigger = {
	}

	immediate = {
		character:Lannister_129 = {
			save_scope_as = tytos
		}
		primary_heir = {
			save_scope_as = tytos_heir
		}
		title:e_the_iron_throne.holder = {
			save_scope_as = throne
		}
		title:e_blackfyre_rebellion.holder = {
			save_scope_as = maelys
		}
	}

	option = { #It's fucking poppin off now
		name = agot_ninepenny.2031.a

		agot_mw_join_loyalists_effect = { RULER = root CROWN = title:e_the_iron_throne.holder }

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #N-no nevermind blubbers - Tywin would probably fucking pop off here anyway
		name = agot_ninepenny.2031.b

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2032 = { #Tytos' sons returns from the Blackfyre Rebellion - Forces the war
	type = character_event
	title = agot_ninepenny.2032.t
	desc = agot_ninepenny.2032.desc

	theme = court

	left_portrait = {
		character = root
		animation = personality_coward
	}
	right_portrait = {
		character = scope:tytos_heir
		animation = personality_callous
	}

	lower_left_portrait = scope:reyne

	lower_right_portrait = scope:tarbeck

	trigger = {
	}

	immediate = {
		character:Lannister_129 = {
			save_scope_as = tytos
		}
		primary_heir = {
			save_scope_as = tytos_heir
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
		title:d_castamere.holder = {
			save_scope_as = reyne
		}
	}

	option = { #Tywin sends the Ravens, takes control
		name = agot_ninepenny.2030.a

		set_diarch = scope:tytos_heir
		try_start_diarchy = regency
		set_diarchy_swing = 60

		title:d_castamere.holder = {
			trigger_event = agot_ninepenny.2011
		}

		title:d_tarrich.holder = {
			trigger_event = agot_ninepenny.2012
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_2
			}
		}
	}

	option = { #The only way to prevent this is imprison Tywin
		name = agot_ninepenny.2032.b
		hard_imprison_character_effect = {
			TARGET = scope:tytos_heir
			IMPRISONER = root
		}

		stress_impact = {
			base = massive_stress_impact_gain
		}

		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_2
			}
		}
	}
}

agot_ninepenny.2033 = { #Tarbeck has left Reyne high and dry
	type = character_event
	title = agot_ninepenny.2033.t

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:messenger = character:Reyne_46
				}
				desc = agot_ninepenny.2033.desc.ellyn
			}
			desc = agot_ninepenny.2033.desc
		}
	}

	theme = court

	left_portrait = {
		character = root
		animation = rage
	}
	right_portrait = {
		character = scope:messenger
		animation = personality_vengeful
	}

	lower_left_portrait = scope:tarbeck

	lower_right_portrait = scope:lion_lord

	trigger = {
	}

	immediate = {
		title:k_the_westerlands.holder = {
			save_scope_as = lion_lord
		}
		title:d_tarrich.holder = {
			save_scope_as = tarbeck
		}
		if = {
			limit = {
				character:Reyne_46 ?= {
					is_alive = yes
				}
			}
			add_courtier = character:Reyne_46
			character:Reyne_46 = {
				save_scope_as = messenger
			}
		}
		else = {
			random_close_family_member = {
				save_scope_as = messenger
			}
		}

		dynasty = {
			random_dynasty_member = {
				limit = {
					bp2_valid_to_offer_as_hostage_trigger = { SENDER = root }
				}
				save_scope_as = hostage
			}
		}
	}

	option = { #We will rise without him
		name = agot_ninepenny.2033.a

		scope:lion_lord = {
			random_owned_story = { #Variable for Rebellion
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				set_variable = reyne_rebellion
			}
		}

		every_character_war = {
			limit = {
				OR = {
					primary_defender = title:k_the_westerlands.holder
					primary_attacker = title:k_the_westerlands.holder
				}
			}
			end_war = invalidated
		}

		start_war = {
			casus_belli = reyne_rebellion
			target = scope:lion_lord
			target_title = title:k_the_westerlands
		}
	}

	option = { #I guess I must capitulate...
		name = agot_ninepenny.2033.b

		pay_short_term_gold = {
			target = scope:lion_lord
			gold = 2500
		}

		scope:lion_lord = {
			take_hostage = scope:hostage
		}
		scope:tytos = {
			random_owned_story = { #No debt no issue
				limit = {
					story_type = story_agot_reyne_rebellion
				}
				end_story = yes
			}
		}
	}
}

#Conclusion Events

#The Reign of Castamere
agot_ninepenny.2050 = {
	type = character_event
	title = agot_ninepenny.2050.t
	desc = agot_ninepenny.2050.desc

	theme = court

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:singer
		animation = throne_room_bow_3
	}

	lower_left_portrait = scope:tytos #Dead man

	lower_right_portrait = scope:tarbeck

	trigger = {
		dynasty = dynasty:dynn_Reyne
	}

	immediate = {
		play_music_cue = CK3AGOT_castamere_lick

		if = {
			limit = {
				character:Singer_1 = { #Hamish the Harper
					is_alive = yes
					is_available_ai_adult = yes
				}
			}
			character:Singer_1 = {
				save_scope_as = singer
			}
		}
		else_if = {
			limit = {
				character:Tully_hh_5 = { #Tom of Seven Streams
					is_alive = yes
					is_available_ai_adult = yes
				}
			}
			character:Tully_hh_5 = {
				save_scope_as = singer
			}
		}
		else = {
			create_character = { #Just make a rando
				location = root.capital_province
				template = pool_repopulate_diplomacy
				gender_female_chance = 50
				trait = poet
				save_scope_as = singer
			}
		}
	}

	option = { #Reign
		name = agot_ninepenny.2050.a

		add_prestige_level = 1
		add_dread = massive_dread_gain
	}
}

#The Rains of Castamere
agot_ninepenny.2051 = {
	type = character_event
	title = agot_ninepenny.2051.t
	desc = agot_ninepenny.2051.desc

	theme = court

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:singer
		animation = throne_room_bow_3
	}

	lower_center_portrait = {
		trigger = {
			NOT = {
				root = character:Lannister_1
			}
		}
		character = character:Lannister_1
	}

	trigger = {
		dynasty = dynasty:dynn_Lannister
		title:k_the_westerlands.holder = {
			any_owned_story = { #Variable for Rebellion
				story_type = story_agot_reyne_rebellion
				exists = var:castamere_destroyed
			}
		}
	}

	immediate = {
		play_music_cue = CK3AGOT_castamere_lick

		if = {
			limit = {
				character:Singer_1 = { #Hamish the Harper
					is_alive = yes
					is_available_ai_adult = yes
				}
			}
			character:Singer_1 = {
				save_scope_as = singer
			}
		}
		else_if = {
			limit = {
				character:Tully_hh_5 = { #Tom of Seven Streams
					is_alive = yes
					is_available_ai_adult = yes
				}
			}
			character:Tully_hh_5 = {
				save_scope_as = singer
			}
		}
		else = {
			create_character = { #Just make a rando
				location = root.capital_province
				template = demanding_poet_character
				gender_female_chance = 50
				save_scope_as = singer
			}
		}
	}

	option = { #Rains
		name = agot_ninepenny.2050.a

		if = {
			limit = {
				character:Lannister_1 ?= {
					is_alive = yes
				}
			}
			character:Lannister_1 = {
				add_prestige_level = 1
				add_dread = massive_dread_gain
			}
		}
	}
}

#Dragons

#Maelys
agot_ninepenny.9000 = {
	hidden = yes

	immediate = {
		agot_spawn_bonded_hatchling_from_egg_effect = { OWNER = root EGG = scope:egg }
		scope:dragon = {
			agot_clear_dragon_genetic_traits_effect = yes
			add_trait = dragon_physique_good_3
			add_trait = dragon_ugly
			save_scope_as = maelys_dragon
		}
		every_character_artifact = {
			limit = {
				has_variable = dragon_egg
				NOT = { has_variable = selected_egg_for_hatching }
			}
			save_scope_as = egg_2
		}
		if = {
			limit = { has_game_rule = can_hatch_multiple_dragons_yes }
			agot_spawn_owned_hatchling_from_egg_effect = { OWNER = root EGG = scope:egg_2 }
		}
		every_courtier = {
				limit = { has_trait = dragon }
				add_to_list = hatched_dragons
		}
		every_courtier = {
			limit = { 
				has_trait = dragon
				NOT = { has_trait = dragon_destined }
			}
			add_trait = dragon_destined
		}
		
		trigger_event = agot_ninepenny.0063
	}
}

scripted_effect summerhall_extra_dragons_creation_effect = {
	set_variable = selected_egg_for_hatching
	save_scope_as = egg
	agot_spawn_owned_hatchling_from_egg_effect = { OWNER = root EGG = scope:egg }
}

scripted_trigger maelys_yes_sacrifice_yes = {
	agot_dragon_population_alive = yes
	exists = scope:sacrifice
}

scripted_trigger maelys_yes_sacrifice_no = {
	agot_dragon_population_alive = yes
	NOT = { exists = scope:sacrifice }
}

scripted_trigger maelys_no_sacrifice_yes = {
	agot_dragon_population_extinct = yes
	exists = scope:sacrifice
}

scripted_trigger maelys_no_sacrifice_no = {
	agot_dragon_population_extinct = yes
	NOT = { exists = scope:sacrifice }
}

#Summerhall
agot_ninepenny.9100 = {
	hidden = yes

	immediate = {
		hidden_effect = {
			#chance of no tragedy
			random = {
				chance = 0
				modifier = {
					maelys_yes_sacrifice_yes = yes
					add = 92
				}
				modifier = {
					maelys_yes_sacrifice_no = yes
					add = 70
				}
				modifier = {
					maelys_no_sacrifice_yes = yes
					add = 50
				}
				modifier = {
					maelys_no_sacrifice_no = yes
					add = 63
				}
				modifier = {
					has_game_rule = agot_story_historical_events_weighted_outcomes
					factor = 0.5
				}
				modifier = {
					has_game_rule = agot_story_historical_events_historical_outcomes
					factor = 0
				}
				save_scope_as = no_tragedy
				random = {
					chance = 0
					modifier = {
						maelys_yes_sacrifice_yes = yes
						add = 98 #total 90
					}
					modifier = {
						maelys_yes_sacrifice_no = yes
						add = 21 #total 15
					}
					modifier = {
						maelys_no_sacrifice_yes = yes
						add = 50 #total 25
					}
					modifier = {
						maelys_no_sacrifice_no = yes
						add = 13 #total 8
					}
					save_scope_as = dragon_hatched
				}
			}
			#chance of no tragedy
			if = {
				limit = {
					OR = {
						has_game_rule = summerhall_guaranteed
						has_game_rule = summerhall_guaranteed_all_seven
					}
				}
				save_scope_as = dragon_hatched
			}
			else_if = {
				limit = {
					has_game_rule = summerhall_not
				}
				random_list = {
					1 = {
						trigger_event = agot_ninepenny.1015
					}
					1 = {
						trigger_event = agot_ninepenny.1006
					}
				}
			}
			else_if = {
				limit = {
					has_game_rule = summerhall_seven_wild
				}
				title:c_ruins.holder = {
					trigger_event = {
						id = agot_ninepenny.9101
						years = 1
					}
				}
				trigger_event = agot_ninepenny.1006
			}

				
				#Maelys hatched already, three heads of the dragon
			if = {
				limit = {
					exists = scope:dragon_hatched
					any_in_global_list = {
						variable = living_dragons
						exists = this
					}
				}
				random_character_artifact = {
					limit = {
						prev = character:Targaryen_122
						has_variable = dragon_egg
						var:dragon_egg_color ?= flag:greengrey
					}
					alternative_limit = {
						has_variable = dragon_egg
					}
					set_variable = {
						name = selected_egg_for_hatching
						value = yes
					}
					save_scope_as = egg
				}
				add_character_flag = summerhall_hatched_dragon_three
				#3 eggs hatch
				# Bond at least one
				agot_spawn_bonded_hatchling_from_egg_effect = { OWNER = root EGG = scope:egg }
				if = {
					limit = {
						scope:sacrifice ?= character:Targaryen_2
					}
					scope:dragon = {
						agot_clear_dragon_genetic_traits_effect = yes
						add_trait = dragon_swift
						add_trait = dragon_majestic
					}
				}
				scope:dragon = {
					save_scope_as = dragon_first
				}
				add_character_flag = summerhall_hatched_dragon_multiple
				if = {
					limit = {
						has_game_rule = summerhall_guaranteed_all_seven
					}
					every_character_artifact = {
						limit = {
							has_variable = dragon_egg
							has_variable = agot_artifact_cannot_gift
						}
						summerhall_extra_dragons_creation_effect = yes
					}
				}
				else = {
					random_character_artifact = {
						limit = { has_variable = dragon_egg }
						summerhall_extra_dragons_creation_effect = yes
					}
					random_character_artifact = {
						limit = { has_variable = dragon_egg }
						summerhall_extra_dragons_creation_effect = yes
					}
				}
				every_character_artifact = {
					limit = {
						has_variable = dragon_egg
						has_variable = agot_artifact_cannot_gift
					}
					root = { destroy_owned_artifact = prev }
				}
				every_courtier = {
					limit = { has_trait = dragon }
					add_to_list = hatched_dragons
				}
				trigger_event = agot_ninepenny.1012
			}
			#Random dragons hatch
			else_if = {
				limit = {
					exists = scope:dragon_hatched
				}
				random_character_artifact = {
					limit = {
						prev = character:Targaryen_122
						has_variable = dragon_egg
						var:dragon_egg_color ?= flag:greengrey
					}
					alternative_limit = {
						has_variable = dragon_egg
					}
					set_variable = {
						name = selected_egg_for_hatching
						value = yes
					}
					save_scope_as = egg
				}
				#random eggs hatch
				# Bond at least one
				agot_spawn_bonded_hatchling_from_egg_effect = { OWNER = root EGG = scope:egg }
				if = {
					limit = {
						scope:sacrifice ?= character:Targaryen_2
					}
					scope:dragon = {
						agot_clear_dragon_genetic_traits_effect = yes
						add_trait = dragon_swift
						add_trait = dragon_majestic
					}
				}
				scope:dragon = {
					save_scope_as = dragon_first
				}
				# Create others
				every_character_artifact = { # Destroy other eggs too
					limit = {
						has_variable = dragon_egg
						has_variable = agot_artifact_cannot_gift
						NOT = { has_variable = selected_egg_for_hatching }
					}
					save_scope_as = this_egg
					if = {
						limit = {
							has_game_rule = summerhall_guaranteed_all_seven
						}
						hidden_effect = {
							summerhall_extra_dragons_creation_effect = yes
							root = { add_character_flag = summerhall_hatched_dragon_multiple }
						}
					}
					else = {
						random_list = {
							25 = {
									modifier = {
										has_game_rule = summerhall_guaranteed
										add = 70
									}
									modifier = {
										has_game_rule = summerhall_very_likely
										add = 40
									}
								hidden_effect = {
									summerhall_extra_dragons_creation_effect = yes
									root = { add_character_flag = summerhall_hatched_dragon_multiple }
								}
							}
							75 = {
								save_scope_as = this_egg
								hidden_effect = {
									root = { destroy_owned_artifact = scope:this_egg }
								}
							}
						}
					}
				}
				every_courtier = {
					limit = { has_trait = dragon }
					add_to_list = hatched_dragons
				}
				every_courtier = {
					limit = { 
						has_trait = dragon
						NOT = { has_trait = dragon_destined }
					}
					add_trait = dragon_destined
				}
				trigger_event = agot_ninepenny.1012
			}
			#Non-lethal failure
			else_if = {
				limit = {
					exists = scope:no_tragedy
				}
				trigger_event = agot_ninepenny.1015
			}
			else = {
				random = {
					chance = 0
					modifier = {
						maelys_yes_sacrifice_yes = yes
						add = 63 #total 5
					}
					modifier = {
						maelys_yes_sacrifice_no = yes
						add = 7 #total 2
					}
					modifier = {
						maelys_no_sacrifice_yes = yes
						add = 10 #total 5
					}
					modifier = {
						maelys_no_sacrifice_no = yes
						add = 8 #total 2
					}
					modifier = {
						has_game_rule = agot_story_historical_events_weighted_outcomes
						factor = 0.5
					}
					modifier = {
						has_game_rule = agot_story_historical_events_historical_outcomes
						factor = 0
					}
					modifier = {
						has_game_rule = summerhall_seven_wild
						factor = 0
					}
					title:c_ruins.holder = {
						trigger_event = {
							id = agot_ninepenny.9101
							years = 1
						}
					}
				}
				trigger_event = agot_ninepenny.1006
			}
		}
	}
}

agot_ninepenny.9101 = {
	hidden = yes

	immediate = {
		title:c_winterfell.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_riverrun.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_the_eyrie.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_casterly_rock.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_highgarden.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_storms_end.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}
		title:c_sunspear.holder = {
			agot_spawn_wild_child_dragon_effect = yes
			scope:dragon = {
				add_trait = dragon_destined
			}
		}

		every_player = {
			trigger_event = agot_ninepenny.9102
		}
	}
}

agot_ninepenny.9102 = {
	type = character_event
	title = agot_ninepenny.9102.t
	desc = agot_ninepenny.9102.desc

	theme = dragon

	override_background = {
		reference = bp1_bonfire
	}

	right_portrait = {
		character = scope:dragon
		animation = dragon_main
		camera = camera_dragon_event_standing_baby

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	lower_right_portrait = {
		character = scope:aegon
	}

	immediate = {
		character:Targaryen_122 = { save_scope_as = aegon }
	}

	option = {
		name = agot_ninepenny.9102.a
	}
}

agot_ninepenny.9998 = {
	hidden = yes

	immediate = {
		random_ruler = {
			random_courtier_or_guest = {
				save_scope_as = life_is_pain
			}
		}
		random_list = {
			0 = {
				modifier = {
					NOT = { scope:life_is_pain = { has_trait = brave } }
					add = 100
				}
				trigger_event = {
					id = agot_ninepenny.9998
					days = { 1 2 }
				}
			}
			0 = {
				modifier = {
					scope:life_is_pain = { has_trait = brave }
					add = 100
				}
				trigger_event = agot_ninepenny.0060
			}
		}
	}
}

agot_ninepenny.9999 = {
	hidden = yes

	immediate = {
		random_ruler = {
			random_courtier_or_guest = {
				save_scope_as = life_is_pain
			}
		}
		random_list = {
			0 = {
				modifier = {
					NOT = { scope:life_is_pain = { has_trait = brave } }
					add = 100
				}
				trigger_event = {
					id = agot_ninepenny.9999
					days = { 1 2 }
				}
			}
			0 = {
				modifier = {
					scope:life_is_pain = { has_trait = brave }
					add = 100
				}
				modifier = {
					character:Targaryen_2 = {
						is_alive = yes
						has_variable = agot_fated_pregnancy_months
						var:agot_fated_pregnancy_months >= 9
					}
					add = 40
				}
				every_in_list = {
					list = summerhall_attendees
					if = {
						limit = {
							NOT = { this = scope:summerhall_leader }
						}
						trigger_event = agot_ninepenny.1100
					}
				}

				trigger_event = {
					id = agot_ninepenny.1003 # Activate the Tragedy
					days = 1
				}
			}
		}
	}
}

