##########################
# Defiance of Duskendale #
##########################
namespace = agot_scenario_dd

# 1000 - 1000 # Introductory Event
# 0001 - 0003 # Defiant from the Start
# 0004 - 0009 # Another Kind of Defiance
# 0010 - 0011 # The Iron Throne Calls
# 0020 - 0022 # Ready the Horses
# 0080 - 0088 # Denys the Menys
# 0095 - 0111 # We Ride to War
# 0195 - 0199 # Selmy Saves
# 0200 - 0220 # The Issue of Duskendale
# 0300 - 0311 # Love and Marriage


####################################
########### Defiant from the Start #
####################################

agot_scenario_dd.1000 = { # Introductory Event for Rhaegar, Aerys and Denys
	type = character_event
	title = {
		first_valid = {
			triggered_desc = { # Rhaegar
				trigger = { root = character:Targaryen_3 }
				desc = agot_scenario_dd.1000.t.rhaegar
			}
			triggered_desc = { # Aerys
				trigger = { root = character:Targaryen_1 }
				desc = agot_scenario_dd.1000.t.aerys
			}
			triggered_desc = { # Denys
				trigger = { root = character:Darklyn_47 }
				desc = agot_scenario_dd.1000.t.denys
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = { # Rhaegar
				trigger = { root = character:Targaryen_3 }
				desc = agot_scenario_dd.1000.desc.rhaegar
			}
			triggered_desc = { # Aerys
				trigger = { root = character:Targaryen_1 }
				desc = agot_scenario_dd.1000.desc.aerys
			}
			triggered_desc = { # Denys
				trigger = { root = character:Darklyn_47 }
				desc = agot_scenario_dd.1000.desc.denys
			}
		}
	}

	theme = hostage
	override_background = { # Rhaegar
		trigger = { root = character:Targaryen_3 }
		reference = council_chamber
	}
	override_background = { # Aerys
		trigger = { root = character:Targaryen_1 }
		reference = dungeon
	}
	override_background = { # Denys
		trigger = { root = character:Darklyn_47 }
		reference = council_chamber
	}

	left_portrait = {
		character = root
		triggered_animation = { # Aerys
			trigger = { root = character:Targaryen_1 }
			animation = prisonhouse
		}
		triggered_animation = { # Else
			trigger = { always = yes }
			animation = thinking
		}
	}
	right_portrait = { # Chancellor
		trigger = { NOT = { root = character:Targaryen_1 } }
		character = root.cp:councillor_chancellor
	}
	lower_left_portrait = { # Steward
		trigger = { NOT = { root = character:Targaryen_1 } }
		character = root.cp:councillor_steward
	}
	lower_center_portrait = { # Marshal
		trigger = { NOT = { root = character:Targaryen_1 } }
		character = root.cp:councillor_marshal
	}
	lower_right_portrait = { # Admiral
		trigger = { NOT = { root = character:Targaryen_1 } }
		character = root.cp:councillor_admiral
	}

	immediate = {
		character:Targaryen_1 ?= { save_scope_as = aerys }
		character:Targaryen_3 ?= { save_scope_as = rhaegar }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Darklyn_47 ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
	}

	option = { # Rhaegar Option
		name = agot_scenario_dd.1000.opt.a
		trigger = { root = character:Targaryen_3 }
	}

	option = { # Aerys Option
		name = agot_scenario_dd.1000.opt.b
		trigger = { root = character:Targaryen_1 }
	}

	option = { # Denys Option
		name = agot_scenario_dd.1000.opt.c
		trigger = { root = character:Darklyn_47 }
		add_trait = torturer
		character:Darklyn_47 ?= {
			run_interaction = {
				interaction = torture_interaction
				actor = prev
				recipient = character:Targaryen_1
				execute_threshold = accept
			}
		}
	}
}

##################################
# Tywin and Rhaegar Set the Pace #
##################################

agot_scenario_dd.0001 = { # On Start of Defiance of Duskendale Scenario; Denys Requests Vassal Contract Changes
	type = character_event
	title = agot_scenario_dd.0001.t
	desc = agot_scenario_dd.0001.desc

	theme = hostage
	override_background = { reference = council_chamber }

	left_portrait = root
	right_portrait = { character = root.liege.cp:councillor_chancellor }
	lower_left_portrait = { character = root.liege.cp:councillor_steward }
	lower_center_portrait = { character = root.liege.cp:councillor_marshal }
	# lower_right_portrait = { character = root.liege.cp:councillor_spymaster } # Aerys has no spymaster at first
	lower_right_portrait = { character = root.liege.cp:councillor_admiral }

	immediate = {
		character:Targaryen_1 ?= { save_scope_as = aerys }
		character:Targaryen_3 ?= { save_scope_as = rhaegar }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Darklyn_47 ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
	}

	option = { # Tywin Agrees to the Terms
		name = agot_scenario_dd.0001.opt.a

		trigger_event = { # Aerys Will Disagree
			id = agot_scenario_dd.0002
			days = { 20 30 }
		}

		show_as_tooltip = { # Preview the Vassal Contract
			title:d_duskendale.holder ?= {
				vassal_contract_set_obligation_level = {
					type = feudal_government_levies
					level = feudal_levies_exempt_level
				}
				vassal_contract_set_obligation_level = {
					type = feudal_government_taxes
					level = feudal_tax_exempt_level
				}
				vassal_contract_set_obligation_level = {
					type = coinage_rights
					level = 1
				}
				vassal_contract_set_obligation_level = {
					type = council_rights
					level = 1
				}
				vassal_contract_set_obligation_level = {
					type = fortification_rights
					level = 1
				}
			}
		}

		ai_chance = {
			base = 10 # Slightly Boosted
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Tywin Starts the Rescue War; Activates Barristan Selmy
		name = agot_scenario_dd.0001.opt.b
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
		}

		start_war = { # Tywin Calls the Banners
			casus_belli = rv_duskendale_rescue_war
			target = title:d_duskendale.holder
		}
		scope:scenario_dd_story ?= { # Engage the Story Cycle
			set_variable = {
				name = agot_dd_scenario
				value = flag:engaged
			}
		}
		# Wear Your Armor
		agot_dd_wear_your_armor = yes
		agot_dd_remove_planning_flag = yes

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}
}

agot_scenario_dd.0002 = { # Tywin Accepted the Demands; Aerys Will Demand to Break Agreement
	type = character_event
	title = agot_scenario_dd.0002.t
	desc = agot_scenario_dd.0002.desc

	theme = diplomacy
	override_background = { reference = council_chamber }

	left_portrait = root
	right_portrait = { character = root.liege.cp:councillor_chancellor }
	lower_left_portrait = { character = root.liege.cp:councillor_steward }
	lower_center_portrait = { character = root.liege.cp:councillor_marshal }
	lower_right_portrait = { character = root.liege.cp:councillor_spymaster }

	immediate = {
		title:d_duskendale.holder ?= { # Set the Updated Vassal Contract
			vassal_contract_set_obligation_level = {
				type = feudal_government_levies
				level = feudal_levies_exempt_level
			}
			vassal_contract_set_obligation_level = {
				type = feudal_government_taxes
				level = feudal_tax_exempt_level
			}
			vassal_contract_set_obligation_level = {
				type = coinage_rights
				level = 1
			}
			vassal_contract_set_obligation_level = {
				type = council_rights
				level = 1
			}
			vassal_contract_set_obligation_level = {
				type = fortification_rights
				level = 1
			}
		}
	}

	option = { # Original Vassal Contract Restored; Tywin Starts the Rescue War
		name = agot_scenario_dd.0002.opt.a
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
		}

		title:d_duskendale.holder ?= { # Return the Vassal Contract to Original Form
			vassal_contract_set_obligation_level = {
				type = feudal_government_levies
				level = feudal_levies_high_level
			}
			vassal_contract_set_obligation_level = {
				type = feudal_government_taxes
				level = feudal_tax_high_level
			}
			vassal_contract_set_obligation_level = {
				type = coinage_rights
				level = 0
			}
			vassal_contract_set_obligation_level = {
				type = council_rights
				level = 0
			}
			vassal_contract_set_obligation_level = {
				type = fortification_rights
				level = 0
			}
		}
		start_war = { # Tywin Calls the Banners
			casus_belli = rv_duskendale_rescue_war
			target = title:d_duskendale.holder
		}
		scope:scenario_dd_story ?= { # Engage the Story Cycle
			set_variable = {
				name = agot_dd_scenario
				value = flag:engaged
			}
		}
		# Wear Your Armor
		agot_dd_wear_your_armor = yes
		agot_dd_remove_planning_flag = yes

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	option = { # Tywin Declines and the Changes Stay; Rhaegar Notified
		name = agot_scenario_dd.0002.opt.b

		title:k_dragonstone.holder ?= {
			trigger_event = {
				id = agot_scenario_dd.0003
				days = { 14 28 }
			}
		}

		ai_chance = {
			base = 10 # Slightly Boosted
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}
}

agot_scenario_dd.0003 = { # Rhaegar Notified of Tywin Declining the King's Command
	type = character_event
	title = agot_scenario_dd.0003.t
	desc = agot_scenario_dd.0003.desc

	theme = diplomacy
	override_background = { reference = council_chamber }

	left_portrait = root
	right_portrait = { character = root.liege.cp:councillor_castellan }
	lower_left_portrait = { character = root.liege.cp:councillor_chancellor }
	lower_center_portrait = { character = root.liege.cp:councillor_steward }
	lower_right_portrait = { character = root.liege.cp:councillor_spymaster }

	option = { # Rhaegar Agrees with Tywin's Decision; Sends for Great Council to Depose King
		name = agot_scenario_dd.0003.opt.a
		custom_tooltip = agot_scenario_dd.0003.a.tt

		hidden_effect = {
			title:e_the_iron_throne.holder ?= { # Seven Kingdoms and the Crownlands Vassals
				every_vassal = {
					limit = {
						NOR = {
							primary_title = title:k_dragonstone
							primary_title = title:k_the_most_devout
							primary_title = title:k_the_westerlands
							primary_title = title:d_duskendale
							primary_title = title:d_kingsguard
						}
						is_human = yes
						primary_title.tier >= tier_duchy
					}
					trigger_event = {
						id = agot_scenario_dd.0004
						days = { 14 28 }
					}
				}
			}
			character:Targaryen_3 ?= { # Send Rhaegar to King's Landing to Receive Council
				add_character_flag = planning_an_activity
				if = {
					limit = { NOT = { employs_court_position = travel_leader_court_position } }
					random_courtier = {
						limit = {
							is_available_adult = yes
							is_valid_travel_leader_trigger = yes
						}
						save_scope_as = travel_leader
					}
					appoint_court_position = {
						recipient = scope:travel_leader
						court_position = travel_leader_court_position
					}
				}

				# Travel to King's Landing
				start_travel_plan = {
					players_use_planner = no
					destination = liege.capital_province
					on_arrival_event = agot_scenario_dd.0021
					on_arrival_destinations = last
					return_trip = no
				}
				save_scope_as = blues_traveler
				agot_gc_travel_safety_boost = yes
			}
			character:Lannister_1 ?= { # Send Tywin to King's Landing to Receive Council(if AI)
				if = {
					limit = { is_ai = yes }
					add_character_flag = planning_an_activity
					if = {
						limit = { NOT = { employs_court_position = travel_leader_court_position } }
						random_courtier = {
							limit = {
								is_available_adult = yes
								is_valid_travel_leader_trigger = yes
							}
							save_scope_as = travel_leader
						}
						appoint_court_position = {
							recipient = scope:travel_leader
							court_position = travel_leader_court_position
						}
					}

					# Travel to King's Landing
					start_travel_plan = {
						players_use_planner = no
						destination = liege.capital_province
						on_arrival_event = agot_scenario_dd.0021
						on_arrival_destinations = last
						return_trip = no
					}
					save_scope_as = blues_traveler
					agot_gc_travel_safety_boost = yes
				}
				else_if = {
					limit = { is_ai = no }
					trigger_event = {
						id = agot_scenario_dd.0020
					}
				}
			}
		}

		ai_chance = { base = 50 }
	}

	option = { # Tywin Removed as Hand; Rhaegar Becomes Hand and Starts Rescue War
		name = agot_scenario_dd.0003.opt.b
		custom_tooltip = agot_scenario_dd.0003.b.tt

		character:Targaryen_1 ?= { # Replace Tywin with Rhaegar as Hand and Regent
			if = {
				limit = { exists = cp:councillor_castellan }
				cp:councillor_castellan = { unblock_firing_councillor_effect = yes }
				fire_councillor = cp:councillor_castellan
			}
			designate_diarch = title:k_dragonstone.holder
			assign_councillor_type = {
				type = councillor_castellan
				target = title:k_dragonstone.holder
			}
		}
		character:Targaryen_3 ?= { block_firing_councillor_effect = { COURT_OWNER = character:Targaryen_1 } }
		title:d_duskendale.holder ?= { # Return the Vassal Contract to Original Form
			vassal_contract_set_obligation_level = {
				type = feudal_government_levies
				level = feudal_levies_high_level
			}
			vassal_contract_set_obligation_level = {
				type = feudal_government_taxes
				level = feudal_tax_high_level
			}
			vassal_contract_set_obligation_level = {
				type = coinage_rights
				level = 0
			}
			vassal_contract_set_obligation_level = {
				type = council_rights
				level = 0
			}
			vassal_contract_set_obligation_level = {
				type = fortification_rights
				level = 0
			}
		}
		start_war = { # Rhaegar Calls the Banners
			casus_belli = rv_duskendale_rescue_war
			target = title:d_duskendale.holder
		}
		scope:scenario_dd_story ?= { # Engage the Story Cycle
			set_variable = {
				name = agot_dd_scenario
				value = flag:engaged
			}
		}
		# Wear Your Armor
		agot_dd_wear_your_armor = yes
		agot_dd_remove_planning_flag = yes

		ai_chance = { base = 50 }
	}
}


######################################
########### Another Kind of Defiance #
######################################

###############################
# The Great Council is Called #
###############################

agot_scenario_dd.0004 = { # Great Council Summons; Sent to Direct Vassals of the Iron Throne
	type = character_event
	title = agot_scenario_dd.0004.t
	desc = agot_scenario_dd.0004.desc

	theme = diplomacy
	override_background = { reference = study }

	left_portrait = root
	right_portrait = { character = root.cp:councillor_chancellor }

	trigger = {
		character:Targaryen_1 ?= { is_alive = yes }
		title:e_the_iron_throne.holder = character:Targaryen_1
	}

	option = { # I'll Be There
		name = agot_scenario_dd.0004.opt.a
		custom_tooltip = agot_scenario_dd.0004.a.tt

		hidden_effect = {
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				random_courtier = {
					limit = {
						is_available_adult = yes
						is_valid_travel_leader_trigger = yes
					}
					save_scope_as = travel_leader
				}
				appoint_court_position = {
					recipient = scope:travel_leader
					court_position = travel_leader_court_position
				}
			}

			# Travel to King's Landing
			start_travel_plan = {
				players_use_planner = no
				destination = liege.capital_province
				on_arrival_event = agot_scenario_dd.0005
				on_arrival_destinations = last
				return_trip = no
			}
			save_scope_as = blues_traveler
			agot_gc_travel_safety_boost = yes
		}

		ai_chance = { base = 100 } # AI Shouldn't Refuse
	}

	option = { # I Don't Care
		name = agot_scenario_dd.0004.opt.b
		custom_tooltip = agot_scenario_dd.0004.b.tt

		stress_impact = { # Stressed?
			shrewd = minor_stress_impact_gain
			content = minor_stress_impact_loss
			just = minor_stress_impact_gain
			arrogant = minor_stress_impact_loss
			diligent = minor_stress_impact_gain
		}
		remove_character_flag = planning_an_activity

		ai_chance = { base = 0 }
	}
}

agot_scenario_dd.0005 = { # Great Council Arrives; Greetings
	type = character_event
	title = agot_scenario_dd.0005.t
	desc = agot_scenario_dd.0005.desc

	theme = travel
	override_background = { reference = courtyard }

	left_portrait = root
	right_portrait = { character = character:Targaryen_3 }
	lower_left_portrait = { character = root.liege.cp:kingsguard_lord_commander }
	lower_center_portrait = { character = root.liege.cp:kingsguard_2 }
	lower_right_portrait = { character = root.liege.cp:councillor_castellan }

	immediate = { # Stay in King's Landing
		root = {
			set_location = {
				location = liege.capital_province
				stick_to_location = yes
			}
		}
		root.capital_province ?= { save_scope_as = home }
	}

	option = { # Something
		name = agot_scenario_dd.0005.opt.a
		custom_tooltip = agot_scenario_dd.0005.a.tt

		stress_impact = {
			patient = minor_stress_impact_loss
			gregarious = minor_stress_impact_loss
			impatient = minor_stress_impact_gain
		}
	}

	after = { # Send the Voting Event
		if = {
			limit = {
				character:Targaryen_1 ?= {
					is_alive = yes
					is_imprisoned = yes
				}
				title:e_the_iron_throne.holder ?= character:Targaryen_1
			}
			trigger_event = {
				id = agot_scenario_dd.0006
				months = 2
			}
		}
		else_if = {
			limit = { character:Targaryen_1 ?= { is_alive = no } }
			# Go Home
			start_travel_plan = {
				players_use_planner = no
				destination = scope:home
				on_arrival_event = agot_scenario_dd.0022
				on_arrival_destinations = last
				return_trip = no
			}
			save_scope_as = blues_traveler
			agot_gc_travel_safety_boost = yes
		}
		if = {
			limit = { NOT = { has_global_variable = aerys_gc_started } }
			character:Targaryen_3 ?= {
				trigger_event = {
					id = agot_scenario_dd.0006
					months = 2
				}
			}
			character:Lannister_1 ?= {
				trigger_event = {
					id = agot_scenario_dd.0006
					months = 2
				}
			}
			set_global_variable = aerys_gc_started
		}
	}
}

agot_scenario_dd.0006 = { # Great Council Votes; Direct Vassals of the Iron Throne Choose Sides
	type = character_event
	title = agot_scenario_dd.0006.t
	desc = {
		first_valid = {
			triggered_desc = { # Voting Event
				trigger = {
					NOR = {
						root = character:Targaryen_3
						root = character:Lannister_1
					}
				}
				desc = agot_scenario_dd.0006.desc.voting
			}
			triggered_desc = { # Observing Event
				trigger = {
					OR = {
						root = character:Targaryen_3
						root = character:Lannister_1
					}
				}
				desc = agot_scenario_dd.0006.desc.observing
			}
		}
	}

	theme = diplomacy
	override_background = { reference = agot_iron_throne }

	left_portrait = root
	right_portrait = {
		trigger = {
			NOR = {
				root = character:Targaryen_3
				root = character:Lannister_1
			}
		}
		character = character:Targaryen_3
	}

	trigger = {
		character:Targaryen_1 ?= { is_alive = yes }
		title:e_the_iron_throne.holder = character:Targaryen_1
	}

	option = { # Vote Yes
		name = agot_scenario_dd.0006.opt.a
		custom_tooltip = agot_scenario_dd.0006.a.tt
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
			title:e_the_iron_throne.holder ?= character:Targaryen_1
			NOR = {
				root = character:Targaryen_3
				root = character:Lannister_1
			}
		}

		character:Targaryen_3 ?= {
			add_to_variable_list = {
				name = gc_deposed_aerys
				target = prev
			}
		}
		stress_impact = { # Stressed?
			cynical = minor_stress_impact_loss
			craven = minor_stress_impact_loss
			paranoid = minor_stress_impact_gain
		}
		add_character_flag = aerys_gc_voted_yes
		trigger_event = { # Send the Results
			id = agot_scenario_dd.0007
		}

		ai_chance = { base = 0 }
	}

	option = { # Vote No
		name = agot_scenario_dd.0006.opt.b
		custom_tooltip = agot_scenario_dd.0006.b.tt
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
			title:e_the_iron_throne.holder ?= character:Targaryen_1
			NOR = {
				root = character:Targaryen_3
				root = character:Lannister_1
			}
		}

		character:Targaryen_1 ?= {
			add_to_variable_list = {
				name = gc_kept_aerys
				target = prev
			}
		}
		stress_impact = { # Stressed?
			loyal = minor_stress_impact_loss
			craven = minor_stress_impact_gain
			paranoid = minor_stress_impact_gain
		}
		add_character_flag = aerys_gc_voted_no
		trigger_event = { # Send the Results
			id = agot_scenario_dd.0007
		}

		ai_chance = { base = 0 }
	}

	option = { # Tywin/Rhaegar Observing
		name = agot_scenario_dd.0006.opt.c
		custom_tooltip = agot_scenario_dd.0006.c.tt
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
			title:e_the_iron_throne.holder ?= character:Targaryen_1
			OR = {
				root = character:Targaryen_3
				root = character:Lannister_1
			}
		}
		trigger_event = { # Send the Results
			id = agot_scenario_dd.0007
		}

		ai_chance = { base = 0 }
	}

	after = { # Send the Result Confirmation to Aerys
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_variable = aerys_gc_voted } }
				if = {
					limit = { title:e_the_iron_throne.holder ?= character:Targaryen_1 }
					title:e_the_iron_throne.holder = {
						set_global_variable = aerys_gc_voted
						trigger_event = {
							id = agot_scenario_dd.0009
							days = { 24 60 }
						}
					}
				}
				character:Targaryen_3 ?= { # Send Rhaegar Home
					start_travel_plan = {
						players_use_planner = no
						destination = title:k_dragonstone.holder.capital_province
						on_arrival_event = agot_scenario_dd.0022
						on_arrival_destinations = last
						return_trip = no
					}
					save_scope_as = blues_traveler
					agot_gc_travel_safety_boost = yes
				}
				character:Lannister_1 ?= { # Send Tywin Home
					start_travel_plan = {
						players_use_planner = no
						destination = title:k_the_westerlands.holder.capital_province
						on_arrival_event = agot_scenario_dd.0022
						on_arrival_destinations = last
						return_trip = no
					}
					save_scope_as = blues_traveler
					agot_gc_travel_safety_boost = yes
				}
			}
			if = {
				limit = {
					NOR = {
						root = character:Targaryen_3
						root = character:Lannister_1
					}
				}
				# Go Home
				start_travel_plan = {
					players_use_planner = no
					destination = scope:home
					on_arrival_event = agot_scenario_dd.0022
					on_arrival_destinations = last
					return_trip = no
				}
				save_scope_as = blues_traveler
				agot_gc_travel_safety_boost = yes
			}
		}
	}
}

agot_scenario_dd.0007 = { # Great Council Results; Sent to Direct Vassals of the Iron Throne and Tywin/Rhaegar as they vote
	type = character_event
	title = agot_scenario_dd.0007.t
	desc = {
		first_valid = {
			triggered_desc = { # Tywin
				trigger = {	root = character:Lannister_1 }
				desc = agot_scenario_dd.0007.desc.tywin
			}
			triggered_desc = { # Rhaegar
				trigger = {	root = character:Targaryen_3 }
				desc = agot_scenario_dd.0007.desc.rhaegar
			}
			triggered_desc = { # Vassal Yes Vote
				trigger = {
					NOR = {
						root = character:Targaryen_3
						root = character:Lannister_1
					}
					has_character_flag = aerys_gc_voted_yes
				}
				desc = agot_scenario_dd.0007.desc.guest.yes
			}
			triggered_desc = { # Vassal No Vote
				trigger = {
					NOR = {
						root = character:Targaryen_3
						root = character:Lannister_1
					}
					has_character_flag = aerys_gc_voted_no
				}
				desc = agot_scenario_dd.0007.desc.guest.no
			}
		}
	}

	theme = diplomacy
	override_background = { reference = agot_iron_throne }

	left_portrait = root
	right_portrait = {
		trigger = { NOT = { root = character:Targaryen_3 } }
		character = character:Targaryen_3
	}
	lower_left_portrait = { character = root.liege.cp:kingsguard_lord_commander }
	lower_center_portrait = { character = root.liege.cp:kingsguard_2 }
	lower_right_portrait = {
		trigger = { NOT = { root = character:Lannister_1 } }
		character = root.liege.cp:councillor_castellan
	}

	trigger = {
		root = { is_ai = no }
		character:Targaryen_1 ?= { is_alive = yes }
		title:e_the_iron_throne.holder ?= character:Targaryen_1
	}

	option = { # Tywin
		name = agot_scenario_dd.0007.opt.a
		custom_tooltip = agot_scenario_dd.0007.a.tt
		trigger = { root = character:Lannister_1 }

		ai_chance = { base = 0 }
	}

	option = { # Rhaegar
		name = agot_scenario_dd.0007.opt.b
		custom_tooltip = agot_scenario_dd.0007.b.tt
		trigger = { root = character:Targaryen_3 }

		ai_chance = { base = 0 }
	}

	option = { # War is on the Horizon
		name = agot_scenario_dd.0007.opt.c
		custom_tooltip = agot_scenario_dd.0007.c.tt
		trigger = {
			NOR = {
				root = character:Targaryen_3
				root = character:Lannister_1
			}
		}

		ai_chance = { base = 0 }
	}
}


###############################
# The Great Council Ultimatum #
###############################

agot_scenario_dd.0009 = { # The Results of the Great Council Vote; Aerys Chooses His Fate
	type = character_event
	title = agot_scenario_dd.0009.t
	desc = agot_scenario_dd.0009.desc

	theme = corruption
	override_background = {
		trigger = { character:Targaryen_1 ?= { is_imprisoned = yes } }
		reference = dungeon
	}
	override_background = {
		trigger = { character:Targaryen_1 ?= { is_imprisoned = no } }
		reference = bedchamber
	}

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { character:Targaryen_1 ?= { is_imprisoned = yes } }
			animation = prison_house
		}
		triggered_animation = {
			trigger = { character:Targaryen_1 ?= { is_imprisoned = no } }
			animation = rage
		}
	}
	right_portrait = { character = title:k_dragonstone.holder }
	lower_left_portrait = { character = title:k_the_north.holder }
	lower_center_portrait = { character = title:k_the_reach.holder }
	lower_right_portrait = { character = title:k_the_riverlands.holder }

	trigger = {
		character:Targaryen_1 ?= { is_alive = yes }
		title:e_the_iron_throne.holder ?= character:Targaryen_1
	}

	immediate = {
		title:e_the_iron_throne.holder ?= {
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
	}

	option = { # Aerys Accepts the Great Council's Decision; Aerys is Deposed and Replaced by Rhaegar
		name = agot_scenario_dd.0009.opt.a

		show_as_tooltip = { # Preview Aerys Out; Rhaegar In
			depose = yes
		}
		title:k_dragonstone.holder ?= {
			trigger_event = {
				id = agot_scenario_dd.0010
			}
		}
		hidden_effect = {
			character:Targaryen_1 ?= { remove_character_flag = keep_imprisoned }
			remove_global_variable = aerys_imprisoned
		}

		scope:scenario_dd_story ?= { # The Scenario is Resolved
			set_variable = {
				name = agot_dd_scenario
				value = flag:resolved
			}
			set_variable = {
				name = agot_dd_selmy
				value = flag:resolved
			}
		}

		ai_chance = {
			base = 25
			modifier = { add = agot_nonhistoric_outcome_3 } # Non-historic Weight
		}
	}

	option = { # Aerys Declines the Great Council's Decision; Rhaegar Starts Claimant War
		name = agot_scenario_dd.0009.opt.b

		character:Targaryen_3 ?= { # Rhaegar Calls the Banners
			start_war = {
				casus_belli = agot_duskendale_iron_throne_war
				target = title:e_the_iron_throne.holder
				target_title = title:e_the_iron_throne
				target_title = title:k_the_crownlands
				target_title = title:d_kings_landing
				target_title = title:c_kings_landing
				target_title = title:c_summerfield
				claimant = character:Targaryen_3
			}
			# Wear Your Armor
			agot_dd_wear_your_armor = yes
		}
		hidden_effect = {
			title:d_duskendale.holder ?= { # Denys Isn't Invited
				trigger_event = {
					id = agot_scenario_dd.0097
				}
			}
			title:k_dragonstone.holder ?= { # Add Attackers
				trigger_event = {
					id = agot_scenario_dd.0098
				}
			}
			title:e_the_iron_throne.holder ?= { # Add Defenders
				trigger_event = {
					id = agot_scenario_dd.0099
				}
			}
			character:Targaryen_1 ?= { remove_character_flag = keep_imprisoned }
		}

		ai_chance = {
			base = 50
			modifier = { add = agot_historic_outcome_3 } # Historic Weight
		}
	}
}


###################################
########### The Iron Throne Calls #
###################################

############################
# Iron Throne Setup Events #
############################

agot_scenario_dd.0010 = { # Rhaegar Iron Throne Setup
	hidden = yes

	immediate = {
		if = {
			limit = { title:e_the_iron_throne.holder ?= character:Targaryen_1 }
			character:Targaryen_1 ?= { # Rhaegar Becomes King; Aerys Bcomes Landless
				depose = yes
				if = {
					limit = { is_imprisoned = no }
					agot_dd_camping_dragons = yes # Fallback if Aerys is somehow free and the event still fires
				}
				trigger_event = {
					id = agot_scenario_dd.0012
					months = 6
				}
			}
		}
		character:Targaryen_3 ?= { # Adds Aerys to Court Fallback; Moves Capital Location
			if = {
				limit = {
					character:Targaryen_1 ?= {
						is_imprisoned = no
						is_landless_adventurer = no
						NOT = { is_courtier_of = character:Targaryen_3 }
					}
				}
				add_courtier = character:Targaryen_1
			}
			set_realm_capital = title:c_kings_landing
		}
	}
}

agot_scenario_dd.0011 = { # Rhaegar Iron Throne Setup for Aerys Dying in Captivity
	hidden = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					character:Selmy_3 ?= {
						is_alive = yes
						has_character_flag = yearly_1010_abductor
						has_character_flag = agot_is_at_unknown_place
						has_character_flag = use_stealth_clothes
					}
				}
				character:Selmy_3 = {
					remove_character_flag = yearly_1010_abductor
					remove_character_flag = agot_is_at_unknown_place
					remove_character_flag = use_stealth_clothes
					set_location = {
						location = liege.capital_province
					}
				}
			}
			# Restore Small Council
			agot_dd_rhaegar_throne_setup = yes
		}
	}
}

agot_scenario_dd.0012 = { # Give Aerys Uncouth
	hidden = yes

	immediate = {
		if = {
			limit = { NOT = { has_trait = uncouth } }
			add_trait = uncouth
		}
	}
}


##############################
########### Ready the Horses #
##############################

#########################
# Location Setup Events #
#########################

agot_scenario_dd.0020 = { # Great Council Summons; Sent to Tywin when Player
	type = character_event
	title = agot_scenario_dd.0020.t
	desc = agot_scenario_dd.0020.desc

	theme = diplomacy
	override_background = { reference = sitting_room }

	left_portrait = root
	right_portrait = { character = root.cp:councillor_chancellor }

	option = { # I'll Be There
		name = agot_scenario_dd.0020.opt.a
		custom_tooltip = agot_scenario_dd.0020.a.tt

		hidden_effect = {
			if = {
				limit = { NOT = { employs_court_position = travel_leader_court_position } }
				random_courtier = {
					limit = {
						is_available_adult = yes
						is_valid_travel_leader_trigger = yes
					}
					save_scope_as = travel_leader
				}
				appoint_court_position = {
					recipient = scope:travel_leader
					court_position = travel_leader_court_position
				}
			}

			# Travel to King's Landing
			start_travel_plan = {
				players_use_planner = no
				destination = liege.capital_province
				on_arrival_event = agot_scenario_dd.0021
				on_arrival_destinations = last
				return_trip = no
			}
			save_scope_as = blues_traveler
			agot_gc_travel_safety_boost = yes
		}

		ai_chance = { base = 100 } # AI Shouldn't Refuse
	}

	option = { # I Don't Care
		name = agot_scenario_dd.0020.opt.b
		custom_tooltip = agot_scenario_dd.0020.b.tt

		stress_impact = { # Stressed?
			shrewd = minor_stress_impact_gain
			content = minor_stress_impact_loss
			just = minor_stress_impact_gain
			arrogant = minor_stress_impact_loss
			diligent = minor_stress_impact_gain
		}

		ai_chance = { base = 0 }
	}
}

agot_scenario_dd.0021 = { # Rhaegar and Tywin Travel Location Sticking
	hidden = yes

	immediate = {
		if = {
			limit = { this ?= character:Targaryen_3 }
			character:Targaryen_3 = {
				set_location = {
					location = liege.capital_province
					stick_to_location = yes
				}
			}
		}
		else_if = {
			limit = { this ?= character:Lannister_1 }
			character:Lannister_1 = {
				set_location = {
					location = liege.capital_province
					stick_to_location = yes
				}
			}
		}
	}
}

agot_scenario_dd.0022 = { # Remove Travel Block
	hidden = yes

	immediate = {
		if = {
			limit = { has_character_flag = planning_an_activity }
			remove_character_flag = planning_an_activity
		}
	}
}


#############################
########### Denys the Menys #
#############################

##########################
# Denys Loses Duskendale #
##########################

agot_scenario_dd.0080 = { # Duskendale Has Been Sieged; Sent to Denys
	type = character_event
	title = agot_scenario_dd.0080.t
	desc = agot_scenario_dd.0080.desc

	theme = martial
	override_background = { reference = burning_building }

	widgets = {
		widget = {
			gui = "agot_event_shader_sparks"
			container = "agot_shader_event_background"
		}
	}

	left_portrait = {
		character = root
		animation = paranoia
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	right_portrait = {
		character = scope:rescue_war_winner
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	lower_left_portrait = { character = character:Targaryen_1 }

	immediate = {
		character:Targaryen_1 ?= { save_scope_as = aerys }
		title:d_duskendale ?= { save_scope_as = duskendale }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		character:Rykker_2.house.house_head ?= { save_scope_as = renfred }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
	}

	option = { # Duskendale Has Fallen; Look at me: You are the prisoner now
		name = agot_scenario_dd.0080.opt.a
		custom_tooltip = agot_scenario_dd.0080.a.tt

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # They Left Me No Choice
		name = agot_scenario_dd.0080.opt.b
		custom_tooltip = agot_scenario_dd.0080.b.tt
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = yes
			}
			has_character_flag = ravaged_by_war
		}

		character:Targaryen_1 ?= {
			death = {
				death_reason = death_attacked
				killer = title:d_duskendale.holder
			}
		}
		character:Targaryen_3 ?= {
			add_opinion = {
				target = title:d_duskendale.holder
				modifier = murdered_close_family_crime
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	after = {
		if = {
			limit = {
				character:Targaryen_1 ?= { is_alive = yes }
				title:e_the_iron_throne.holder ?= character:Targaryen_1
				title:k_dragonstone.holder ?= character:Targaryen_3
			}
			title:e_the_iron_throne.holder ?= { # Tywin-win
				trigger_event = {
					id = agot_scenario_dd.0100
					delayed = yes
				}
				add_character_flag = rescued_by_war
			}
			if = {
				limit = { scope:rescue_war_winner ?= character:Lannister_1 }
				title:k_dragonstone.holder ?= {
					trigger_event = {
						id = agot_scenario_dd.0100
					}
				}
			}
		}
		else_if = {
			limit = {
				character:Targaryen_1 ?= { is_alive = no }
				title:e_the_iron_throne.holder ?= character:Targaryen_3
			}
			character:Targaryen_3 ?= { # Tywin-lose
				trigger_event = {
					id = agot_scenario_dd.0199
					delayed = yes
				}
				add_character_flag = casualty_of_war
			}
		}
	}
}

agot_scenario_dd.0081 = { # Selmy Results Fire; Sent to Denys
	type = character_event
	title = {
		first_valid = {
			triggered_desc = { # Selmy Failed
				trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
				desc = agot_scenario_dd.0081.t.fail
			}
			triggered_desc = { # Selmy Saved
				trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }
				desc = agot_scenario_dd.0081.t.success
			}
			triggered_desc = { # Aerys Died Early
				trigger = { character:Targaryen_1 ?= { is_alive = no } }
				desc = agot_scenario_dd.0081.t.early_death
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = { # Selmy Failed
				trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
				desc = agot_scenario_dd.0081.desc.fail
			}
			triggered_desc = { # Selmy Saved
				trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }
				desc = agot_scenario_dd.0081.desc.success
			}
			triggered_desc = { # Aerys Died Early
				trigger = { character:Targaryen_1 ?= { is_alive = no } }
				desc = agot_scenario_dd.0081.desc.early_death
			}
		}
	}

	theme = hostage
	override_background = {
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
		reference = army_camp
	}
	override_background = {
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }
		reference = bedchamber
	}

	left_portrait = {
		character = root
		triggered_animation = { # Selmy Failed
			trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
			animation = personality_callous
		}
		triggered_animation = { # Selmy Saved
			trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }
			animation = anger
		}
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	right_portrait = {
		character = scope:courtier
		triggered_animation = { # Selmy Failed
			trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
			animation = war_attacker
		}
		triggered_animation = { # Selmy Saved
			trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }
			animation = fear
		}
	}
	lower_left_portrait = { # Selmy Failed
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
		character = character:Targaryen_1
		animation = loss_1
	}
	lower_right_portrait = { # Selmy Failed
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }
		character = character:Selmy_3
	}

	immediate = {
		if = {
			limit = {
				character:Targaryen_1 ?= {
					OR = {
						has_character_flag = selmy_saved
						has_character_flag = selmy_failed
					}
				}
			}
			random_courtier = {
				if = { # Valid Jailer?
					limit = { has_court_position = gaoler_court_position }
					save_scope_as = courtier
				}
				else_if = { # Valid Courtier?
					limit = {
						is_male = yes
						has_any_court_position = no
						NOR = {
							is_ruler = yes
							has_council_position = councillor_chancellor
							has_council_position = councillor_steward
							has_council_position = councillor_marshal
							has_council_position = councillor_spymaster
							has_council_position = councillor_admiral
							has_council_position = councillor_court_chaplain
						}
						NOT = { is_close_or_extended_family_of = root }
					}
					save_scope_as = courtier
				}
				else = { # Generate Someone
					create_character = {
						template = new_warrior_character
						gender = male
						location = root.capital_province
						culture = root.culture
						faith = root.faith
						dynasty = generate
						save_scope_as = courtier
					}
					hidden_effect = { character:Darklyn_47.house.house_head ?= { add_courtier = scope:courtier } }
				}
			}
		}
		character:Targaryen_1 ?= { save_scope_as = aerys }
		character:Selmy_3 ?= { save_scope_as = selmy }
	}

	option = { # Barristan Was Caught; Secede
		name = agot_scenario_dd.0081.opt.a
		custom_tooltip = agot_scenario_dd.0081.a.tt
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_failed } }

		show_as_tooltip = {
			character:Targaryen_1 ?= {
				death = {
					death_reason = death_punishment
					killer = title:d_duskendale.holder
				}
			}
			character:Selmy_3 ?= {
				death = {
					death_reason = death_punishment
					killer = title:d_duskendale.holder
				}
			}
		}
		set_global_variable = aerys_died_in_event

		create_title_and_vassal_change = {
			type = independency
			save_scope_as = independence_change
			add_claim_on_loss = no
		}
		becomes_independent = {
			change = scope:independence_change
		}
		resolve_title_and_vassal_change = scope:independence_change
	}

	option = { # The King has Escaped
		name = agot_scenario_dd.0081.opt.b
		custom_tooltip = agot_scenario_dd.0081.b.tt
		trigger = { character:Targaryen_1 ?= { has_character_flag = selmy_saved } }

		show_as_tooltip = { # Aerys Released
			agot_dd_set_aerys_free = yes
		}
		scope:courtier ?= {
			death = { # Denys Rage
				death_reason = death_beaten
				killer = title:d_duskendale.holder
			}
		}
	}

	option = { # Aerys Dead Already; Independence War
		name = agot_scenario_dd.0081.opt.c
		custom_tooltip = agot_scenario_dd.0081.c.tt
		trigger = {
			character:Targaryen_1 ?= { is_alive = no }
			NOT = { has_global_variable = duskendale_decided }
			NOT = { has_global_variable = aerys_died_in_event }
			title:d_duskendale.holder ?= { is_independent_ruler = no }
		}

		if = {
			limit = { has_global_variable = duskendale_war_first }
			remove_global_variable = duskendale_war_first
			set_global_variable = duskendale_war_second
			debug_log = "AGOTDD: Vassal Duskendale attacked Rhaegar for the second time"
		}
		else_if = {
			limit = { NOT = { has_global_variable = duskendale_war_first } }
			set_global_variable = duskendale_war_first
			debug_log = "AGOTDD: Vassal Duskendale attacked Rhaegar for the first time"
		}

		show_as_tooltip = {
			start_war = {
				casus_belli = agot_duskendale_independence_war
				target = title:e_the_iron_throne.holder
			}
		}
	}

	after = {
		if = {
			limit = {
				character:Targaryen_1 ?= { is_alive = no }
				NOT = { has_global_variable = duskendale_decided }
				NOT = { has_global_variable = aerys_died_in_event }
				title:d_duskendale.holder ?= { is_independent_ruler = no }
			}
			trigger_event = {
				id = agot_scenario_dd.0088
				days = 14
			}
		}
	}
}

agot_scenario_dd.0088 = { # Denys Starts an Independence War as a Vassal
	hidden = yes

	immediate = {
		title:e_the_iron_throne.holder ?= {
			add_character_flag = { flag = mw_init_event_blocker days = 2 }
			# Wear Your Armor
			agot_dd_wear_your_armor = yes
		}
		title:d_duskendale.holder ?= {
			start_war = {
				casus_belli = agot_duskendale_independence_war
				target = title:e_the_iron_throne.holder
			}
		}
		if = {
			limit = { NOT = { has_global_variable = duskendale_independence_started } }
			set_global_variable = duskendale_independence_started
		}
	}
}


############################
########### We Ride to War #
############################

############################
# War Participation Events #
############################

agot_scenario_dd.0095 = { # Rhaegar Can Join Tywin's Rescue War
	type = character_event
	title = agot_scenario_dd.0095.t
	desc = agot_scenario_dd.0095.desc

	theme = martial
	override_background = { reference = study }

	left_portrait = root
	right_portrait = {
		character = character:Lannister_1
		outfit_tags = {
			military_outfit
			no_hat
		}
	}

	immediate = {
		character:Targaryen_1 ?= { save_scope_as = aerys }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
	}

	option = { # On My Way
		name = agot_scenario_dd.0095.opt.a
		custom_tooltip = agot_scenario_dd.0095.a.tt
		title:k_the_westerlands.holder ?= {
			every_character_war = {
				add_attacker = character:Targaryen_3
			}
		}
		add_character_flag = joined_rescue_war
		# Wear Your Armor
		agot_dd_wear_your_armor = yes

		ai_chance = { # AI Shouldn't Refuse Unless Negative Relation
			base = 100
			modifier = {
				OR = {
					has_relation_rival = scope:tywin
					has_relation_nemesis = scope:tywin
				}
				add = -50
			}
		}
	}

	option = { # Tywin's On His Own
		name = agot_scenario_dd.0095.opt.b
		custom_tooltip = agot_scenario_dd.0095.b.tt

		ai_chance = { # AI Shouldn't Refuse Unless Negative Relation
			base = 0
			modifier = {
				OR = {
					has_relation_rival = scope:tywin
					has_relation_nemesis = scope:tywin
				}
				add = 50
			}
		}
	}
}

agot_scenario_dd.0097 = { # Force Neutral for Specific Characters
	hidden = yes

	immediate = { agot_mw_stay_neutral_effect = { RULER = root CROWN = character:Targaryen_1 } }
}

agot_scenario_dd.0098 = { # Rhaegar's Iron Throne Claimant War; Add Attackers
	hidden = yes

	immediate = {
		agot_mw_fetch_crown_story_from_char_scope = { CHECK_CHAR = root }
		agot_mw_fetch_rebel_story_from_char_scope = { CHECK_CHAR = root }

		every_in_list = { # Voted to Depose Aerys
			variable = gc_deposed_aerys
			save_scope_as = claimant_join

			set_variable = { name = mw_is_loyal_to value = root }
			agot_mw_join_rebels_effect = { RULER = scope:claimant_join REBEL_LEADER = character:Targaryen_3 }
		}
	}
}

agot_scenario_dd.0099 = { # Rhaegar's Iron Throne Claimant War; Add Defenders
	hidden = yes

	immediate = {
		agot_mw_fetch_crown_story_from_char_scope = { CHECK_CHAR = root }
		agot_mw_fetch_rebel_story_from_char_scope = { CHECK_CHAR = root }

		every_in_list = { # Voted to Keep Aerys
			variable = gc_kept_aerys
			save_scope_as = crown_join

			set_variable = { name = mw_is_loyal_to value = root }
			agot_mw_join_loyalists_effect = { RULER = scope:crown_join CROWN = character:Targaryen_1 }
		}
	}
}


##################################
# Rescue War Saves Aerys Instead #
##################################

agot_scenario_dd.0100 = { # Rescue War Won, Sent to Aerys and Rhaegar
	type = character_event
	title = agot_scenario_dd.0100.t
	desc = {
		first_valid = {
			triggered_desc = { # Aerys
				trigger = { root = character:Targaryen_1 }
				desc = agot_scenario_dd.0100.desc.aerys
			}
			triggered_desc = { # Rhaegar
				trigger = { root = character:Targaryen_3 }
				desc = agot_scenario_dd.0100.desc.rhaegar
			}
		}
	}

	theme = martial
	override_background = { reference = burning_building }

	widgets = {
		widget = {
			gui = "agot_event_shader_sparks"
			container = "agot_shader_event_background"
		}
	}

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { root = character:Targaryen_1 }
			animation = anger
		}
		triggered_animation = {
			trigger = { root = character:Targaryen_3 }
			animation = admiration
		}
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	right_portrait = {
		character = scope:rescue_war_winner
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	lower_left_portrait = { character = character:Targaryen_8 }
	lower_right_portrait = {
		trigger = { root = character:Targaryen_1 }
		character = character:Rykker_2.house.house_head
	}

	immediate = {
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		character:Rykker_2.house.house_head ?= { save_scope_as = renfred }
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Targaryen_1 ?= {
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
	}

	option = { # Duskendale Goes to House Rykker; Execute Darklyn/Hollard
		name = agot_scenario_dd.0100.opt.a
		custom_tooltip = agot_scenario_dd.0100.a.tt
		trigger = {
			root = character:Targaryen_1
			character:Rykker_2.house.house_head ?= { is_alive = yes }
		}

		# Put Them to Death
		character:Darklyn_47.house.house_head ?= { add_character_flag = marked_for_death }
		# Transfer of Power; House Rykker
		character:Rykker_2.house.house_head ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
			sadistic = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_4 } # Historic Weight
		}
	}

	option = { # Duskendale Goes to House Rykker; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0100.opt.b
		custom_tooltip = agot_scenario_dd.0100.b.tt
		trigger = {
			root = character:Targaryen_1
			character:Rykker_2.house.house_head ?= { is_alive = yes }
		}

		# Transfer of Power; House Rykker
		character:Rykker_2.house.house_head ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to House Targaryen; Execute Darklyn/Hollard
		name = agot_scenario_dd.0100.opt.c
		custom_tooltip = agot_scenario_dd.0100.c.tt
		trigger = { root = character:Targaryen_1 }

		# Put Them to Death
		character:Darklyn_47.house.house_head ?= { add_character_flag = marked_for_death }
		# Transfer of Power; House Targaryen
		character:Targaryen_8 ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
			sadistic = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to House Targaryen; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0100.opt.d
		custom_tooltip = agot_scenario_dd.0100.d.tt
		trigger = { root = character:Targaryen_1 }

		# Transfer of Power; House Targaryen
		character:Targaryen_8 ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Rhaegar Relief
		name = agot_scenario_dd.0100.opt.e
		custom_tooltip = agot_scenario_dd.0100.e.tt
		trigger = { root = character:Targaryen_3 }
	}

	after = {
		if = {
			limit = {
				root = character:Targaryen_1
				character:Lannister_1 ?= { is_alive = yes }
			}
			# Transfer of Power
			agot_dd_duskendale_title_transfer = { HOLDER = scope:chosen_holder }
			# Opinions
			add_opinion = {
				target = character:Lannister_1
				modifier = rv_rescued_me
			}
			character:Targaryen_3 ?= {
				if = {
					limit = { is_alive = yes }
					add_opinion = {
						target = character:Lannister_1
						modifier = rv_rescued_family
					}
				}
			}
			# End Rescue War
			agot_dd_invalidate_rescue_war = yes

			# Aerys Released
			agot_dd_set_aerys_free = yes

			scope:scenario_dd_story ?= { # The Scenario is Resolved
				set_variable = {
					name = agot_dd_scenario
					value = flag:resolved
				}
				set_variable = {
					name = agot_dd_selmy
					value = flag:resolved
				}
			}
		}
	}
}

agot_scenario_dd.0111 = { # Rescue War Won, Sent to Rescue War Winner
	type = character_event
	title = agot_scenario_dd.0111.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { root = scope:tywin }
				desc = agot_scenario_dd.0111.desc.tywin
			}
			triggered_desc = {
				trigger = { root = scope:rhaegar }
				desc = agot_scenario_dd.0111.desc.rhaegar
			}
		}
	}

	theme = martial
	override_background = { reference = burning_building }

	widgets = {
		widget = {
			gui = "agot_event_shader_sparks"
			container = "agot_shader_event_background"
		}
	}

	left_portrait = {
		character = root
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	right_portrait = {
		character = scope:denys
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	lower_right_portrait = { character = scope:aerys }

	immediate = {
		character:Targaryen_3 ?= { save_scope_as = rhaegar }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
		character:Targaryen_1 ?= {
			save_scope_as = aerys
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
	}

	option = { # Tywin wins Duskendale
		name = agot_scenario_dd.0111.opt.a
		custom_tooltip = agot_scenario_dd.0111.a.tt
		trigger = {
			root = character:Lannister_1
			character:Darklyn_47 ?= { is_alive = yes }
		}
	}

	option = { # Tywin wins Duskendale
		name = agot_scenario_dd.0111.opt.b
		custom_tooltip = agot_scenario_dd.0111.b.tt
		trigger = {
			root = character:Lannister_1
			character:Darklyn_47 ?= { is_alive = no }
		}
	}

	option = { # Rhaegar wins Duskendale
		name = agot_scenario_dd.0111.opt.c
		custom_tooltip = agot_scenario_dd.0111.c.tt
		trigger = {
			root = character:Targaryen_3
			character:Darklyn_47 ?= { is_alive = yes }
		}
	}

	option = { # Rhaegar wins Duskendale
		name = agot_scenario_dd.0111.opt.d
		custom_tooltip = agot_scenario_dd.0111.d.tt
		trigger = {
			root = character:Targaryen_3
			character:Darklyn_47 ?= { is_alive = no }
		}
	}

	after = {
		if = {
			limit = {
				scope:rescue_war_winner ?= root
				NOT = { has_global_variable = stalwart_taken }
			}
			scope:rescue_war_winner ?= {
				steal_artifact_in_siege_effect = {
					LOCATION = title:d_duskendale.holder.capital_province
					ATTACKER = scope:rescue_war_winner
					DEFENDER = scope:denys
					ARTIFACT = scope:stalwart
					IS_RAID = no
				}
			}
			set_global_variable = stalwart_taken
		}
	}
}


#########################
########### Selmy Saves #
#########################

###############################
# Barristan the Bold Requests #
###############################

agot_scenario_dd.0195 = { # A Humble Request; Selmy Vows to Save Aerys; Sent to Tywin
	type = character_event
	title = agot_scenario_dd.0195.t
	desc = agot_scenario_dd.0195.desc

	theme = dread
	override_background = { reference = army_camp }

	left_portrait = {
		character = root
		outfit_tags = {
			military_outfit
			no_hat
		}
	}
	right_portrait = { character = character:Selmy_3 }

	trigger = {
		character:Targaryen_1 ?= {
			is_alive = yes
			is_imprisoned = yes
		}
		title:e_the_iron_throne.holder ?= character:Targaryen_1
	}

	immediate = {
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Targaryen_3 ?= { save_scope_as = rhaegar }
		character:Blackfyre_14 ?= { save_scope_as = maelys }
		character:Lannister_1 ?= { save_scope_as = tywin }
		title:d_duskendale ?= { save_scope_as = duskendale }
		character:Targaryen_1 ?= {
			save_scope_as = aerys
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
	}

	option = { # Tywin Allows Barristan
		name = agot_scenario_dd.0195.opt.a
		custom_tooltip = agot_scenario_dd.0195.a.tt

		hidden_effect = {
			scope:scenario_dd_story ?= { # Engage Selmy Story Progression
				set_variable = {
					name = agot_dd_selmy
					value = flag:allowed
				}
			}
			character:Selmy_3 ?= {
				add_character_flag = yearly_1010_abductor
				add_character_flag = agot_is_at_unknown_place
				add_character_flag = use_stealth_clothes
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	option = { # Tywin Denies Barristan
		name = agot_scenario_dd.0195.opt.b
		custom_tooltip = agot_scenario_dd.0195.b.tt

		hidden_effect = {
			if = { # Ask Rhaegar Instead
				limit = {
					character:Targaryen_3 ?= {
						is_alive = yes
						NOT = { has_character_flag = selmy_asked }
					}
				}
				character:Targaryen_3 = {
					trigger_event = {
						id = agot_scenario_dd.0196
						days = 7
					}
					add_character_flag = selmy_asked
				}
			}
			scope:scenario_dd_story ?= { # Prevent Selmy Story Progression
				set_variable = {
					name = agot_dd_selmy
					value = flag:denied
				}
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}
}

agot_scenario_dd.0196 = { # A Humble Request; Tywin Declines; Sent to Rhaegar
	type = character_event
	title = agot_scenario_dd.0196.t
	desc = agot_scenario_dd.0196.desc

	theme = dread
	override_background = { reference = study }

	left_portrait = root
	right_portrait = { character = character:Selmy_3 }

	option = { # Rhaegar Allows Barristan
		name = agot_scenario_dd.0196.opt.a
		custom_tooltip = agot_scenario_dd.0196.a.tt

		scope:scenario_dd_story ?= { # Engage Selmy Story Progression
			set_variable = {
				name = agot_dd_selmy
				value = flag:allowed
			}
		}
		character:Selmy_3 ?= {
			add_character_flag = yearly_1010_abductor
			add_character_flag = agot_is_at_unknown_place
			add_character_flag = use_stealth_clothes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_3 } # Historic Weight
		}
	}

	option = { # Rhaegar Denies Barristan
		name = agot_scenario_dd.0196.opt.b
		custom_tooltip = agot_scenario_dd.0196.b.tt

		scope:scenario_dd_story ?= { # Prevent Selmy Story Progression
			set_variable = {
				name = agot_dd_selmy
				value = flag:denied
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_3 } # Non-historic Weight
		}
	}
}


#############################
# Barristan Attempt Results #
#############################

agot_scenario_dd.0197 = { # Selmy Saves; Sent to Aerys
	type = character_event
	title = agot_scenario_dd.0197.t
	desc = agot_scenario_dd.0197.desc

	theme = dread
	override_background = { reference = dungeon }

	left_portrait = root
	right_portrait = { character = character:Selmy_3 }

	immediate = {
		character:Targaryen_1 ?= {
			save_scope_as = aerys
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Rykker_2.house.house_head ?= { save_scope_as = renfred }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
		character:Darklyn_47.house.house_head ?= {
			save_scope_as = denys
			if = {
				limit = { any_character_artifact = { has_artifact_modifier = vs_stalwart_modifier } }
				random_character_artifact = {
					limit = { has_artifact_modifier = vs_stalwart_modifier }
					save_scope_as = stalwart
				}
			}
		}
	}

	option = { # Duskendale Goes to House Rykker; Execute Darklyn/Hollard
		name = agot_scenario_dd.0197.opt.a
		custom_tooltip = agot_scenario_dd.0197.a.tt
		trigger = { character:Rykker_2.house.house_head ?= { is_alive = yes } }

		# Put Them to Death
		character:Darklyn_47.house.house_head ?= { add_character_flag = marked_for_death }
		# Transfer of Power; House Rykker
		character:Rykker_2.house.house_head ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
			sadistic = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_4 } # Historic Weight
		}
	}

	option = { # Duskendale Goes to House Rykker; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0197.opt.b
		custom_tooltip = agot_scenario_dd.0197.b.tt
		trigger = { character:Rykker_2.house.house_head ?= { is_alive = yes } }

		# Transfer of Power; House Rykker
		character:Rykker_2.house.house_head ?= { save_scope_as = chosen_holder }

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to House Targaryen; Execute Darklyn/Hollard
		name = agot_scenario_dd.0197.opt.c
		custom_tooltip = agot_scenario_dd.0197.c.tt

		# Put Them to Death
		character:Darklyn_47.house.house_head ?= { add_character_flag = marked_for_death }
		# Transfer of Power; House Targaryen
		if = {
			limit = { character:Targaryen_8 ?= { is_alive = yes } }
			character:Targaryen_8 ?= { save_scope_as = chosen_holder }
		}
		else_if = {
			limit = { character:Targaryen_3 ?= { is_alive = yes } }
			character:Targaryen_3 ?= { save_scope_as = chosen_holder }
		}
		else = {
			character:Targaryen_8.house.house_head ?= { save_scope_as = chosen_holder }
		}

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
			sadistic = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to House Targaryen; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0197.opt.d
		custom_tooltip = agot_scenario_dd.0197.d.tt

		# Transfer of Power; House Targaryen
		if = {
			limit = { character:Targaryen_8 ?= { is_alive = yes } }
			character:Targaryen_8 ?= { save_scope_as = chosen_holder }
		}
		else_if = {
			limit = { character:Targaryen_3 ?= { is_alive = yes } }
			character:Targaryen_3 ?= { save_scope_as = chosen_holder }
		}
		else = {
			character:Targaryen_8.house.house_head ?= { save_scope_as = chosen_holder }
		}

		stress_impact = { # Stress loss
			wrathful = major_stress_impact_loss
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	after = {
		# Transfer of Power
		if = {
			limit = { exists = scope:chosen_holder }
			agot_dd_duskendale_title_transfer = { HOLDER = scope:chosen_holder }
		}
		# Opinions
		add_opinion = {
			target = character:Selmy_3
			modifier = rv_rescued_me
		}
		character:Targaryen_3 ?= {
			if = {
				limit = { is_alive = yes }
				add_opinion = {
					target = character:Selmy_3
					modifier = rv_rescued_family
				}
			}
		}
		# End Rescue War
		agot_dd_invalidate_rescue_war = yes

		# Aerys Released
		agot_dd_set_aerys_free = yes

		character:Targaryen_3 ?= {
			add_character_flag = selmy_interrupted
			trigger_event = {
				id = agot_scenario_dd.0199
			}
		}

		scope:scenario_dd_story ?= { # The Scenario is Resolved
			set_variable = {
				name = agot_dd_scenario
				value = flag:resolved
			}
			set_variable = {
				name = agot_dd_selmy
				value = flag:resolved
			}
		}

		if = {
			limit = { NOT = { has_global_variable = stalwart_taken } }
			steal_artifact_in_siege_effect = {
				LOCATION = title:d_duskendale.holder.capital_province
				ATTACKER = root
				DEFENDER = scope:denys
				ARTIFACT = scope:stalwart
				IS_RAID = no
			}
			set_global_variable = stalwart_taken
		}
	}
}

agot_scenario_dd.0198 = { # Selmy Fails; Sent to Aerys then Sends Message to Rhaegar
	type = character_event
	title = agot_scenario_dd.0198.t
	desc = agot_scenario_dd.0198.desc

	theme = death
	override_background = { reference = gallows }

	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:denys
		animation = schadenfreude
	}

	immediate = {
		character:Targaryen_1 ?= {
			save_scope_as = aerys
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Lannister_1 ?= { save_scope_as = tywin }
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		character:Rykker_2.house.house_head ?= { save_scope_as = renfred }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
	}

	option = { # Barristan Dies; Aerys Dies
		name = agot_scenario_dd.0198.opt.a
		custom_tooltip = agot_scenario_dd.0198.a.tt

		show_as_tooltip = {
			death = {
				death_reason = death_punishment
				killer = title:d_duskendale.holder
			}
			character:Selmy_3 ?= {
				death = {
					death_reason = death_punishment
					killer = title:d_duskendale.holder
				}
			}
		}
	}

	after = {
		# End Rescue War
		agot_dd_invalidate_rescue_war = yes

		character:Targaryen_3 ?= {
			trigger_event = {
				id = agot_scenario_dd.0199
			}
		}
	}
}

agot_scenario_dd.0199 = { # Selmy Results; Sent to Rhaegar
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { has_character_flag = selmy_interrupted }
				desc = agot_scenario_dd.0199.t.saved
			}
			triggered_desc = {
				trigger = { NOT = { has_character_flag = selmy_interrupted } }
				desc = agot_scenario_dd.0199.t.failed
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = selmy_interrupted
					has_character_flag = joined_rescue_war
				}
				desc = agot_scenario_dd.0199.desc.saved.camp
			}
			triggered_desc = {
				trigger = {
					has_character_flag = selmy_interrupted
					NOT = { has_character_flag = joined_rescue_war }
				}
				desc = agot_scenario_dd.0199.desc.saved.home
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = casualty_of_war }
					has_character_flag = joined_rescue_war
				}
				desc = agot_scenario_dd.0199.desc.failed.camp
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = casualty_of_war }
					NOT = { has_character_flag = joined_rescue_war }
				}
				desc = agot_scenario_dd.0199.desc.failed.home
			}
			triggered_desc = {
				trigger = {
					has_character_flag = casualty_of_war
					OR = {
						scope:scenario_dd_story = { var:agot_dd_selmy = flag:denied }
						character:Selmy_3 = { is_alive = no }
					}
				}
				desc = agot_scenario_dd.0199.desc.war.nobs
			}
			triggered_desc = {
				trigger = { has_character_flag = casualty_of_war }
				desc = agot_scenario_dd.0199.desc.war
			}
		}
	}

	theme = crown
	override_background = {
		trigger = { has_character_flag = joined_rescue_war }
		reference = army_camp
	}
	override_background = {
		trigger = { NOT = { has_character_flag = joined_rescue_war } }
		reference = throne_room
	}

	left_portrait = {
		character = root
		triggered_animation = {
			trigger = { has_character_flag = selmy_interrupted }
			animation = admiration
		}
		triggered_animation = {
			trigger = { NOT = { has_character_flag = selmy_interrupted } }
			animation = stress
		}
	}

	right_portrait = {
		trigger = { has_character_flag = selmy_interrupted }
		character = character:Targaryen_1
		animation = scheme
	}

	lower_right_portrait = {
		trigger = { has_character_flag = selmy_interrupted }
		character = character:Selmy_3
	}

	immediate = {
		title:e_the_iron_throne.holder ?= {
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
		if = {
			limit = {
				NOR = {
					has_character_flag = selmy_interrupted
					has_character_flag = casualty_of_war
				}
			}
			show_as_tooltip = {
				character:Targaryen_1 ?= {
					death = {
						death_reason = death_punishment
						killer = title:d_duskendale.holder
					}
				}
				character:Selmy_3 ?= {
					death = {
						death_reason = death_punishment
						killer = title:d_duskendale.holder
					}
				}
			}
		}
		root.liege.cp:councillor_chancellor ?= { save_scope_as = chancellor }
		root.liege.cp:councillor_steward ?= { save_scope_as = steward }
		root.liege.cp:councillor_marshal ?= { save_scope_as = marshal }
		root.liege.cp:councillor_spymaster ?= { save_scope_as = spymaster }
		root.liege.cp:councillor_admiral ?= { save_scope_as = admiral }
		root.liege.cp:councillor_court_chaplain ?= { save_scope_as = chaplain }
	}

	option = { # Selmy Saved; Rhaegar Goes Home
		name = agot_scenario_dd.0199.opt.a
		custom_tooltip = agot_scenario_dd.0199.a.tt
		trigger = { has_character_flag = selmy_interrupted }
	}

	option = { # Barristan Dies; Aerys Dies
		name = agot_scenario_dd.0199.opt.b
		custom_tooltip = agot_scenario_dd.0199.b.tt
		trigger = {
			NOR = {
				has_character_flag = selmy_interrupted
				has_character_flag = casualty_of_war
			}
		}

		hidden_effect = {
			character:Targaryen_1 ?= {
				death = {
					death_reason = death_punishment
					killer = title:d_duskendale.holder
				}
				add_dead_character_flag = {
					flag = died_in_event
					days = 7
				}
			}
			character:Selmy_3 ?= {
				death = {
					death_reason = death_punishment
					killer = title:d_duskendale.holder
				}
			}
		}
	}

	option = { # Aerys Was Killed; Execute Them
		name = agot_scenario_dd.0199.opt.c
		custom_tooltip = agot_scenario_dd.0199.c.tt
		trigger = { has_character_flag = casualty_of_war }

		# Put Them to Death
		character:Darklyn_47.house.house_head ?= { add_character_flag = marked_for_death }
		# Transfer of Power; House Targaryen
		title:e_the_iron_throne.holder ?= { save_scope_as = chosen_holder }
		# Restore Small Council
		hidden_effect = { agot_dd_rhaegar_throne_setup = yes }

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_3 } # Non-historic Weight
		}
	}

	option = { # Aerys Was Killed; Send Denys to the Wall
		name = agot_scenario_dd.0199.opt.d
		custom_tooltip = agot_scenario_dd.0199.d.tt
		trigger = {
			character:Darklyn_47 ?= { is_alive = yes }
			has_character_flag = casualty_of_war
		}

		# Send to the Wall
		agot_send_to_nightswatch_effect = { ACTOR = root NIGHTSWATCH_CANDIDATE = title:d_duskendale.holder }
		# Transfer of Power; House Targaryen
		title:e_the_iron_throne.holder ?= { save_scope_as = chosen_holder }
		# Restore Small Council
		hidden_effect = { agot_dd_rhaegar_throne_setup = yes }

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_3 } # Historic Weight
		}
	}

	option = { # Aerys Was Killed; Send Denys to the Wall
		name = agot_scenario_dd.0199.opt.e
		custom_tooltip = agot_scenario_dd.0199.e.tt
		trigger = { has_character_flag = casualty_of_war }

		# Transfer of Power; House Targaryen
		title:e_the_iron_throne.holder ?= { save_scope_as = chosen_holder }
		# Restore Small Council
		hidden_effect = { agot_dd_rhaegar_throne_setup = yes }

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_3 } # Non-historic Weight
		}
	}

	after = {
		agot_dd_tear_your_armor = yes
		if = {
			limit = {
				NOR = {
					has_character_flag = selmy_interrupted
					has_character_flag = casualty_of_war
				}
			}
			trigger_event = {
				id = agot_scenario_dd.0200
				months = { 2 4 }
			}
			# Restore Small Council
			hidden_effect = { agot_dd_rhaegar_throne_setup = yes }
		}
		else_if = {
			limit = {
				NOT = { has_character_flag = selmy_interrupted }
				has_character_flag = casualty_of_war
			}
			# Transfer of Power
			agot_dd_duskendale_title_transfer = { HOLDER = scope:chosen_holder }
			scope:scenario_dd_story ?= { # The Scenario is Resolved
				set_variable = {
					name = agot_dd_scenario
					value = flag:resolved
				}
				set_variable = {
					name = agot_dd_selmy
					value = flag:resolved
				}
			}
		}
		if = {
			limit = {
				NOT = { has_global_variable = stalwart_taken }
				NOT = { has_character_flag = selmy_interrupted }
				has_character_flag = casualty_of_war
				NOR = {
					character:Lannister_1 ?= {
						any_character_artifact = {
							has_artifact_modifier = vs_stalwart_modifier
						}
					}
					character:Targaryen_3 ?= {
						any_character_artifact = {
							has_artifact_modifier = vs_stalwart_modifier
						}
					}
				}
			}
			steal_artifact_in_siege_effect = {
				LOCATION = title:d_duskendale.holder.capital_province
				ATTACKER = root
				DEFENDER = scope:denys
				ARTIFACT = scope:stalwart
				IS_RAID = no
			}
			set_global_variable = stalwart_taken
		}
	}
}


#####################################
########### The Issue of Duskendale #
#####################################

##################################
# Duskendale Remains in Question #
##################################

agot_scenario_dd.0200 = { # Selmy Fails; Tywin Asks Rhaegar to Put His Family in Charge; Rhaegar Starts a War
	type = character_event
	title = agot_scenario_dd.0200.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { has_global_variable = aerys_died_in_event }
					character:Lannister_1 ?= { is_alive = yes }
					has_global_variable = duskendale_war_first
				}
				desc = agot_scenario_dd.0200.desc.early
			}
			triggered_desc = {
				trigger = { character:Lannister_1 ?= { is_alive = yes } }
				desc = agot_scenario_dd.0200.desc.tywin
			}
			triggered_desc = {
				trigger = { character:Lannister_1 ?= { is_alive = no } }
				desc = agot_scenario_dd.0200.desc.viserys
			}
		}
	}

	theme = realm
	override_background = { reference = agot_iron_throne }

	left_portrait = root
	right_portrait = { character = character:Lannister_1 }

	immediate = {
		character:Targaryen_1 ?= { save_scope_as = aerys }
		title:e_the_iron_throne.holder ?= {
			random_owned_story = {
				limit = { story_type = story_agot_scenario_dd }
				save_scope_as = scenario_dd_story
			}
		}
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Lannister_1 ?= {
			save_scope_as = tywin
			random_sibling = { # Choose a Valid Sibling of Tywin
				limit = {
					is_alive = yes
					is_male = yes
				}
				save_scope_as = chosen_sibling
			}
		}
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		character:Rykker_2.house.house_head ?= { save_scope_as = renfred }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
	}

	option = { # Choose a Sibling of Tywin's to Receive Duskendale
		name = agot_scenario_dd.0200.opt.a
		custom_tooltip = agot_scenario_dd.0200.a.tt
		trigger = {
			has_global_variable = aerys_died_in_event
			character:Lannister_1 ?= { is_alive = yes }
		}

		hidden_effect = {
			# Transfer of Power; House Lannister
			scope:chosen_sibling ?= { save_scope_as = chosen_holder }
		}

		reverse_add_opinion = {
			modifier = esr_grant_family_duchy
			target = character:Lannister_1
		}
		reverse_add_opinion = {
			modifier = grateful_opinion
			target = scope:chosen_sibling
			opinion = 25
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to Viserys
		name = agot_scenario_dd.0200.opt.b
		custom_tooltip = agot_scenario_dd.0200.b.tt
		trigger = {
			has_global_variable = aerys_died_in_event
			character:Targaryen_8 ?= { is_alive = yes }
		}

		hidden_effect = {
			# Transfer of Power; House Targaryen
			character:Targaryen_8 = { save_scope_as = chosen_holder }
		}

		if = {
			limit = { character:Lannister_1 ?= { is_alive = yes } }
			reverse_add_opinion = {
				modifier = disregarded_me_opinion
				target = character:Lannister_1
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	option = { # Duskendale Goes to Rhaegar
		name = agot_scenario_dd.0200.opt.c
		custom_tooltip = agot_scenario_dd.0200.c.tt
		trigger = {
			has_global_variable = aerys_died_in_event
			character:Targaryen_8 ?= { is_alive = no }
			character:Lannister_1 ?= { is_alive = no }
		}

		hidden_effect = {
			# Transfer of Power; House Targaryen
			title:e_the_iron_throne.holder ?= { save_scope_as = chosen_holder }
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	after = {
		if = {
			limit = { has_global_variable = duskendale_war_first }
			remove_global_variable = duskendale_war_first
			set_global_variable = duskendale_war_second
			debug_log = "AGOTDD: Rhaegar attacked an independent Duskendale for the second time"
		}
		else_if = {
			limit = { NOT = { has_global_variable = duskendale_war_first } }
			set_global_variable = duskendale_war_first
			debug_log = "AGOTDD: Rhaegar attacked an independent Duskendale for the first time"
		}
		title:e_the_iron_throne.holder ?= {
			add_character_flag = { flag = mw_init_event_blocker days = 2 }
			start_war = {
				casus_belli = agot_duskendale_claimant_war
				target = title:d_duskendale.holder
				target_title = title:d_duskendale
				target_title = title:c_duskendale
				target_title = title:c_crownback
				claimant = scope:chosen_holder
			}
			agot_dd_wear_your_armor = yes
		}
		if = {
			limit = { NOT = { has_global_variable = duskendale_claimant_started } }
			set_global_variable = duskendale_claimant_started
		}
	}
}

agot_scenario_dd.0201 = { # Selmy Fails; Tywin Asks Rhaegar to Put His Family in Charge after Denys Fails Independence War
	type = character_event
	title = agot_scenario_dd.0201.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { character:Lannister_1 ?= { is_alive = yes } }
				desc = agot_scenario_dd.0201.desc.tywin
			}
			triggered_desc = {
				trigger = { character:Lannister_1 ?= { is_alive = no } }
				desc = agot_scenario_dd.0201.desc.viserys
			}
		}
	}

	theme = war
	override_background = {
		reference = burning_building
	}

	widgets = {
		widget = {
			gui = "agot_event_shader_sparks"
			container = "agot_shader_event_background"
		}
	}

	left_portrait = root
	right_portrait = { character = character:Lannister_1 }

	immediate = {
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Lannister_1 ?= {
			save_scope_as = tywin
			random_sibling = { # Choose a Valid Sibling of Tywin
				limit = {
					is_alive = yes
					is_male = yes
				}
				save_scope_as = chosen_sibling
			}
		}
		character:Selmy_3 ?= { save_scope_as = selmy }
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
	}

	option = { # Duskendale Goes to House Lannister; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0201.opt.a
		custom_tooltip = agot_scenario_dd.0201.a.tt
		trigger = { character:Lannister_1 ?= { is_alive = yes } }

		# Send to the Wall
		agot_send_to_nightswatch_effect = { ACTOR = root NIGHTSWATCH_CANDIDATE = scope:denys }
		# Transfer of Power
		scope:chosen_sibling ?= { save_scope_as = chosen_holder }

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Duskendale Goes to House Targaryen; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0201.opt.b
		custom_tooltip = agot_scenario_dd.0201.b.tt
		trigger = { character:Targaryen_8 ?= { is_alive = yes } }

		# Send to the Wall
		agot_send_to_nightswatch_effect = { ACTOR = root NIGHTSWATCH_CANDIDATE = scope:denys }
		# Transfer of Power; House Targaryen
		character:Targaryen_8 ?= { save_scope_as = chosen_holder }

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	option = { # Duskendale Goes to Rhaegar
		name = agot_scenario_dd.0201.opt.c
		custom_tooltip = agot_scenario_dd.0201.c.tt
		trigger = { character:Targaryen_8 ?= { is_alive = no } }

		# Send to the Wall
		agot_send_to_nightswatch_effect = { ACTOR = root NIGHTSWATCH_CANDIDATE = scope:denys }
		# Transfer of Power; House Targaryen
		title:e_the_iron_throne.holder ?= { save_scope_as = chosen_holder }

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}

	after = {
		if = {
			limit = { NOT = { has_global_variable = duskendale_decided } }
			set_global_variable = duskendale_decided
		}
		agot_dd_tear_your_armor = yes

		# Transfer of Power
		agot_dd_duskendale_title_transfer = { HOLDER = scope:chosen_holder }
	}
}

agot_scenario_dd.0220 = { # After Two Invalidations; Force Title Loss After Rhaegar Claimant War or Use to Start Final War
	type = character_event
	title = {
		first_valid = {
			triggered_desc = { # For Rhaegar
				trigger = { root = title:e_the_iron_throne.holder }
				desc = agot_scenario_dd.0220.t.rhaegar
			}
			triggered_desc = { # For Denys
				trigger = { root = title:d_duskendale.holder }
				desc = agot_scenario_dd.0220.t.denys
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = { # For Rhaegar; Invalidation Forced Possession
				trigger = {
					root = title:e_the_iron_throne.holder
					has_global_variable = duskendale_war_second
				}
				desc = agot_scenario_dd.0220.desc.rhaegar
			}
			triggered_desc = { # For Denys
				trigger = { root = title:d_duskendale.holder }
				desc = agot_scenario_dd.0220.desc.denys
			}
			triggered_desc = { # For Rhaegar; Claimant War Start
				trigger = {
					root = title:e_the_iron_throne.holder
					OR = {
						NOR = {
							has_global_variable = duskendale_war_first
							has_global_variable = duskendale_war_second
						}
						AND = {
							has_global_variable = duskendale_war_first
							NOT = { has_global_variable = duskendale_war_second }
						}
					}
				}
				desc = agot_scenario_dd.0220.desc.war
			}
		}
	}

	theme = realm
	override_background = {
		trigger = { root = title:e_the_iron_throne.holder }
		reference = army_camp
	}
	override_background = {
		trigger = { root = title:d_duskendale.holder }
		reference = burning_building
	}

	widgets = {
		widget = {
			is_shown = { root = title:d_duskendale.holder }
			gui = "agot_event_shader_sparks"
			container = "agot_shader_event_background"
		}
	}

	left_portrait = root

	immediate = {
		character:Targaryen_8 ?= { save_scope_as = viserys }
		character:Lannister_1 ?= {
			save_scope_as = tywin
			random_sibling = { # Choose a Valid Sibling of Tywin
				limit = {
					is_alive = yes
					is_male = yes
				}
				save_scope_as = chosen_sibling
			}
		}
		character:Darklyn_47.house.house_head ?= { save_scope_as = denys }
		title:d_duskendale ?= { save_scope_as = duskendale }
		title:e_the_iron_throne ?= { save_scope_as = iron_throne }
	}

	option = { # Duskendale Goes to House Lannister; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0220.opt.a
		custom_tooltip = agot_scenario_dd.0220.a.tt
		trigger = {
			root = title:e_the_iron_throne.holder
			has_global_variable = duskendale_war_second
		}
		# Transfer of Power; House Lannister
		scope:chosen_sibling ?= { save_scope_as = chosen_holder }
	}

	option = { # Duskendale Goes to House Targaryen; Remove Claims from Darklyn/Hollard
		name = agot_scenario_dd.0220.opt.b
		custom_tooltip = agot_scenario_dd.0220.b.tt
		trigger = {
			root = title:e_the_iron_throne.holder
			has_global_variable = duskendale_war_second
		}
		# Transfer of Power; House Targaryen
		character:Targaryen_8 ?= { save_scope_as = chosen_holder }
	}

	option = { # Game Over
		name = agot_scenario_dd.0220.opt.c
		custom_tooltip = agot_scenario_dd.0220.c.tt
		trigger = { root = title:d_duskendale.holder }
	}

	option = { # Claimant War - Rhaegar Style
		name = agot_scenario_dd.0220.opt.d
		custom_tooltip = agot_scenario_dd.0220.d.tt
		trigger = {
			root = title:e_the_iron_throne.holder
			OR = {
				NOR = {
					has_global_variable = duskendale_war_first
					has_global_variable = duskendale_war_second
				}
				AND = {
					has_global_variable = duskendale_war_first
					NOT = { has_global_variable = duskendale_war_second }
				}
			}
		}

		hidden_effect = {
			title:e_the_iron_throne.holder ?= {
				start_war = {
					casus_belli = agot_duskendale_claimant_war
					target = title:d_duskendale.holder
					target_title = title:d_duskendale
					target_title = title:c_duskendale
					target_title = title:c_crownback
					claimant = title:e_the_iron_throne.holder
				}
				# Wear Your Armor
				agot_dd_wear_your_armor = yes
			}
		}
		debug_log = "AGOTDD: Rhaegar personal claimant war started."
	}
}

###############################
########### Love and Marriage #
###############################

###########################
# Aerys Gone + Tywin Gone #
###########################

agot_scenario_dd.0300 = { # Rhaegar Can Choose Spouse Unpressured
	type = character_event
	title = agot_scenario_dd.0300.t
	desc = {
		desc = agot_scenario_dd.0300.desc.start
		random_valid = {
			triggered_desc = { # Only Cersei
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.c
			}
			triggered_desc = { # Only Elia
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.e
			}
			triggered_desc = { # Only Ashara
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.a
			}
			triggered_desc = { # Only Lyanna
				trigger = {
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.l
			}
			triggered_desc = { # Cersei Elia
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.ce
			}
			triggered_desc = { # Cersei Ashara
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.ca
			}
			triggered_desc = { # Cersei Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.cl
			}
			triggered_desc = { # Cersei Elia Ashara
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.cea
			}
			triggered_desc = { # Cersei Elia Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.cel
			}
			triggered_desc = { # Cersei Ashara Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.cal
			}
			triggered_desc = { # Cersei Elia Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
				}
				desc = agot_scenario_dd.0300.desc.ceal
			}
			triggered_desc = { # Elia Ashara
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.ea
			}
			triggered_desc = { # Elia Ashara Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						NOT = { has_trait = silent_sister }
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.eal
			}
			triggered_desc = { # Elia Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						NOT = { has_trait = silent_sister }
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.el
			}
			triggered_desc = { # Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.al
			}
		}
		desc = agot_scenario_dd.0300.desc.finish
	}

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = character:Lannister_6
		animation = love
	}
	lower_left_portrait = {
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Stark_5
	}
	lower_center_portrait = {
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Martell_7
	}
	lower_right_portrait = {
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Dayne_4
	}

	immediate = {
		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
	}

	option = { # Choose Cersei
		name = agot_scenario_dd.0300.opt.a
		trigger = { # Check if Married
			character:Lannister_6 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_cersei_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Choose Lyanna
		name = agot_scenario_dd.0300.opt.b
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_lyanna_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Choose Elia
		name = agot_scenario_dd.0300.opt.c
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_elia_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_ashara = yes
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_5 } # Historic Weight
		}
	}

	option = { # Choose Ashara
		name = agot_scenario_dd.0300.opt.d
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_ashara_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Rhaegar Will Continue Searching
		name = agot_scenario_dd.0300.opt.e
		custom_tooltip = agot_scenario_dd.0300.e.tt

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}
}


############################
# Aerys Dead + Tywin Alive #
############################

agot_scenario_dd.0301 = { # Rhaegar Can Choose Spouse; Tywin Influences Marriage Proposal
	type = character_event
	title = agot_scenario_dd.0301.t
	desc = agot_scenario_dd.0301.desc

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = character:Lannister_1
		animation = personality_callous
	}
	lower_right_portrait = { character = character:Lannister_6 }

	option = { # Choose Cersei
		name = agot_scenario_dd.0301.opt.a

		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_cersei_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Don't Choose Cersei
		name = agot_scenario_dd.0301.opt.b
		custom_tooltip = agot_scenario_dd.0301.b.tt

		hidden_effect = {
			if = {
				limit = {
					OR = { # Check that at least one option will be available in the event
						character:Stark_5 ?= {
							is_alive = yes
							is_married = no
						}
						character:Martell_7 ?= {
							is_alive = yes
							is_married = no
						}
						character:Dayne_4 ?= {
							is_alive = yes
							is_married = no
						}
					}
				}
				trigger_event = {
					id = agot_scenario_dd.0302
					days = 7
				}
			}
		}

		reverse_add_opinion = { # Tywin Doesn't Like
			target = character:Lannister_1
			modifier = broke_promise
			opinion = -50
		}
		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
			opinion = -50
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}
}

agot_scenario_dd.0302 = { # Rhaegar Can Choose Spouse; After Denying Tywin
	type = character_event
	title = agot_scenario_dd.0302.t
	desc = {
		desc = agot_scenario_dd.0302.desc.start
		random_valid = {
			triggered_desc = { # Only Elia
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.e
			}
			triggered_desc = { # Only Ashara
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
						
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.a
			}
			triggered_desc = { # Only Lyanna
				trigger = {
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
						
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
							
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.l
			}
			triggered_desc = { # Elia Ashara
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						NOT = { has_trait = silent_sister }
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.ea
			}
			triggered_desc = { # Elia Ashara Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						NOT = { has_trait = silent_sister }
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no						
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no						
					}
				}
				desc = agot_scenario_dd.0300.desc.eal
			}
			triggered_desc = { # Elia Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
						NOT = { has_trait = silent_sister }						
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no						
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.el
			}
			triggered_desc = { # Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no						
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no						
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
							has_trait = silent_sister
						}
					}
				}
				desc = agot_scenario_dd.0300.desc.al
			}
		}
		desc = agot_scenario_dd.0302.desc.finish
	}

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Dayne_4
		animation = love
	}
	lower_center_portrait = {
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Martell_7
	}
	lower_right_portrait = {
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Stark_5
	}

	immediate = {
		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
	}

	option = { # Choose Lyanna
		name = agot_scenario_dd.0302.opt.a
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_lyanna_effect = yes

		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Choose Elia
		name = agot_scenario_dd.0302.opt.b
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_elia_effect = yes

		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_4 } # Historic Weight
		}
	}

	option = { # Choose Ashara
		name = agot_scenario_dd.0302.opt.c
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		# Become Betrothed
		agot_scenario_dd_betrothe_ashara_effect = yes
		
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Rhaegar Will Continue Searching
		name = agot_scenario_dd.0302.opt.d
		custom_tooltip = agot_scenario_dd.0302.d.tt

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}
}


############################
# Aerys Alive + Tywin Gone #
############################

agot_scenario_dd.0305 = { # Aerys Can Choose Spouse Unpressured
	type = character_event
	title = agot_scenario_dd.0305.t
	desc = {
		desc = agot_scenario_dd.0305.desc.start
		random_valid = {
			triggered_desc = { # Only Cersei
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.c
			}
			triggered_desc = { # Only Elia
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.e
			}
			triggered_desc = { # Only Ashara
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.a
			}
			triggered_desc = { # Only Lyanna
				trigger = {
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.l
			}
			triggered_desc = { # Cersei Elia
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.ce
			}
			triggered_desc = { # Cersei Ashara
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.ca
			}
			triggered_desc = { # Cersei Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.cl
			}
			triggered_desc = { # Cersei Elia Ashara
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.cea
			}
			triggered_desc = { # Cersei Elia Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.cel
			}
			triggered_desc = { # Cersei Ashara Lyanna
				trigger = {
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.cal
			}
			triggered_desc = { # Cersei Elia Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
				}
				desc = agot_scenario_dd.0305.desc.ceal
			}
			triggered_desc = { # Elia Ashara
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.ea
			}
			triggered_desc = { # Elia Ashara Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.eal
			}
			triggered_desc = { # Elia Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.el
			}
			triggered_desc = { # Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Lannister_6 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.al
			}
		}
		desc = agot_scenario_dd.0305.desc.finish
	}

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = character:Lannister_6
		animation = love
	}
	lower_left_portrait = {
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Stark_5
	}
	lower_center_portrait = {
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Martell_7
	}
	lower_right_portrait = {
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Dayne_4
	}

	immediate = {
		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
	}

	option = { # Choose Cersei
		name = agot_scenario_dd.0305.opt.a
		trigger = { # Check if Married
			character:Lannister_6 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Lannister_6 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
				delayed = yes
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Choose Lyanna
		name = agot_scenario_dd.0305.opt.b
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Stark_5 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Choose Elia
		name = agot_scenario_dd.0305.opt.c
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Martell_7 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_5 } # Historic Weight
		}
	}

	option = { # Choose Ashara
		name = agot_scenario_dd.0305.opt.d
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Dayne_4 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}

	option = { # Rhaegar Will Continue Searching
		name = agot_scenario_dd.0305.opt.e
		custom_tooltip = agot_scenario_dd.0305.e.tt

		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_5 } # Non-historic Weight
		}
	}
}


#############################
# Aerys Alive + Tywin Alive #
#############################

agot_scenario_dd.0310 = { # Aerys Can Choose Spouse for Rhaegar; Tywin Influences Marriage Proposal
	type = character_event
	title = agot_scenario_dd.0310.t
	desc = agot_scenario_dd.0310.desc

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = character:Lannister_1
		animation = personality_callous
	}
	lower_left_portrait = { character = scope:bachelor }
	lower_right_portrait = { character = character:Lannister_6 }

	option = { # Choose Cersei
		name = agot_scenario_dd.0310.opt.a

		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
		character:Lannister_6 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Don't Choose Cersei
		name = agot_scenario_dd.0310.opt.b
		custom_tooltip = agot_scenario_dd.0310.b.tt

		hidden_effect = {
			if = {
				limit = {
					OR = { # Check that at least one option will be available in the event
						character:Stark_5 ?= {
							is_alive = yes
							is_married = no
						}
						character:Martell_7 ?= {
							is_alive = yes
							is_married = no
						}
						character:Dayne_4 ?= {
							is_alive = yes
							is_married = no
						}
					}
				}
				trigger_event = {
					id = agot_scenario_dd.0311
					days = 7
				}
			}
		}

		reverse_add_opinion = { # Tywin Doesn't Like
			target = character:Lannister_1
			modifier = betrayed_our_promise
			opinion = -50
		}
		reverse_add_opinion = { # Cersei Future Alcoholic
			target = character:Lannister_6
			modifier = rejected_opinion
			opinion = -30
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}
}

agot_scenario_dd.0311 = { # Aerys Can Choose Spouse for Rhaegar; After Denying Tywin
	type = character_event
	title = agot_scenario_dd.0311.t
	desc = {
		desc = agot_scenario_dd.0311.desc.start
		random_valid = {
			triggered_desc = { # Only Elia
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.e
			}
			triggered_desc = { # Only Ashara
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.a
			}
			triggered_desc = { # Only Lyanna
				trigger = {
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.l
			}
			triggered_desc = { # Elia Ashara
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.ea
			}
			triggered_desc = { # Elia Ashara Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
				}
				desc = agot_scenario_dd.0305.desc.eal
			}
			triggered_desc = { # Elia Lyanna
				trigger = {
					character:Martell_7 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Dayne_4 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.el
			}
			triggered_desc = { # Ashara Lyanna
				trigger = {
					character:Dayne_4 ?= {
						is_alive = yes
						is_married = no
					}
					character:Stark_5 ?= {
						is_alive = yes
						is_married = no
					}
					character:Martell_7 ?= {
						OR = {
							is_alive = no
							is_married = yes
						}
					}
				}
				desc = agot_scenario_dd.0305.desc.al
			}
		}
		desc = agot_scenario_dd.0311.desc.finish
	}

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:bachelor
		triggered_animation = {
			trigger = { scope:bachelor ?= character:Targaryen_3 }
			animation = flirtation_left
		}
	}
	lower_left_portrait = {
		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Stark_5
	}
	lower_center_portrait = {
		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Martell_7
	}
	lower_right_portrait = {
		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character = character:Dayne_4
	}

	immediate = {
		hidden_effect = { # Remove Road Blocks
			agot_rr_remove_cersei_infertility = yes
			agot_dd_rhaegar_can_marry = yes
		}
	}

	option = { # Choose Lyanna
		name = agot_scenario_dd.0311.opt.a

		trigger = { # Check if Married
			character:Stark_5 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Stark_5 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Choose Elia
		name = agot_scenario_dd.0311.opt.b

		trigger = { # Check if Married
			character:Martell_7 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Martell_7 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_4 } # Historic Weight
		}
	}

	option = { # Choose Ashara
		name = agot_scenario_dd.0311.opt.c

		trigger = { # Check if Married
			character:Dayne_4 ?= {
				is_alive = yes
				is_married = no
			}
		}
		character:Dayne_4 = { save_scope_as = bachelorette }
		scope:bachelor = {
			trigger_event = {
				id = agot_scenario_dd.0315
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}

	option = { # Rhaegar Will Continue Searching
		name = agot_scenario_dd.0311.opt.d
		custom_tooltip = agot_scenario_dd.0311.d.tt

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_4 } # Non-historic Weight
		}
	}
}

####################################
# Aerys Chooses + Rhaegar Confirms #
####################################

agot_scenario_dd.0315 = { # Rhaegar Has Spouse Chosen For Him
	type = character_event
	title = {
		random_valid = {
			triggered_desc = { # Cersei
				trigger = { scope:bachelorette ?= character:Lannister_6 }
				desc = agot_scenario_dd.0315.t.c
			}
			triggered_desc = { # Lyanna
				trigger = { scope:bachelorette ?= character:Stark_5 }
				desc = agot_scenario_dd.0315.t.l
			}
			triggered_desc = { # Elia
				trigger = { scope:bachelorette ?= character:Martell_7 }
				desc = agot_scenario_dd.0315.t.e
			}
			triggered_desc = { # Ashara
				trigger = { scope:bachelorette ?= character:Dayne_4 }
				desc = agot_scenario_dd.0315.t.a
			}
		}
	}
	desc = {
		desc = agot_scenario_dd.0315.desc.start
		random_valid = {
			triggered_desc = { # Cersei
				trigger = { scope:bachelorette ?= character:Lannister_6 }
				desc = agot_scenario_dd.0315.desc.c
			}
			triggered_desc = { # Lyanna
				trigger = { scope:bachelorette ?= character:Stark_5 }
				desc = agot_scenario_dd.0315.desc.l
			}
			triggered_desc = { # Elia
				trigger = { scope:bachelorette ?= character:Martell_7 }
				desc = agot_scenario_dd.0315.desc.e
			}
			triggered_desc = { # Ashara
				trigger = { scope:bachelorette ?= character:Dayne_4 }
				desc = agot_scenario_dd.0315.desc.a
			}
		}
		desc = agot_scenario_dd.0315.desc.finish
	}

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:bachelorette
		animation = worry
	}
	lower_left_portrait = {
		trigger = {
			character:Targaryen_1 ?= {
				is_alive = yes
				is_imprisoned = no
			}
		}
		character = character:Targaryen_1
	}

	option = { # Cersei
		name = agot_scenario_dd.0315.opt.a
		trigger = { scope:bachelorette ?= character:Lannister_6 }
		agot_scenario_dd_betrothe_cersei_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Lyanna
		name = agot_scenario_dd.0315.opt.b
		trigger = { scope:bachelorette ?= character:Stark_5 }
		agot_scenario_dd_betrothe_lyanna_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Elia
		name = agot_scenario_dd.0315.opt.c
		trigger = { scope:bachelorette ?= character:Martell_7 }
		agot_scenario_dd_betrothe_elia_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_ashara = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_historic_outcome_2 } # Historic Weight
		}
	}
	option = { # Ashara
		name = agot_scenario_dd.0315.opt.d
		trigger = { scope:bachelorette ?= character:Dayne_4 }
		agot_scenario_dd_betrothe_ashara_effect = yes
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}

	option = { # Non
		name = agot_scenario_dd.0315.opt.e
		custom_tooltip = agot_scenario_dd.0315.e.tt

		show_as_tooltip = {
			reverse_add_opinion = { # Aerys Didn't Like
				target = character:Targaryen_1
				modifier = disappointed_opinion
				opinion = -30
			}
		}
		if = {
			limit = {
				character:Targaryen_1 ?= {
					is_alive = yes
					is_imprisoned = no
				}
			}
			character:Targaryen_1 = {
				trigger_event = {
					id = agot_scenario_dd.0316
				}
			}
		}

		ai_chance = {
			base = 0
			modifier = { add = agot_nonhistoric_outcome_2 } # Non-historic Weight
		}
	}
}

####################################
# Aerys Chooses + Rhaegar Confirms #
####################################

agot_scenario_dd.0316 = { # Rhaegar Has Spouse Chosen For Him
	type = character_event
	title = agot_scenario_dd.0316.t
	desc = agot_scenario_dd.0316.desc

	theme = marriage
	override_background = { reference = agot_iron_throne }

	left_portrait = {
		character = root
		animation = anger
	}
	right_portrait = {
		character = scope:bachelor
		animation = shame
	}

	option = { # Okay
		name = agot_scenario_dd.0316.opt.a
		custom_tooltip = agot_scenario_dd.0316.a.tt

		add_opinion = { # Aerys Didn't Like
			target = scope:bachelor
			modifier = disappointed_opinion
			opinion = -30
		}
		hidden_effect = {
			agot_dd_remove_lyanna_infertility = yes
			agot_dd_remove_ashara_infertility = yes
			agot_dd_remove_elia_infertility = yes
			agot_dd_remove_no_land_elia = yes
			agot_dd_remove_no_land_ashara = yes
		}
	}
}